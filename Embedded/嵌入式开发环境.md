# 如何运行RUST

取决于应用的环境和需求，有多种方式可以运行基于Rust的固件。一般有两种方式使用Rust编写的固件：托管环境或是裸机，接下来让我们讨论这两种方式。

## 什么是托管环境？
在Rust中，托管环境近似于正常的PC，也就是说会为你提供一个操作系统。有了操作系统，你就可以构建Rust的标准库（std）了。std指标准软件库，可以看作是每次Rust安装都会包括的模块和类型。std提供构建Rust程序的多种功能，包括数据结构、网络、互斥量和其他同步原语、输入输出等。

在托管环境下，你可以在基于C语言的ESP-IDF开发环境中使用Rust。ESP-IDF中提供newlib环境，其上可以构建Rust的标准库。换言之，在托管环境方式（有时直接被称作std环境）中，我们可以将ESP-IDF作为一个操作系统，然后在其上构建Rust应用。这样我们可以利用上面的标准库功能，以及ESP-IDF API中用C语言已经实现的功能。

在清单1中你可以看到在ESP-IDF（FreeROTS）中的闪灯代码样例。esp-idf-hal中能找到更多的样例。

- 丰富的功能
如果你的嵌入式系统需要许多功能，例如网络协议、文件I/O或是复杂的数据结构，那么托管环境可能更合适。std库提供多种功能，帮助开发者快速、高效地构建复杂的应用。

- 可移植性
std箱子提供一组标准的API，可以跨平台和体系结构使用，帮助编写可移植和可重用的代码。

- 快速开发
std箱子提供了丰富的功能，不需要担心底层细节就可以快速、高效地构建应用。


## 什么是裸机环境？

裸机意味着我们没有任何操作系统。当使用no_std编译Rust程序时，程序不能使用一些特性。这不意味着你不能使用网络或者复杂的数据结构，no_std下能够做到所有在std下的功能，只是no_std情况下更为复杂和具有挑战性。no_std程序依赖于一组所有Rust环境共享的核心语言功能，包括数据类型、控制结构或者底层内存管理。嵌入式开发中存储受限，需要对底层硬件进行控制，裸机环境会更加适合。

在清单2中你可以看到在裸机环境（无操作系统）中的闪灯代码样例。esp-hal中能找到更多的样例。

- 需要节约存储
如果你的嵌入式系统中资源受限，需要节约存储，那么你可能需要裸机环境。std的功能会导致会更长的编译时间和更大的二进制文件。


- 直接控制硬件
如果你的嵌入式系统需要更直接地控制硬件，像是使用底层设备驱动或是专有硬件功能，你可能需要裸机环境。std中的抽象化可能会让硬件交互变得困难。


- 实时和时间关键应用
如果你的嵌入式系统需要实时性能或者低延迟响应，那么裸机环境会更好。std会增加难以预测的延迟和开销，这会影响实时性能。


- 定制需求
裸机环境允许更多的定制和对应用行为的细粒度控制，这在特定和非标准环境中非常有用。