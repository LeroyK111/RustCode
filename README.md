# Rustå­¦ä¹ ç¬”è®°

**å®˜ç½‘**ï¼šhttps://www.rust-lang.org/zh-CN/

**Rustupç¼–è¯‘å™¨**ï¼šhttps://github.com/rust-lang/rustup.rs/blob/master/README.md

**cargoä¸‰æ–¹åº“**ï¼šhttps://crates.io/  ä¹Ÿæ˜¯é¡¹ç›®æ„å»ºå·¥å…·å’ŒåŒ…ç®¡ç†å™¨ã€‚

**buildæ„å»ºåº“å·¥å…·**ï¼šhttps://doc.rust-lang.org/cargo/index.html

**devTools**ï¼šVScodeå§ï¼Œå¸¸ç”¨ä¸€äº›ã€‚

**vscodeæ’ä»¶**ï¼šhttps://marketplace.visualstudio.com/items?itemName=matklad.rust-analyzer

``` markdown
# åº•å±‚è¯­è¨€çš„åŸç†

ç¡¬ä»¶å¹¶ä¸æ˜¯å¤©ç”Ÿæ”¯æŒCè¯­è¨€ï¼Œè€Œæ˜¯Cè¯­è¨€è¢«è®¾è®¡ä¸ºä¸€ç§èƒ½å¤Ÿæ–¹ä¾¿åœ°æ˜ å°„åˆ°åº•å±‚ç¡¬ä»¶çš„è¯­è¨€ã€‚Cè¯­è¨€çš„è®¾è®¡åˆè¡·ä¹‹ä¸€æ˜¯æä¾›ä¸€ç§èƒ½å¤Ÿç›´æ¥æ“ä½œè®¡ç®—æœºç¡¬ä»¶çš„å·¥å…·ï¼Œä½¿å¾—ç¨‹åºå‘˜èƒ½å¤Ÿæ›´å®¹æ˜“åœ°ç¼–å†™ç³»ç»Ÿçº§å’Œåº•å±‚ä»£ç ã€‚

Cè¯­è¨€çš„åº•å±‚æ”¯æŒä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1. **ç›´æ¥çš„å†…å­˜è®¿é—®ï¼š** Cè¯­è¨€æ”¯æŒæŒ‡é’ˆï¼Œä½¿å¾—ç¨‹åºå‘˜èƒ½å¤Ÿç›´æ¥æ“ä½œå†…å­˜åœ°å€ã€‚è¿™ä½¿å¾—Cç¨‹åºå¯ä»¥æ›´çµæ´»åœ°è¿›è¡Œå†…å­˜ç®¡ç†ï¼Œç›´æ¥è®¿é—®å’Œæ“ä½œåº•å±‚ç¡¬ä»¶çš„å†…å­˜åŒºåŸŸã€‚
    
2. **æ•°æ®ç±»å‹å’Œæ“ä½œç¬¦çš„åº•å±‚æ˜ å°„ï¼š** Cè¯­è¨€çš„åŸºæœ¬æ•°æ®ç±»å‹å’Œæ“ä½œç¬¦é€šå¸¸èƒ½å¤Ÿç›´æ¥æ˜ å°„åˆ°åº•å±‚ç¡¬ä»¶çš„æŒ‡ä»¤é›†ã€‚ä¾‹å¦‚ï¼Œæ•´æ•°ç±»å‹å’Œç®—æœ¯æ“ä½œå¯ä»¥ç›´æ¥å¯¹åº”åˆ°åº•å±‚çš„æ•´æ•°è¿ç®—æŒ‡ä»¤ã€‚
    
3. **åº•å±‚æ§åˆ¶æµï¼š** Cè¯­è¨€æä¾›äº†åº•å±‚çš„æ§åˆ¶æµç»“æ„ï¼Œå¦‚æ¡ä»¶è¯­å¥ã€å¾ªç¯è¯­å¥ç­‰ï¼Œå¯ä»¥ç›´æ¥æ˜ å°„åˆ°åº•å±‚ç¡¬ä»¶çš„åˆ†æ”¯å’Œè·³è½¬æŒ‡ä»¤ã€‚
    
4. **å‡½æ•°è°ƒç”¨å’Œæ ˆç®¡ç†ï¼š** Cè¯­è¨€çš„å‡½æ•°è°ƒç”¨å’Œæ ˆç®¡ç†æœºåˆ¶èƒ½å¤Ÿæ˜ å°„åˆ°ç¡¬ä»¶çš„å‡½æ•°è°ƒç”¨å’Œæ ˆæ“ä½œã€‚è¿™ä½¿å¾—Cç¨‹åºå¯ä»¥æœ‰æ•ˆåœ°åˆ©ç”¨ç¡¬ä»¶çš„æ ˆæ¥ç®¡ç†å‡½æ•°è°ƒç”¨å’Œå±€éƒ¨å˜é‡ã€‚
    

è™½ç„¶Cè¯­è¨€å…·æœ‰è¾ƒå¥½çš„åº•å±‚æ”¯æŒï¼Œä½†ä¹Ÿéœ€è¦æ³¨æ„ï¼Œä¸åŒçš„ç¡¬ä»¶å¹³å°å’Œä½“ç³»ç»“æ„æœ‰ç€ä¸åŒçš„æŒ‡ä»¤é›†å’Œä½“ç³»ç»“æ„ç‰¹æ€§ã€‚å› æ­¤ï¼Œç¼–å†™ä¸åº•å±‚ç¡¬ä»¶äº¤äº’çš„ä»£ç æ—¶ï¼Œç¨‹åºå‘˜å¯èƒ½éœ€è¦è€ƒè™‘ç¡¬ä»¶çš„å…·ä½“ç‰¹ç‚¹ï¼Œå¹¶åœ¨ä¸€äº›æƒ…å†µä¸‹ä½¿ç”¨å¹³å°ç›¸å…³çš„ç‰¹æ€§ã€‚

# rust

Rustçš„è®¾è®¡ç›®æ ‡ä¹‹ä¸€æ˜¯æä¾›å†…å­˜å®‰å…¨å’Œå¹¶å‘å®‰å…¨ï¼ŒåŒæ—¶ä¿æŒä¸åº•å±‚ç¡¬ä»¶çš„ç›´æ¥äº¤äº’èƒ½åŠ›ã€‚ä¸Cè¯­è¨€ä¸€æ ·ï¼ŒRustå…è®¸ç›´æ¥è®¿é—®åº•å±‚ç¡¬ä»¶ï¼Œä½†å®ƒåœ¨è¯­è¨€çº§åˆ«æä¾›äº†æ›´å¤šçš„å®‰å…¨æ€§å’ŒæŠ½è±¡ã€‚Rustå®ç°ä¸ç¡¬ä»¶çš„äº¤äº’ä¸»è¦é€šè¿‡ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1. **æ‰€æœ‰æƒå’Œå€Ÿç”¨ç³»ç»Ÿï¼š** Rustå¼•å…¥äº†æ‰€æœ‰æƒå’Œå€Ÿç”¨ç³»ç»Ÿï¼Œç”¨äºç®¡ç†å†…å­˜çš„ç”Ÿå‘½å‘¨æœŸå’Œæ‰€æœ‰æƒè½¬ç§»ã€‚è¿™ç§ç³»ç»Ÿç¡®ä¿åœ¨ç¼–è¯‘æ—¶å°±èƒ½å¤Ÿæ£€æµ‹åˆ°æ½œåœ¨çš„å†…å­˜é”™è¯¯ï¼Œä¾‹å¦‚ç©ºæŒ‡é’ˆå¼•ç”¨ã€æ•°æ®ç«äº‰ç­‰ã€‚è¿™ä½¿å¾—Rustç¨‹åºåœ¨ç›´æ¥è®¿é—®åº•å±‚ç¡¬ä»¶æ—¶æ›´å®¹æ˜“é¿å…å¸¸è§çš„å®‰å…¨é—®é¢˜ã€‚
    
2. **`unsafe`å—ï¼š** å°½ç®¡Rustå¼ºè°ƒå®‰å…¨æ€§ï¼Œä½†å®ƒä¹Ÿå…è®¸ä½¿ç”¨`unsafe`å—æ¥è¿›è¡Œä¸€äº›ç¼–å†™ä¸å®‰å…¨ä»£ç çš„æ“ä½œï¼Œæ¯”å¦‚ç›´æ¥æ“ä½œåŸå§‹æŒ‡é’ˆã€è¿›è¡Œåº•å±‚çš„å†…å­˜å¸ƒå±€ç­‰ã€‚`unsafe`å—æä¾›äº†ä¸€ç§æ ‡è®°æœºåˆ¶ï¼Œé€šçŸ¥ç¼–è¯‘å™¨åœ¨è¿™äº›å—ä¸­çš„ä»£ç å¯èƒ½å­˜åœ¨æ½œåœ¨çš„å±é™©ï¼Œéœ€è¦ç¨‹åºå‘˜è´Ÿè´£ç¡®ä¿å®‰å…¨æ€§ã€‚

3. **å†…è”æ±‡ç¼–ï¼š** Rusté€šè¿‡`asm!`å®å…è®¸æ’å…¥å†…è”æ±‡ç¼–ä»£ç ï¼Œä»¥ä¾¿åœ¨éœ€è¦çš„æƒ…å†µä¸‹ç›´æ¥ä½¿ç”¨æ±‡ç¼–è¯­è¨€è¿›è¡Œåº•å±‚æ“ä½œã€‚

4. **è£¸æœºå¼€å‘æ”¯æŒï¼š** Rustæä¾›äº†æ”¯æŒè£¸æœºå¼€å‘ï¼ˆbare-metalï¼‰çš„èƒ½åŠ›ï¼Œå…è®¸ç¨‹åºå‘˜åœ¨æ²¡æœ‰æ“ä½œç³»ç»Ÿçš„ç¯å¢ƒä¸‹ç¼–å†™åµŒå…¥å¼ç³»ç»Ÿå’Œåº•å±‚ä»£ç ã€‚
```
### æ’ä»¶åˆé›†
```shell
# çƒ­é‡è½½æ’ä»¶
cargoÂ installÂ cargo-watch
# ç›‘å¬æ”¹å˜
cargoÂ watchÂ -xÂ run
# other
cargo watch -c -q -w ./src -x run
-c æ¥æ¸…ç©ºç»ˆç«¯
-q æŠ‘åˆ¶cargo watchæœ¬èº«çš„è¾“å‡º
-w å…³æ³¨æŸä¸ªç›®å½•ï¼Œè¿™é‡Œåªå…³æ³¨srcç›®å½•ã€‚
-x è¿è¡Œcargoå‘½ä»¤
```

```shell
# å‘½ä»¤è¡ŒåŒ…ç®¡ç†å·¥å…·
cargoÂ installÂ cargo-edit
```

```shell
# cargo modulesæ’ä»¶å…è®¸æˆ‘ä»¬å¯è§†åŒ–é¡¹ç›®çš„æ¨¡å—ç»“æ„ï¼Œä»¥æ ‘çŠ¶æ ¼å¼æ˜¾ç¤ºæ¨¡å—ç»“æ„ã€‚
cargoÂ installÂ cargo-modules
```

```shell
# cargo auditæ£€æŸ¥é¡¹ç›®çš„ä¾èµ–é¡¹æ˜¯å¦æœ‰ä»»ä½•å®‰å…¨æ¼æ´ï¼Œè¿™åœ¨æŒç»­é›†æˆä¸­ç‰¹åˆ«æœ‰ç”¨ã€‚
cargoÂ installÂ cargo-audit
```

```shell
# cargo tarpaulin æ˜¯å¦ä¸€ä¸ªå¯¹æŒç»­é›†æˆéå¸¸æœ‰ç”¨çš„æ’ä»¶ï¼Œè¿™ä¸ªæ’ä»¶è®¡ç®—é¡¹ç›®çš„ä»£ç è¦†ç›–ç‡ã€‚
cargoÂ installÂ cargo-tarpaulin
```

```shell
# cargo-nextest æ˜¯æ–°ä¸€ä»£çš„rustæµ‹è¯•ç¨‹åºï¼Œå®ƒæä¾›äº†æ¼‚äº®çš„æµ‹è¯•ç»“æœï¼Œç‰‡çŠ¶çš„æµ‹è¯•æ£€æµ‹ï¼Œå¹¶ä¸”åœ¨æŸäº›ä»£ç åº“ä¸Šå¯ä»¥å°†æµ‹è¯•è¿è¡Œé€Ÿåº¦æé«˜60å€ã€‚
cargoÂ installÂ cargo-nextest
```

```shell
# cargo-make æ˜¯rustçš„ä»»åŠ¡è¿è¡Œå™¨å’Œæ„å»ºå·¥å…·ï¼Œå®ƒå…è®¸ä½ å®šä¹‰ä¸€ç»„ä»»åŠ¡å¹¶åœ¨æµç¨‹ä¸­è¿è¡Œå®ƒä»¬ï¼Œä»»åŠ¡å¯ä»¥åœ¨tomlæ–‡ä»¶ä¸­å®šä¹‰ã€‚
cargoÂ installÂ cargo-make
```

### windowså®‰è£…æ–¹å¼
[å®‰è£…é¡µé¢](https://www.rust-lang.org/zh-CN/tools/install)
å‰ç½®ç¯å¢ƒï¼š[Microsoft C++æ„å»ºå·¥å…·]()
[ç‚¹æˆ‘ä¸‹è½½å®‰è£…åŒ…rustup.init.exe](https://static.rust-lang.org/rustup/dist/x86_64-pc-windows-msvc/rustup-init.exe)
é…ç½®ç¯å¢ƒå˜é‡ï¼š
![](readme.assets/Pasted%20image%2020230715203216.png)
é…ç½®æˆåŠŸåå¯ä»¥ç›´æ¥æŸ¥çœ‹rustç‰ˆæœ¬ï¼Œæ¥éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸã€‚
```
$ rustc --version
```

### Linux\\MacOså®‰è£…æ–¹å¼
ç›´æ¥è¾“å…¥ï¼Œå³å¯ä¸‹è½½å¹¶æ‰§è¡Œå®‰è£…è„šæœ¬ã€‚
```shell
$ curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```
é…ç½®ç¯å¢ƒå˜é‡
![](readme.assets/Pasted%20image%2020230715204534.png)
é€šè¿‡æŸ¥çœ‹rustç‰ˆæœ¬éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸã€‚


## åŸºæœ¬æŒ‡ä»¤
### æ£€æŸ¥rustç‰ˆæœ¬
```shell
$ rustc --version
```
### å¸è½½rust
```shell
$ rustup self uninstall
```
### å‡çº§rust
ç‰ˆæœ¬æ­£åœ¨å¿«é€Ÿè¿­ä»£ï¼Œéœ€è¦
```shell
$ rustup update
```
é‡åˆ°çš„é”™è¯¯ä¹‹ä¸€ï¼š
```
info: cleaning up downloads & tmp directories  
thread â€˜mainâ€™ panicked at â€˜Unable to clean up C:\Users\GrapeX.rustup\tmp: Os { code: 5, kind: PermissionDenied, message: â€œæ‹’ç»è®¿é—®ã€‚â€ }â€™, src\utils\utils.rs:650:13  
stack backtrace:  
note: Some details are omitted, run withÂ `RUST_BACKTRACE=full`Â for a verbose backtrace.
```
tmpæ— æ³•æ¸…é™¤ï¼Œç›®å‰æ²¡æœ‰æ­£åœ¨è¿è¡Œçš„rusté¡¹ç›®ï¼Œåº”å½“æ˜¯æœ‰å…¶å®ƒéœ€è¦rustçš„è¿›ç¨‹è¿˜åœ¨æ´»åŠ¨ï¼Œç»æ£€æŸ¥ vscode æ²¡å…³ï¼Œrust-analyzer è¿˜åœ¨æ´»åŠ¨ï¼Œåœæ­¢æ’ä»¶æˆ–å…³é—­vscodeå³å¯è§£å†³ã€‚

### é«˜çº§æŒ‡ä»¤
è¾¹ç”¨è¾¹è®°ã€‚

### Cargo
https://doc.rust-lang.org/cargo/index.html
- cargo build å¯ä»¥æ„å»ºé¡¹ç›®
- cargo run å¯ä»¥è¿è¡Œé¡¹ç›®
- cargo test å¯ä»¥æµ‹è¯•é¡¹ç›®
- cargo doc å¯ä»¥ä¸ºé¡¹ç›®æ„å»ºæ–‡æ¡£
- cargo publish å¯ä»¥å°†åº“å‘å¸ƒåˆ° crates.ioã€‚
- cargo --version

### Rustup

1. Rustå’ŒLLVMçš„å…³ç³»æ˜¯æ€æ ·çš„ï¼Ÿ

2. Rustupä¸­targetsæ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆå¯ä»¥å®‰è£…å¤šä¸ªï¼Ÿ

3. Ruståœ¨windowsä¸Šä¸ºä»€ä¹ˆéœ€è¦å®‰è£…Visual studioï¼Ÿ

4. Rustå·¥å…·é“¾æœ‰å“ªäº›å·¥å…·ï¼Ÿ

- rustup æ˜¯ä»€ä¹ˆï¼Ÿ

```sh
Rustupæ˜¯ Rust çš„å®˜æ–¹å·¥å…·é“¾ç®¡ç†å™¨ï¼Œå®ƒæä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹å¼æ¥å®‰è£…ã€ç®¡ç†å’Œåˆ‡æ¢ä¸åŒçš„Rustå·¥å…·é“¾ç‰ˆæœ¬ã€‚æ€»çš„æ¥è¯´æœ‰å¦‚ä¸‹èƒ½åŠ›ï¼š

1. å®‰è£… Rustï¼š

â€¢ rustup å…è®¸ä½ è½»æ¾åœ°å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ Rustï¼ŒåŒ…æ‹¬ç¨³å®šç‰ˆã€beta ç‰ˆå’Œ nightly ç‰ˆã€‚ rustup install stable

2. åˆ‡æ¢ Rust å·¥å…·é“¾ç‰ˆæœ¬ï¼š

â€¢ ä½ å¯ä»¥ä½¿ç”¨ rustup default å‘½ä»¤åˆ‡æ¢é»˜è®¤çš„ Rust ç‰ˆæœ¬ã€‚ rustup default stable

â€¢ ä¹Ÿå¯ä»¥åœ¨é¡¹ç›®çº§åˆ«ä½¿ç”¨ .rust-version æ–‡ä»¶æŒ‡å®šç‰¹å®šçš„ Rust ç‰ˆæœ¬ã€‚

3. ç®¡ç†ç›®æ ‡ï¼ˆTargetsï¼‰ï¼š

â€¢ rustup å…è®¸ä½ å®‰è£…ä¸åŒçš„ç›®æ ‡ï¼Œä»¥æ”¯æŒäº¤å‰ç¼–è¯‘å’Œåœ¨ä¸åŒçš„å¹³å°ä¸Šè¿è¡Œ Rust ä»£ç ã€‚ rustup target add <target>

â€¢ åˆ—å‡ºå·²å®‰è£…çš„ç›®æ ‡ï¼š rustup target list

4. å‡çº§ Rust å·¥å…·é“¾ç‰ˆæœ¬ï¼š

â€¢ ä½¿ç”¨ rustup update å‘½ä»¤å¯ä»¥å‡çº§å·²å®‰è£…çš„ Rust å·¥å…·é“¾ç‰ˆæœ¬ã€‚ rustup update

5. å¸è½½ Rustï¼š

â€¢ rustup å…è®¸ä½ å¸è½½ Rustï¼Œå¹¶æ¸…ç†ç›¸å…³çš„å·¥å…·é“¾å’Œç»„ä»¶ã€‚ rustup self uninstall

6. ç»„ä»¶ç®¡ç†ï¼š

â€¢ rustup å…è®¸ä½ å®‰è£…å’Œç®¡ç†ä¸åŒçš„ Rust ç»„ä»¶ï¼Œå¦‚ rust-srcã€rust-analysis ç­‰ã€‚ rustup component add rust-src

7. æŸ¥çœ‹å·¥å…·é“¾ä¿¡æ¯ï¼š

â€¢ ä½¿ç”¨ rustup show å‘½ä»¤å¯ä»¥æŸ¥çœ‹æœ‰å…³å½“å‰ Rust ç¯å¢ƒçš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å·²å®‰è£…çš„å·¥å…·é“¾ã€ç»„ä»¶ç­‰ã€‚ rustup show

é€šè¿‡ä¸Šé¢çš„å†…å®¹æˆ‘ä»¬çŸ¥é“äº†Rustupå¯ä»¥ç®¡ç†toolchainå’Œtargetï¼Œé‚£ä¹ˆtoolchainå’Œtargetç©¶ç«Ÿæ˜¯ä»€ä¹ˆå‘¢?

```

- å·¥å…·é“¾
```sh
toolchainæŒ‡ä¸€ç»„Rustå·¥å…·ï¼ŒåŒ…æ‹¬ç¼–è¯‘å™¨ï¼ˆrustcï¼‰ã€æ„å»ºå·¥å…·ï¼ˆcargoï¼‰ã€æ–‡æ¡£ç”Ÿæˆå·¥å…·ï¼ˆrustdocï¼‰ä»¥åŠå…¶ä»–ä¸ Rust ç›¸å…³çš„å®ç”¨ç¨‹åºã€‚Toolchainç”¨äºç®¡ç†å’Œæ„å»º Rust ä»£ç ï¼Œå¹¶ä¸”å¯ä»¥åŒ…æ‹¬ä¸€ä¸ªç‰¹å®šç‰ˆæœ¬çš„ Rust ç¼–è¯‘å™¨å’Œæ ‡å‡†åº“ï¼Œè¿˜åŒ…å«ä¸€ä¸ªé»˜è®¤æ˜¯ç¼–è¯‘åˆ°æœ¬æœºå¹³å°çš„targetã€‚å·¥å…·é“¾çš„ç‰ˆæœ¬å¯ä»¥æ˜¯ "stable"ï¼ˆç¨³å®šç‰ˆï¼‰ã€"beta"ï¼ˆæµ‹è¯•ç‰ˆï¼‰æˆ– "nightly"ï¼ˆæ¯æ—¥æ„å»ºç‰ˆï¼‰ï¼Œæ¯ä¸ªç‰ˆæœ¬éƒ½å¯¹åº”ç€ä¸åŒçš„ Rust ç¼–è¯‘å™¨å’Œç‰¹æ€§ã€‚

ä¸‹é¢è¿™äº›å¸¸ç”¨çš„å‘½ä»¤å¯ä»¥æ“ä½œå·¥å…·é“¾ï¼š

# å®‰è£…æ–°çš„toolchain
rustup install stable
# è®¾ç½®é»˜è®¤çš„toolchain
rustup default stable
# åˆ—å‡ºå·²ç»å®‰è£…çš„toolchain
rustup toolchain list
# æ›´æ–°åˆ°æœ€æ–°ç¨³å®šç‰ˆ
rustup update stable
# æ›´æ–°åˆ°æŒ‡å®šç‰ˆæœ¬
rustup update <version>
# æ˜¾ç¤ºtoolchainå’Œtargets
rustup show
ä¸‹é¢è¿™äº›å°±æ˜¯å·¥å…·é“¾ä¸­çš„å·¥å…·å‘½ä»¤äº†ï¼Œå®ƒä»¬é€šå¸¸å­˜å‚¨åœ¨~/.cargo/binè¿™ä¸ªç›®å½•ä¸‹ã€‚

1. rustc: Rustç¼–è¯‘å™¨ï¼Œè´Ÿè´£å°†Rustæºä»£ç ç¼–è¯‘ä¸ºæœºå™¨ç ã€‚å®ƒæ˜¯Rustçš„ä¸»è¦ç¼–è¯‘å™¨ï¼Œä¹Ÿæ˜¯æ„å»ºRustç¨‹åºçš„å…³é”®ç»„ä»¶ã€‚

2. Cargo: Rustçš„æ„å»ºç³»ç»Ÿå’ŒåŒ…ç®¡ç†å™¨ã€‚Cargoç®€åŒ–äº†é¡¹ç›®çš„åˆ›å»ºã€ä¾èµ–ç®¡ç†å’Œæ„å»ºè¿‡ç¨‹ã€‚å®ƒè¿˜æä¾›äº†ä¸€ç»„å‘½ä»¤ç”¨äºæ„å»ºã€è¿è¡Œæµ‹è¯•ã€å‘å¸ƒå’Œå®‰è£…Rustç¨‹åºã€‚

3. rustdoc: Rustçš„æ–‡æ¡£ç”Ÿæˆå·¥å…·ã€‚é€šè¿‡ä½¿ç”¨ç‰¹å®šçš„æ³¨é‡Šæ ¼å¼ï¼Œrustdocèƒ½å¤Ÿç”Ÿæˆæ¼‚äº®çš„æ–‡æ¡£ï¼Œå¸®åŠ©å¼€å‘è€…ç¼–å†™å’Œç»´æŠ¤æ–‡æ¡£ã€‚

4. rustfmt: ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œç”¨äºä¿æŒRustä»£ç çš„ä¸€è‡´æ€§å’Œå¯è¯»æ€§ã€‚å®ƒèƒ½å¤Ÿæ ¼å¼åŒ–ä»£ç ï¼Œä½¿å…¶ç¬¦åˆRustè¯­è¨€çš„çº¦å®šã€‚

5. rustup: Rustçš„å·¥å…·é“¾ç®¡ç†å™¨ï¼Œç”¨äºå®‰è£…ã€å‡çº§å’Œç®¡ç†Rustçš„ä¸åŒç‰ˆæœ¬ã€‚å®ƒè¿˜å…è®¸ä½ åˆ‡æ¢é»˜è®¤çš„Rustç‰ˆæœ¬ï¼Œä»¥é€‚åº”é¡¹ç›®çš„éœ€æ±‚ã€‚

6. rls (Rust Language Server): æä¾›äº†ä¸IDEï¼ˆé›†æˆå¼€å‘ç¯å¢ƒï¼‰é›†æˆæ‰€éœ€çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ä»£ç è¡¥å…¨ã€è·³è½¬åˆ°å®šä¹‰ã€æŸ¥æ‰¾å¼•ç”¨ç­‰ã€‚æ”¯æŒçš„IDEåŒ…æ‹¬Visual Studio Codeã€Atomç­‰ã€‚

7. cargo-make: ç”¨äºåˆ›å»ºå’Œè¿è¡Œè‡ªå®šä¹‰æ„å»ºä»»åŠ¡çš„å·¥å…·ã€‚å®ƒå…è®¸å¼€å‘è€…åœ¨æ„å»ºè¿‡ç¨‹ä¸­æ‰§è¡Œè‡ªå®šä¹‰çš„å‘½ä»¤å’Œè„šæœ¬ã€‚

8. miri: Rustçš„Mir Interpreterï¼Œç”¨äºæ‰§è¡Œå’Œæµ‹è¯•Rustç¨‹åºåœ¨MIRï¼ˆMid-level Intermediate Representationï¼‰çº§åˆ«çš„ä»£ç ã€‚Miriæœ‰åŠ©äºæ£€æµ‹ä¸€äº›å¯èƒ½çš„å†…å­˜å®‰å…¨é—®é¢˜ã€‚

è¿™åªæ˜¯Rustå·¥å…·é“¾ä¸­çš„ä¸€éƒ¨åˆ†å·¥å…·ã€‚Rustç¤¾åŒºç§¯æå‘å±•å’Œç»´æŠ¤å·¥å…·é“¾ï¼Œä»¥æé«˜å¼€å‘è€…çš„å·¥ä½œæ•ˆç‡ï¼Œå¹¶ç¡®ä¿Rustä»£ç çš„è´¨é‡å’Œå®‰å…¨æ€§ã€‚ä½ å¯ä»¥é€šè¿‡æŸ¥é˜…Rustå®˜æ–¹æ–‡æ¡£æˆ–ä½¿ç”¨cargo --listå‘½ä»¤æŸ¥çœ‹å®Œæ•´çš„å·¥å…·åˆ—è¡¨ã€‚

```

- è·¨å¹³å°å¼€å‘å’Œäº¤å‰ç¼–è¯‘
```sh
Rust ä¸­çš„targetæ¦‚å¿µä¸»è¦æ˜¯ä¸ºäº†æ”¯æŒè·¨å¹³å°å¼€å‘å’Œäº¤å‰ç¼–è¯‘ï¼Œä»¥ç¡®ä¿ Rust ä»£ç å¯ä»¥åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿå’Œæ¶æ„ä¸Šæ­£ç¡®è¿è¡Œã€‚Rustc targetæŒ‡çš„æ˜¯ç¼–è¯‘å’Œæ„å»ºç›®æ ‡å¹³å°Rustä»£ç æ—¶éœ€è¦çš„ç»„ä»¶ã€‚ä¸è¦æ··æ·†ä¸ºRusté¡¹ç›®ç¼–è¯‘åäº§ç”Ÿçš„targetæ–‡ä»¶å¤¹ã€‚å®ƒçš„æ ¼å¼è¡¨ç¤ºä¸ºï¼š<arch>-<vendor>-<sys>-<abi>ã€‚å…¶ä¸­ï¼š

â€¢ <arch> è¡¨ç¤ºæ¶æ„ï¼ˆä¾‹å¦‚ï¼Œx86_64 è¡¨ç¤º 64 ä½çš„ x86 æ¶æ„ï¼‰ã€‚

â€¢ <vendor> è¡¨ç¤ºä¾›åº”å•†ï¼ˆä¸€èˆ¬ä¸ºç©ºï¼‰ã€‚

â€¢ <sys> è¡¨ç¤ºæ“ä½œç³»ç»Ÿï¼ˆä¾‹å¦‚ï¼Œlinuxã€windowsã€macos ç­‰ï¼‰ã€‚

â€¢ <abi> è¡¨ç¤ºäºŒè¿›åˆ¶æ¥å£ï¼ˆä¾‹å¦‚ï¼Œé»˜è®¤çš„æ˜¯ "gnu"ï¼Œä¹Ÿå¯ä»¥æ˜¯ "musl"ã€"msvc" ç­‰ï¼‰ã€‚

ç¤ºä¾‹ï¼š

â€¢ x86_64-unknown-linux-gnu: 64ä½ x86 æ¶æ„ï¼ŒLinux æ“ä½œç³»ç»Ÿã€‚

â€¢ i686-pc-windows-msvc: 32ä½ x86 æ¶æ„ï¼ŒWindows æ“ä½œç³»ç»Ÿï¼Œä½¿ç”¨ MSVC ç¼–è¯‘å™¨ã€‚

â€¢ aarch64-apple-ios: 64ä½ ARM æ¶æ„ï¼ŒiOS æ“ä½œç³»ç»Ÿã€‚

â€¢ wasm32-unknown-unknown: WebAssembly ç›®æ ‡ã€‚

ä¸€èˆ¬æ¥è¯´åªéœ€è¦rustup target add å‘½ä»¤å®‰è£…æŸä¸ªç›®æ ‡å¹³å°ç»„ä»¶å³å¯ï¼Œä½†å¯¹äºä¸€äº›ç‰¹æ®Šå¹³å°ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨å®‰è£…ç›¸å…³çš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼Œä¾‹å¦‚windows msvcæˆ–è€…android NDKã€‚

ä¸‹é¢æ˜¯æ“ä½œTargetå¸¸ç”¨çš„å‘½ä»¤ï¼š

# åˆ—å‡ºå¯ç”¨çš„target
rustup target list
# å®‰è£…ä¸€ä¸ªæ–°çš„rustup target add <target>
rustup target add x86_64-unknown-linux-gnu
# æŠŠä»£ç ç¼–è¯‘åˆ°æŒ‡å®šå¹³å°
cargo build --target x86_64-unknown-linux-gnu
â€¢ å®‰è£…æ–°ç›®æ ‡ï¼šrustup target add <target>

â€¢ åˆ—å‡ºå·²å®‰è£…çš„ç›®æ ‡ï¼šrustup target list

æˆ‘åœ¨åˆå­¦rustæ—¶ï¼Œå°±ç»å¸¸æ··æ·†toolchainå’Œtargetã€‚ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†targetæ˜¯toolchainçš„ä¸€éƒ¨åˆ†ï¼Œç¼–è¯‘åˆ°ç‰¹å®šç›®æ ‡å¹³å°è¦ä½¿ç”¨å¯¹åº”ç›®æ ‡å¹³å°çš„targetã€‚
```

- Rustç¼–è¯‘å™¨ä¸­çš„LLVMã€MSVCã€GNU
```sh
ä½ å¯èƒ½å¬è¯´è¿‡Rustç¼–è¯‘å™¨åç«¯ä½¿ç”¨äº†LLVMï¼Œé‚£ä¸ºä½•è¿˜éœ€è¦msvcå’Œgnuå‘¢ï¼Œä¸ºå•¥Goå’ŒJavaè¿™äº›è¯­è¨€ä¸éœ€è¦å‘¢ï¼Ÿé‚£æˆ‘ä»¬æ¥ç†ä¸€ä¸‹Rustç¼–è¯‘è¿‡ç¨‹ä½ å°±æ¸…æ¥šäº†ã€‚

Rustç¼–è¯‘å™¨å®é™…ä¸Šæ˜¯ç”±å¤šä¸ªç»„ä»¶ç»„æˆçš„ï¼Œå…¶ä¸­ä¹‹ä¸€æ˜¯â€œrustcâ€åšä¸ºå‰ç«¯ç¼–è¯‘å™¨ï¼Œè€Œç¼–è¯‘å™¨çš„åç«¯ä½¿ç”¨äº†LLVMã€‚

1. å‰ç«¯ç¼–è¯‘å™¨ï¼ˆrustcï¼‰ï¼š è¿™ä¸€éƒ¨åˆ†è´Ÿè´£å°†Rustæºä»£ç è½¬æ¢ä¸ºä¸­é—´è¡¨ç¤ºï¼ˆIntermediate Representationï¼ŒIRï¼‰ï¼Œè¯¥è¡¨ç¤ºå½¢å¼åœ¨Rustä¸­ç§°ä¸ºâ€œMIRâ€ï¼ˆMid-level Intermediate Representationï¼‰ã€‚

2. åç«¯ç¼–è¯‘å™¨ï¼ˆLLVMï¼‰ï¼š MIRç„¶åè¢«ä¼ é€’ç»™LLVMï¼ŒLLVMæ˜¯ä¸€ä¸ªå¼€æºçš„ç¼–è¯‘å™¨åŸºç¡€è®¾æ–½ï¼Œæä¾›äº†è®¸å¤šé€šç”¨çš„ä¼˜åŒ–å’Œä»£ç ç”Ÿæˆå·¥å…·ã€‚LLVMå°†MIRè½¬æ¢ä¸ºç›®æ ‡æœºå™¨çš„æœºå™¨ç ï¼Œå¹¶æ‰§è¡Œä¸€ç³»åˆ—ä¼˜åŒ–ï¼Œä»¥ç”Ÿæˆæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚

ä»¥Windowså¹³å°ä¸ºä¾‹ï¼ŒRustç¼–è¯‘å™¨å°±æ˜¯rustc.exeï¼Œå®ƒé¦–å…ˆä¼šæŠŠæºç ç¼–è¯‘ä¸ºMIRï¼Œç„¶åäº¤ç»™LLVMå¤„ç†ï¼ŒLLVMç»§ç»­æŠŠMIRå…ˆç¼–è¯‘æˆLLVM IRè¿›è€Œç¼–è¯‘ä¸ºç›®æ ‡å¹³å°çš„æœºå™¨ç ï¼ˆæ­¤æ—¶è¿˜ä¸æ˜¯æ‰§è¡Œæ–‡ä»¶ï¼Œåªæ˜¯ä¸€å †æœºå™¨ç ï¼‰ã€‚å¾€åå°±æ˜¯targetå‘æŒ¥ä½œç”¨äº†ï¼Œtargetè°ƒç”¨msvcæˆ–gnuæ¥å®Œæˆé“¾æ¥æ­¥éª¤ï¼Œä¸»è¦æ˜¯é“¾æ¥ç›®æ ‡å¹³å°åº“æ–‡ä»¶å¹¶ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿™é‡Œæ•´ä¸ªç¼–è¯‘è¿‡ç¨‹å‡ ä¹éƒ½æ˜¯ç”±rustc.exeå®Œæˆçš„ï¼Œå› ä¸ºå®ƒåŒ…å«äº†llvmå’Œè°ƒç”¨targetçš„ä»£ç ï¼Œè·Ÿç›®æ ‡å¹³å°ç›¸å…³çš„å·¥ä½œåˆ™æ˜¯ç”±msvcæˆ–gnuæ¥å®Œæˆã€‚msvcå’Œgnuæ˜¯c/c++çš„ç¼–è¯‘å·¥å…·é“¾ï¼Œç¼–è¯‘åçš„æœ€ç»ˆäº§ç‰©å°±æ˜¯å¯æ‰§è¡Œæ–‡ä»¶æˆ–åº“ï¼Œrustcåœ¨ç¼–è¯‘åæœŸç”¨åˆ°äº†å®ƒä»¬æä¾›çš„åŠŸèƒ½ã€‚

æ•´ä¸ªç¼–è¯‘è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š

Source code -> MIR -> LLVM IR -> æœºå™¨ç  -> Targeté“¾æ¥ -> å¯æ‰§è¡Œæ–‡ä»¶æˆ–åº“

Goç¼–è¯‘å™¨æ˜¯è‡ªå·±å®ç°äº†é“¾æ¥ç›®æ ‡å¹³å°çš„å·¥ä½œï¼Œå› æ­¤ä¸éœ€è¦msvcæˆ–gnuã€‚Javaä¹Ÿæ˜¯ç±»ä¼¼ï¼Œæ‰€æœ‰çš„åº•å±‚å·¥ä½œéƒ½æ˜¯Javaè™šæ‹Ÿæœºå®ç°çš„ï¼Œjavacä»…ä»…æ˜¯æŠŠæºç ç¼–è¯‘æˆclasså­—èŠ‚ç å°±ç»“æŸäº†ã€‚
```

### VScodeç¼–è¾‘å™¨é…ç½®
https://code.visualstudio.com/docs/languages/rust

## å…¥é—¨

### Hello Rustï¼
### åˆ›å»ºæ–°é¡¹ç›®
```shell
cargo new learning
```
![](readme.assets/Pasted%20image%2020230715211915.png)
### æ„å»ºäºŒè¿›åˆ¶æ–‡ä»¶
ä¸åŒçš„ç³»ç»Ÿï¼Œæ„å»ºçš„å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¸åŒã€‚
```shell
cargo build
```
![](readme.assets/Pasted%20image%2020230715213137.png)
ç›®å½•è§£æ

### æ‰§è¡Œä¸»å‡½æ•°
![](readme.assets/Pasted%20image%2020230715213623.png)
æœ‰æ„æ€çš„åœ°æ–¹æ¥äº†ã€‚
å½“ä½ æ‰§è¡Œcargo runæ—¶ï¼Œä¼šé»˜è®¤æ‰§è¡Œcargo buildï¼Œç„¶åæ‰§è¡Œexeè„šæœ¬ã€‚
```shell
cargo run
```
![](readme.assets/Pasted%20image%2020230715213927.png)
### æ·»åŠ ä¸‰æ–¹ä¾èµ–

![](readme.assets/Pasted%20image%2020230715214130.png)
å‘ï¼
```
ä¾èµ–åº“çš„ç‰ˆæœ¬é—®é¢˜çœŸçš„ä¼šå¯¼è‡´å¾ˆå¤šå¼‚å¸¸å’Œé”™è¯¯ã€‚
```
å†æ¬¡runï¼Œä¼šè‡ªåŠ¨å®‰è£…ä¾èµ–ã€‚
![](readme.assets/Pasted%20image%2020230715215627.png)
```rust
use ferris_says::say;

use std::io::{stdout, BufWriter};

// å¼•å…¥åŒ…ï¼Œå¹¶ä¸”å¯¼å…¥sayå‡½æ•°

  

fn test_says() {

Â  Â  let stdout: std::io::Stdout = stdout();

Â  Â  let message: &str = "Hello fellow Rustaceans!";

Â  Â  let width: usize = message.chars().count();

  

Â  Â  let mut writer: BufWriter<std::io::StdoutLock<'_>> = BufWriter::new(stdout.lock());

Â  Â  say(message, width, &mut writer).unwrap();

}

  

fn main() {

Â  Â  println!("Hello, Rust!");

Â  Â  test_says()

}
```

ç„¶åæˆ‘ä»¬å‰ç¥¥ç‰©å°±å‡ºæ¥äº†ã€‚
![](readme.assets/Pasted%20image%2020230715215843.png)
### vscodeçš„ç®€å•é…ç½®
#### SettingåŸºæœ¬é…ç½®
```json
{

Â  // è‡ªåŠ¨æ£€æŸ¥æ–‡ä»¶ç¼–ç 

Â  "editor.detectIndentation": true,

Â  // è®¾ç½®ç¼©è¿›

Â  "editor.insertSpaces": true,

Â  "editor.tabSize": 4,

Â  // æ–‡ä»¶é»˜è®¤ç¼–ç æ ¼å¼

Â  "files.encoding": "utf8",

Â  // è‡ªåŠ¨ä¿å­˜

Â  "files.autoSave": "onFocusChange",

Â  // ä¿å­˜æ—¶æ ¼å¼åŒ–

Â  "editor.formatOnSave": true,

Â  // ç²˜è´´æ—¶æ ¼å¼åŒ–

Â  "editor.formatOnPaste": true,

Â  // è¾¹å†™è¾¹æ ¼å¼

Â  "editor.formatOnType": true,

Â  "editor.fontFamily": "Fira Code", //åè¾¹çš„å¼•å·ä¸­å†™ä¸Šè¦è®¾ç½®çš„å­—ä½“ç±»å‹ï¼Œä¸ªäººæ¯”è¾ƒå–œæ¬¢Fira Code

Â  "editor.fontLigatures": true, //è¿™ä¸ªæ§åˆ¶æ˜¯å¦å¯ç”¨å­—ä½“è¿å­—ï¼Œtrueå¯ç”¨ï¼Œfalseä¸å¯ç”¨ï¼Œè¿™é‡Œé€‰æ‹©å¯ç”¨

Â  "editor.fontSize": 14, //è®¾ç½®å­—ä½“å¤§å°ï¼Œè¿™ä¸ªä¸å¤šè¯´éƒ½æ˜ç™½

Â  "editor.fontWeight": "normal", //è¿™ä¸ªè®¾ç½®å­—ä½“ç²—ç»†ï¼Œå¯é€‰normal,bold,"100"~"900"ç­‰ï¼Œé€‰æ‹©åˆé€‚çš„å°±è¡Œ

Â  "editor.wordWrapColumn": 255,

Â  "files.autoGuessEncoding": true,

Â  // å¼€å¯è‡ªåŠ¨æ¢è¡Œ

Â  "editor.wordWrap": "on",

Â  // æ›´æ”¹è¡Œå·é¢œè‰²

Â  "workbench.colorCustomizations": {

Â  Â  "editorLineNumber.foreground": "#daa520"

Â  },

Â  // å¼€å¯rustæ’ä»¶ï¼Œä»£ç ç°å—æç¤ºã€‚

Â  "editor.inlayHints.enabled": "on",

Â  // todo è¯­æ„è¯­æ³•æç¤ºå—ï¼Œé«˜äº®

Â  "editor.semanticTokenColorCustomizations": {

Â  Â  "rules": {

Â  Â  Â  "*.mutable": {

Â  Â  Â  Â  "fontStyle": ""

Â  Â  Â  },

Â  Â  }

Â  },

}
```
#### Launchè°ƒè¯•
è¦å¼€å§‹è°ƒè¯•ï¼Œæ‚¨é¦–å…ˆéœ€è¦å®‰è£…å…·æœ‰è°ƒè¯•æ”¯æŒçš„ä¸¤ç§è¯­è¨€æ‰©å±•ä¹‹ä¸€ï¼š

- [Microsoft C++](https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools)Â (ms-vscode.cpptools) â€“_åœ¨ Windows ä¸Š_
- [CodeLLDB](https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb)Â (vadimcn.vscode-lldb) â€“_åœ¨ macOS/Linux ä¸Š_

å¦‚æœæ‚¨å¿˜è®°å®‰è£…è¿™äº›æ‰©å±•ä¹‹ä¸€ï¼Œå½“æ‚¨å°è¯•å¯åŠ¨è°ƒè¯•ä¼šè¯æ—¶ï¼Œrust-analyzer å°†æä¾›ä¸€æ¡é€šçŸ¥ï¼Œå…¶ä¸­åŒ…å« VS Code Marketplace çš„é“¾æ¥ã€‚

è®¾ç½®æ–­ç‚¹, é€‰æ‹©è°ƒè¯•å™¨ã€‚
![](readme.assets/Pasted%20image%2020230715222428.png)
![](readme.assets/Pasted%20image%2020230715222636.png)
```json
{
    // ä½¿ç”¨ IntelliSense äº†è§£ç›¸å…³å±æ€§ã€‚ 
    // æ‚¬åœä»¥æŸ¥çœ‹ç°æœ‰å±æ€§çš„æè¿°ã€‚
    // æ¬²äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®: https://go.microsoft.com/fwlink/?linkid=830387
    "version": "0.2.0",
    "configurations": [
        {
            // windowsä¸Š ä½¿ç”¨ cppvsdbg
            "type": "cppvsdbg",
            // é™„åŠ 
            "request": "launch",
            // è°ƒè¯•å™¨å
            "name": "(windows)rustRun",
            // ä¸€èˆ¬æ‰§è¡Œä»£ç éƒ½åœ¨è¿™é‡Œsrc/main.rsï¼Œè¿™ä¸ªä½ç½®ç›¸å¯¹å¼•ç”¨æ›´å¥½äº›
            // D:\RustCode\learning\target\debug\learning.exe
            "program": "${fileWorkspaceFolder}/${input:currentProjectName}/target/debug/${input:currentProjectName}.exe",
            // ç”¨äºæŸ¥æ‰¾ä¾èµ–é¡¹å’Œå…¶ä»–æ–‡ä»¶çš„å½“å‰å·¥ä½œç›®å½•
            "cwd": "${workspaceFolder}",
            // ä½¿ç”¨vscodeé›†æˆç»ˆç«¯
            // "console": "integratedTerminal",
            // rsæ–‡ä»¶è°ƒè¯•å‰ï¼Œæ‰§è¡Œçš„ä»»åŠ¡
            "preLaunchTask": "build",
        },
        {
            // linux/macä¸Šï¼Œè®°å¾—ä½¿ç”¨ lldb
            "type": "lldb",
            // é™„åŠ 
            "request": "launch",
            // è°ƒè¯•å™¨å
            "name": "(OSX)rustRun",
            // ä¸€èˆ¬æ‰§è¡Œä»£ç éƒ½åœ¨è¿™é‡Œsrc/main.rsï¼Œè¿™ä¸ªä½ç½®ç›¸å¯¹å¼•ç”¨æ›´å¥½äº›
            // D:\RustCode\learning\target\debug\learning.exe
            "program": "${fileWorkspaceFolder}/${input:currentProjectName}/target/debug/${input:currentProjectName}",
            // ç”¨äºæŸ¥æ‰¾ä¾èµ–é¡¹å’Œå…¶ä»–æ–‡ä»¶çš„å½“å‰å·¥ä½œç›®å½•
            "cwd": "${workspaceFolder}",
            // ä½¿ç”¨vscodeé›†æˆç»ˆç«¯
            // "console": "integratedTerminal",
            // rsæ–‡ä»¶è°ƒè¯•å‰ï¼Œæ‰§è¡Œçš„ä»»åŠ¡
            "preLaunchTask": "build",
        }
    ],
    "inputs": [
        {
            // ç”¨æˆ·è¾“å…¥idçš„å†…å®¹ï¼Œç”¨åœ¨program
            "id": "currentProjectName",
            // PromptStringï¼šæ˜¾ç¤ºä¸€ä¸ªè¾“å…¥æ¡†ä»¥ä»ç”¨æˆ·å¤„è·å–å­—ç¬¦ä¸²ã€‚
            // pickStringï¼šæ˜¾ç¤ºå¿«é€Ÿé€‰æ‹©ä¸‹æ‹‰åˆ—è¡¨ï¼Œè®©ç”¨æˆ·ä»å¤šä¸ªé€‰é¡¹ä¸­è¿›è¡Œé€‰æ‹©ã€‚
            // commandï¼šè¿è¡Œä»»æ„å‘½ä»¤ã€‚
            "type": "promptString",
            // æç¤ºè¾“å…¥
            "description": "é€‰æ‹©ä½ è¦è°ƒè¯•å¯æ‰§è¡Œæ–‡ä»¶",
            // é»˜è®¤æ˜¯learning.exe
            "default": "learning",
            // ä¸éšè—
            "password": false
        },
    ]
}
```
#### Tasksæ„å»ºä»»åŠ¡
```json
{
    "version": "2.0.0",
    "tasks": [
        {
            // è°ƒè¯•å‰ï¼Œå…ˆæ„å»ºä¸€é
            "label": "build",
            "type": "shell",
            "command": "cargo build",
            // å¯èƒ½éœ€è¦ç»™ cargo build èµ‹äºˆå‚æ•°ï¼Œ
            "args": [],
            "options": {
                "cwd": "${fileDirname}"
            }
        },
    ],
}
```

### æ•™ç¨‹ç‰ˆ
è·Ÿéšç½‘ç»œçš„æ•™ç¨‹å¼€å§‹å­¦ä¹ ã€‚
https://www.rust-lang.org/zh-CN/learn
```
Rust ç¨‹åºè®¾è®¡è¯­è¨€çš„æœ¬è´¨å®é™…åœ¨äº èµ‹èƒ½ï¼ˆempowermentï¼‰ï¼šæ— è®ºä½ ç°åœ¨ç¼–å†™çš„æ˜¯ä½•ç§ä»£ç ï¼ŒRust èƒ½è®©ä½ åœ¨æ›´ä¸ºå¹¿æ³›çš„ç¼–ç¨‹é¢†åŸŸèµ°å¾—æ›´è¿œï¼Œå†™å‡ºè‡ªä¿¡ã€‚ï¼ˆè¿™ä¸€ç‚¹å¹¶ä¸æ˜¾è€Œæ˜“è§ï¼‰

ä¸¾ä¾‹æ¥è¯´ï¼Œé‚£äº›â€œç³»ç»Ÿå±‚é¢â€çš„å·¥ä½œæ¶‰åŠå†…å­˜ç®¡ç†ã€æ•°æ®è¡¨ç¤ºå’Œå¹¶å‘ç­‰åº•å±‚ç»†èŠ‚ã€‚ä»ä¼ ç»Ÿè§’åº¦æ¥çœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªç¥ç§˜çš„ç¼–ç¨‹é¢†åŸŸï¼Œåªä¸ºæµ¸æ¶¦å¤šå¹´çš„æå°‘æ•°äººæ‰€è§¦åŠï¼Œä¹Ÿåªæœ‰ä»–ä»¬èƒ½é¿å¼€é‚£äº›è‡­åæ˜­è‘—çš„é™·é˜±ã€‚å³ä½¿è°¨æ…çš„å®è·µè€…ï¼Œäº¦å”¯æä»£ç å‡ºç°æ¼æ´ã€å´©æºƒæˆ–æŸåã€‚

Rust ç ´é™¤äº†è¿™äº›éšœç¢ï¼šå®ƒæ¶ˆé™¤äº†æ—§çš„é™·é˜±ï¼Œå¹¶æä¾›äº†ä¼´ä½ ä¸€è·¯åŒè¡Œçš„å‹å¥½ã€ç²¾è‰¯çš„å·¥å…·ã€‚æƒ³è¦ â€œæ·±å…¥â€ åº•å±‚æ§åˆ¶çš„ç¨‹åºå‘˜å¯ä»¥ä½¿ç”¨ Rustï¼Œæ— éœ€æ—¶åˆ»æ‹…å¿ƒå‡ºç°å´©æºƒæˆ–å®‰å…¨æ¼æ´ï¼Œä¹Ÿæ— éœ€å› ä¸ºå·¥å…·é“¾ä¸é è°±è€Œè¢«è¿«å»äº†è§£å…¶ä¸­çš„ç»†èŠ‚ã€‚æ›´å¦™çš„æ˜¯ï¼Œè¯­è¨€è®¾è®¡æœ¬èº«ä¼šè‡ªç„¶è€Œç„¶åœ°å¼•å¯¼ä½ ç¼–å†™å‡ºå¯é çš„ä»£ç ï¼Œå¹¶ä¸”è¿è¡Œé€Ÿåº¦å’Œå†…å­˜ä½¿ç”¨ä¸Šéƒ½ååˆ†é«˜æ•ˆã€‚

å·²ç»åœ¨ä»äº‹ç¼–å†™åº•å±‚ä»£ç çš„ç¨‹åºå‘˜å¯ä»¥ä½¿ç”¨ Rust æ¥æå‡ä¿¡å¿ƒã€‚ä¾‹å¦‚ï¼Œåœ¨ Rust ä¸­å¼•å…¥å¹¶è¡Œæ˜¯ç›¸å¯¹ä½é£é™©çš„æ“ä½œï¼Œå› ä¸ºç¼–è¯‘å™¨ä¼šæ›¿ä½ æ‰¾åˆ°ç»å…¸çš„é”™è¯¯ã€‚åŒæ—¶ä½ å¯ä»¥è‡ªä¿¡åœ°é‡‡å–æ›´åŠ æ¿€è¿›çš„ä¼˜åŒ–ï¼Œè€Œä¸ä¼šæ„å¤–å¼•å…¥å´©æºƒæˆ–æ¼æ´ã€‚

ä½† Rust å¹¶ä¸å±€é™äºåº•å±‚ç³»ç»Ÿç¼–ç¨‹ã€‚å®ƒè¡¨è¾¾åŠ›å¼ºã€å†™èµ·æ¥èˆ’é€‚ï¼Œè®©äººèƒ½å¤Ÿè½»æ¾åœ°ç¼–å†™å‡ºå‘½ä»¤è¡Œåº”ç”¨ã€ç½‘ç»œæœåŠ¡å™¨ç­‰å„ç§ç±»å‹çš„ä»£ç â€”â€”åœ¨æœ¬ä¹¦ä¸­å°±æœ‰è¿™ä¸¤è€…çš„ç®€å•ç¤ºä¾‹ã€‚ä½¿ç”¨ Rust èƒ½è®©ä½ æŠŠåœ¨ä¸€ä¸ªé¢†åŸŸä¸­å­¦ä¹ çš„æŠ€èƒ½å»¶ä¼¸åˆ°å¦ä¸€ä¸ªé¢†åŸŸï¼šä½ å¯ä»¥é€šè¿‡ç¼–å†™ç½‘é¡µåº”ç”¨æ¥å­¦ä¹  Rustï¼Œæ¥ç€å°†åŒæ ·çš„æŠ€èƒ½åº”ç”¨åˆ°ä½ çš„ Raspberry Piï¼ˆæ ‘è“æ´¾ï¼‰ä¸Šã€‚
```
ä½¿ç”¨rustæ„å»ºç¨³å¥å¯é çš„åº•å±‚ç³»ç»Ÿ
```
Rust ä¹Ÿä¸ºç³»ç»Ÿç¼–ç¨‹ä¸–ç•Œå¸¦æ¥äº†ç°ä»£åŒ–çš„å¼€å‘å·¥å…·ï¼š

Cargo æ˜¯å†…ç½®çš„ä¾èµ–ç®¡ç†å™¨å’Œæ„å»ºå·¥å…·ï¼Œå®ƒèƒ½è½»æ¾å¢åŠ ã€ç¼–è¯‘å’Œç®¡ç†ä¾èµ–ï¼Œå¹¶ä½¿ä¾èµ–åœ¨ Rust ç”Ÿæ€ç³»ç»Ÿä¸­ä¿æŒä¸€è‡´ã€‚
Rustfmt æ ¼å¼åŒ–å·¥å…·ç¡®ä¿å¼€å‘è€…éµå¾ªä¸€è‡´çš„ä»£ç é£æ ¼ã€‚
Rust Language Server ä¸ºé›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDEï¼‰æä¾›äº†å¼ºå¤§çš„ä»£ç è¡¥å…¨å’Œå†…è”é”™è¯¯ä¿¡æ¯åŠŸèƒ½ã€‚
é€šè¿‡ä½¿ç”¨ Rust ç”Ÿæ€ç³»ç»Ÿä¸­ä¸°å¯Œçš„å·¥å…·ï¼Œå¼€å‘è€…å¯ä»¥æ›´é«˜æ•ˆåœ°ç¼–å†™ç³»ç»Ÿå±‚é¢ä»£ç ã€‚
```
#### çŒœå­—æ¸¸æˆ
main.rs
```rust
// å¯¼å…¥åº“

use ferris_says::say;

use std::io::{stdout, BufWriter};

// å¯¼å…¥è‡ªå·±åŒ…ï¼Œå…ˆå£°æ˜åŒçº§ç›®å½•ä¸‹çš„rsæ–‡ä»¶

// ç§æœ‰æ¨¡å—å£°æ˜

mod game;

// å…±æœ‰æ¨¡å—å£°æ˜

// pub mod game;

  

// è¿™æ˜¯ç›¸å¯¹è·¯å¾„

use game::{g, test};

// åªå¼•ç”¨ä¸€ä¸ªå‡½æ•°

// use game::g;

// ç»å¯¹è·¯å¾„å¼•å…¥ï¼Œè¿™æ˜¯æ ¹è·¯å¾„

// use crate::game::test;

  

fn test_says() {

let stdout: std::io::Stdout = stdout();

let message: &str = "Hello fellow Rustaceans!";

let width: usize = message.chars().count();

  

let mut writer: BufWriter<std::io::StdoutLock<'_>> = BufWriter::new(stdout.lock());

say(message, width, &mut writer).unwrap();

}

  

// !ä¸»ç¨‹åºå…¥å£å‡½æ•°

fn main() {

// æ‰“å°

// println!("Hello, Rust!");

// æµ‹è¯•å‡½æ•°

// test_says();

// æµ‹è¯•å¯¼åŒ…

g();

}

```
game.rs
```rust
// å½“å‰å­æ¨¡å—å‚æ•°ï¼Œå¯¹è±¡ï¼Œæ–¹æ³•ç­‰å…¨æš´éœ²ç»™å…¶ä»–æ¨¡å—

// pub(crate)

  

// æ ‡å‡†åº“stdï¼Œå¼•å…¥å…¶ä¸­çš„ioæ¨¡å—

use std::io;

// å¼•å…¥ä¸‰æ–¹éšæœºæ•°åº“

use rand::Rng;

// å¼•å…¥æ¯”è¾ƒåº“

use std::cmp::Ordering;

  

// åªæš´éœ²è¿™ä¸ªå‡½æ•°

pub fn test() {

println!("find meï¼");

// åˆ›å»ºå˜é‡

let apples: i32 = 5; // ä¸å¯å˜

let mut bananas: i32 = 5; // å¯å˜

  

// æ¨¡ç‰ˆå­—ç¬¦ä¸²

let x = 5;

let y = 10;

  

println!("x = {x} and y + 2 = {}", y + 2);

}

  

pub fn g() {

println!("Guess the number!");

  

// !éšæœºæ•°ç”Ÿæˆï¼Œå†æ§åˆ¶ä¸ªèŒƒå›´ï¼Œé“¾å¼è°ƒç”¨ï¼Œå¤ªç†Ÿæ‚‰äº†

let secret_number = rand::thread_rng().gen_range(1..=100);

  

// println!("The secret number is: {secret_number}");

  

// å†å¥—å…¥å¾ªç¯

loop {

println!("Please input your guess.");

// åˆ›å»ºä¸€ä¸ª å˜é‡ï¼ˆvariableï¼‰æ¥å‚¨å­˜ç”¨æˆ·è¾“å…¥ï¼Œåˆ›å»ºä¸€ä¸ªnew stringçš„ç©ºå­—ç¬¦ä¸²å®ä¾‹

  

let mut guess = String::new();

  

// å†™æ³•ä¸€ï¼Œå¦‚æœä½ æ²¡æœ‰å¼•ç”¨ioï¼Œåˆ™æ ‡å‡†åº“å¯ä»¥åœ¨è¿™é‡Œå¼•ç”¨

// std::io::stdin()

// .read_line(&mut guess)

// .expect("Failed to read line");

  

// å†™æ³•äºŒ

io::stdin()

// æˆ‘ä»¬è¿˜å°† &mut guess ä½œä¸ºå‚æ•°ä¼ é€’ç»™ read_line() å‡½æ•°ï¼Œè®©å…¶å°†ç”¨æˆ·è¾“å…¥å‚¨å­˜åˆ°è¿™ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚å¹¶ä¸”read_lineåªèƒ½è¿½åŠ ï¼Œä¸èƒ½è¦†ç›–

.read_line(&mut guess) // è°ƒç”¨read_lineæ–¹æ³•ä»æ ‡å‡†è¾“å…¥

.expect("Failed to read line"); // !

/*

todo è¿™é‡Œå°±æ˜¯æ‰€æœ‰æƒäº†ï¼Œä¹Ÿæ˜¯rustçš„æ ¸å¿ƒ

* & è¡¨ç¤ºè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª å¼•ç”¨ï¼ˆreferenceï¼‰ï¼Œå®ƒå…è®¸å¤šå¤„ä»£ç è®¿é—®åŒä¸€å¤„æ•°* * æ®ï¼Œè€Œæ— éœ€åœ¨å†…å­˜ä¸­å¤šæ¬¡æ‹·è´ã€‚å¼•ç”¨æ˜¯ä¸€ä¸ªå¤æ‚çš„ç‰¹æ€§ï¼ŒRust çš„ä¸€ä¸ªä¸»è¦ä¼˜åŠ¿* å°±æ˜¯å®‰å…¨è€Œç®€å•çš„æ“çºµå¼•ç”¨ã€‚å®Œæˆå½“å‰ç¨‹åºå¹¶ä¸éœ€è¦äº†è§£å¦‚æ­¤å¤šç»†èŠ‚ã€‚ç°åœ¨ï¼Œæˆ‘* ä»¬åªéœ€çŸ¥é“å®ƒåƒå˜é‡ä¸€æ ·ï¼Œé»˜è®¤æ˜¯ä¸å¯å˜çš„ã€‚å› æ­¤ï¼Œéœ€è¦å†™æˆ &mut guess æ¥* ä½¿å…¶å¯å˜ï¼Œè€Œä¸æ˜¯ &guessã€‚

*/

  

/*

todo expectæ•æ‰å¼‚å¸¸

read_line ä¼šå°†ç”¨æˆ·è¾“å…¥é™„åŠ åˆ°ä¼ é€’ç»™å®ƒçš„å­—ç¬¦ä¸²ä¸­ï¼Œä¸è¿‡å®ƒä¹Ÿä¼šè¿”å›ä¸€ä¸ªç±»å‹ä¸º Result çš„å€¼ã€‚ Result æ˜¯ä¸€ç§æšä¸¾ç±»å‹ï¼Œé€šå¸¸ä¹Ÿå†™ä½œ enumã€‚æšä¸¾ç±»å‹å˜é‡çš„å€¼å¯ä»¥æ˜¯å¤šç§å¯èƒ½çŠ¶æ€ä¸­çš„ä¸€ä¸ªã€‚æˆ‘ä»¬æŠŠæ¯ç§å¯èƒ½çš„çŠ¶æ€ç§°ä¸ºä¸€ç§ æšä¸¾æˆå‘˜ï¼ˆvariantï¼‰ã€‚

*/

  

/*

Result çš„æˆå‘˜æ˜¯ Ok å’Œ Errï¼ŒOk æˆå‘˜è¡¨ç¤ºæ“ä½œæˆåŠŸï¼Œå†…éƒ¨åŒ…å«æˆåŠŸæ—¶äº§ç”Ÿçš„å€¼ã€‚Err æˆå‘˜åˆ™æ„å‘³ç€æ“ä½œå¤±è´¥ï¼Œå¹¶ä¸”åŒ…å«å¤±è´¥çš„å‰å› åæœã€‚

  

è¿™äº› Result ç±»å‹çš„ä½œç”¨æ˜¯ç¼–ç é”™è¯¯å¤„ç†ä¿¡æ¯ã€‚Result ç±»å‹çš„å€¼ï¼Œåƒå…¶ä»–ç±»å‹ä¸€æ ·ï¼Œæ‹¥æœ‰å®šä¹‰äºå…¶ä¸Šçš„æ–¹æ³•ã€‚Result çš„å®ä¾‹æ‹¥æœ‰ expect æ–¹æ³•ã€‚å¦‚æœ io::Result å®ä¾‹çš„å€¼æ˜¯ Errï¼Œexpect ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼Œå¹¶æ˜¾ç¤ºå½“åšå‚æ•°ä¼ é€’ç»™ expect çš„ä¿¡æ¯ã€‚å¦‚æœ read_line æ–¹æ³•è¿”å› Errï¼Œåˆ™å¯èƒ½æ˜¯æ¥æºäºåº•å±‚æ“ä½œç³»ç»Ÿé”™è¯¯çš„ç»“æœã€‚å¦‚æœ Result å®ä¾‹çš„å€¼æ˜¯ Okï¼Œexpect ä¼šè·å– Ok ä¸­çš„å€¼å¹¶åŸæ ·è¿”å›ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè¿™ä¸ªå€¼æ˜¯ç”¨æˆ·è¾“å…¥åˆ°æ ‡å‡†è¾“å…¥ä¸­çš„å­—èŠ‚æ•°ã€‚

  

å¦‚æœä¸è°ƒç”¨ expectï¼Œç¨‹åºä¹Ÿèƒ½ç¼–è¯‘ï¼Œä¸è¿‡ä¼šå‡ºç°ä¸€ä¸ªè­¦å‘Šï¼š

  
  

$ cargo build

Compiling guessing_game v0.1.0 (file:///projects/guessing_game)

warning: unused `Result` that must be used

--> src/main.rs:10:5

|

10 | io::stdin().read_line(&mut guess);

| ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

|

= note: `#[warn(unused_must_use)]` on by default

= note: this `Result` may be an `Err` variant, which should be handled

  

warning: `guessing_game` (bin "guessing_game") generated 1 warning

Finished dev [unoptimized + debuginfo] target(s) in 0.59s

Rust è­¦å‘Šæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ read_line çš„è¿”å›å€¼ Resultï¼Œè¯´æ˜æœ‰ä¸€ä¸ªå¯èƒ½çš„é”™è¯¯æ²¡æœ‰å¤„ç†ã€‚

  

æ¶ˆé™¤è­¦å‘Šçš„æ­£ç¡®åšæ³•æ˜¯å®é™…å»ç¼–å†™é”™è¯¯å¤„ç†ä»£ç ï¼Œä¸è¿‡ç”±äºæˆ‘ä»¬å°±æ˜¯å¸Œæœ›ç¨‹åºåœ¨å‡ºç°é—®é¢˜æ—¶ç«‹å³å´©æºƒï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨ expectã€‚

*/

  

// æ¨¡ç‰ˆå­—ç¬¦ä¸²è¯­æ³•

// println!("You guessed: {guess}");

  

// ç±»å‹è½¬æ¢è¯­æ³•

/*

åˆ›å»ºäº†ä¸€ä¸ªå«åš guess çš„å˜é‡ã€‚ä¸è¿‡ç­‰ç­‰ï¼Œä¸æ˜¯å·²ç»æœ‰äº†ä¸€ä¸ªå«åš guess çš„å˜é‡äº†å—ï¼Ÿç¡®å®å¦‚æ­¤ï¼Œä¸è¿‡ Rust å…è®¸ç”¨ä¸€ä¸ªæ–°å€¼æ¥ éšè— ï¼ˆShadowingï¼‰ guess ä¹‹å‰çš„å€¼ã€‚è¿™ä¸ªåŠŸèƒ½å¸¸ç”¨åœ¨éœ€è¦è½¬æ¢å€¼ç±»å‹ä¹‹ç±»çš„åœºæ™¯ã€‚

  

String å®ä¾‹çš„ trim æ–¹æ³•ä¼šå»é™¤å­—ç¬¦ä¸²å¼€å¤´å’Œç»“å°¾çš„ç©ºç™½å­—ç¬¦ï¼Œæˆ‘ä»¬å¿…é¡»æ‰§è¡Œæ­¤æ–¹æ³•æ‰èƒ½å°†å­—ç¬¦ä¸²ä¸ u32 æ¯”è¾ƒï¼Œå› ä¸º u32 åªèƒ½åŒ…å«æ•°å€¼å‹æ•°æ®ã€‚

  

å­—ç¬¦ä¸²çš„ parse æ–¹æ³• å°†å­—ç¬¦ä¸²è½¬æ¢æˆå…¶ä»–ç±»å‹ã€‚è¿™é‡Œç”¨å®ƒæ¥æŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å€¼ã€‚æˆ‘ä»¬éœ€è¦å‘Šè¯‰ Rust å…·ä½“çš„æ•°å­—ç±»å‹ï¼Œè¿™é‡Œé€šè¿‡ let guess: u32 æŒ‡å®šã€‚guess åé¢çš„å†’å·ï¼ˆ:ï¼‰å‘Šè¯‰ Rust æˆ‘ä»¬æŒ‡å®šäº†å˜é‡çš„ç±»å‹ã€‚Rust æœ‰ä¸€äº›å†…å»ºçš„æ•°å­—ç±»å‹ï¼›u32 æ˜¯ä¸€ä¸ªæ— ç¬¦å·çš„ 32 ä½æ•´å‹ã€‚

*/

// * è¯­æ³•ç³–ï¼Œåˆ†åˆ«å¤„ç†æˆåŠŸorå¤±è´¥

let guess: u32 = match guess.trim().parse() {

Ok(num) => num,

Err(_) => continue,

};

  

// å¼€å§‹æ¯”è¾ƒ, ä½†æ˜¯å¿…é¡»ç±»å‹ä¸€è‡´ï¼Œä¹Ÿå°±è¯´æˆ‘ä»¬å¿…é¡»è½¬æ¢å­—ç¬¦ä¸²åˆ°u32

  

match guess.cmp(&secret_number) {

Ordering::Less => println!("too small"),

Ordering::Greater => println!("too big"),

Ordering::Equal => {

// è¿™ä¸ªç®­å¤´å‡½æ•°çœŸçš„å¼º

println!("you win");

break;

}

}

}

}

```
- ç¼–è¯‘å¹¶æ‰§è¡Œ
win32å¹³å°
```
# windowsä¼šç¼–è¯‘æˆä¸º.exeæ–‡ä»¶
$ cargo build
# æ‰§è¡Œæ–¹å¼ä¸€
$ cargo run
# æ‰§è¡Œæ–¹å¼äºŒ
$ ./package.exe
```
macOS/Linuxå¹³å°
```
# windowsä¼šç¼–è¯‘æˆä¸ºäºŒè¿›åˆ¶æ–‡ä»¶
$ cargo build
# æ‰§è¡Œæ–¹å¼ä¸€
$ cargo run
# æ‰§è¡Œæ–¹å¼äºŒ
$ ./package
```
**å¦‚æœä½ æ›´ç†Ÿæ‚‰åŠ¨æ€è¯­è¨€ï¼Œå¦‚ Rubyã€Python æˆ– JavaScriptï¼Œåˆ™å¯èƒ½ä¸ä¹ æƒ¯å°†ç¼–è¯‘å’Œè¿è¡Œåˆ†ä¸ºä¸¤ä¸ªå•ç‹¬çš„æ­¥éª¤ã€‚
Rust æ˜¯ä¸€ç§ é¢„ç¼–è¯‘é™æ€ç±»å‹ï¼ˆahead-of-time compiledï¼‰è¯­è¨€ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥ç¼–è¯‘ç¨‹åºï¼Œå¹¶å°†å¯æ‰§è¡Œæ–‡ä»¶é€ç»™å…¶ä»–äººï¼Œä»–ä»¬ç”šè‡³ä¸éœ€è¦å®‰è£… Rust å°±å¯ä»¥è¿è¡Œã€‚å¦‚æœä½ ç»™ä»–äººä¸€ä¸ª .rbã€.py æˆ– .js æ–‡ä»¶ï¼Œä»–ä»¬éœ€è¦å…ˆåˆ†åˆ«å®‰è£… Rubyï¼ŒPythonï¼ŒJavaScript å®ç°ï¼ˆè¿è¡Œæ—¶ç¯å¢ƒï¼ŒVMï¼‰ã€‚**
ä¸è¿‡åœ¨è¿™äº›è¯­è¨€ä¸­ï¼Œåªéœ€è¦ä¸€å¥å‘½ä»¤å°±å¯ä»¥ç¼–è¯‘å’Œè¿è¡Œç¨‹åºã€‚è¿™ä¸€åˆ‡éƒ½æ˜¯è¯­è¨€è®¾è®¡ä¸Šçš„æƒè¡¡å–èˆã€‚
ä»…ä»…ä½¿ç”¨ rustc ç¼–è¯‘ç®€å•ç¨‹åºæ˜¯æ²¡é—®é¢˜çš„ï¼Œä¸è¿‡éšç€é¡¹ç›®çš„å¢é•¿ï¼Œä½ å¯èƒ½éœ€è¦ç®¡ç†ä½ é¡¹ç›®çš„æ–¹æ–¹é¢é¢ï¼Œå¹¶è®©ä»£ç æ˜“äºåˆ†äº«ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦ä»‹ç»ä¸€ä¸ªå«åš Cargo çš„å·¥å…·ï¼Œå®ƒä¼šå¸®åŠ©ä½ ç¼–å†™çœŸå®ä¸–ç•Œä¸­çš„ Rust ç¨‹åºã€‚

#### æ¨¡å—åŒ–å’ŒåŒ…ç®¡ç†
Cargo ä¼šç»™æˆ‘ä»¬çš„åŒ…åˆ›å»ºä¸€ä¸ª Cargo.toml æ–‡ä»¶ã€‚æŸ¥çœ‹ Cargo.toml çš„å†…å®¹ï¼Œä¼šå‘ç°å¹¶æ²¡æœ‰æåˆ° src/main.rsï¼Œå› ä¸º Cargo éµå¾ªçš„ä¸€ä¸ªçº¦å®šï¼šsrc/main.rs å°±æ˜¯ä¸€ä¸ªä¸åŒ…åŒåçš„äºŒè¿›åˆ¶ crate çš„ crate æ ¹ã€‚åŒæ ·çš„ï¼ŒCargo çŸ¥é“å¦‚æœåŒ…ç›®å½•ä¸­åŒ…å« src/lib.rsï¼Œåˆ™åŒ…å¸¦æœ‰ä¸å…¶åŒåçš„åº“ crateï¼Œä¸” src/lib.rs æ˜¯ crate æ ¹ã€‚crate æ ¹æ–‡ä»¶å°†ç”± Cargo ä¼ é€’ç»™ rustc æ¥å®é™…æ„å»ºåº“æˆ–è€…äºŒè¿›åˆ¶é¡¹ç›®ã€‚

åœ¨æ­¤ï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªåªåŒ…å« src/main.rs çš„åŒ…ï¼Œæ„å‘³ç€å®ƒåªå«æœ‰ä¸€ä¸ªåä¸º my-project çš„äºŒè¿›åˆ¶ crateã€‚å¦‚æœä¸€ä¸ªåŒ…åŒæ—¶å«æœ‰ src/main.rs å’Œ src/lib.rsï¼Œåˆ™å®ƒæœ‰ä¸¤ä¸ª crateï¼šä¸€ä¸ªäºŒè¿›åˆ¶çš„å’Œä¸€ä¸ªåº“çš„ï¼Œä¸”åå­—éƒ½ä¸åŒ…ç›¸åŒã€‚é€šè¿‡å°†æ–‡ä»¶æ”¾åœ¨ src/bin ç›®å½•ä¸‹ï¼Œä¸€ä¸ªåŒ…å¯ä»¥æ‹¥æœ‰å¤šä¸ªäºŒè¿›åˆ¶ crateï¼šæ¯ä¸ª src/bin ä¸‹çš„æ–‡ä»¶éƒ½ä¼šè¢«ç¼–è¯‘æˆä¸€ä¸ªç‹¬ç«‹çš„äºŒè¿›åˆ¶ crateã€‚
```
backyard
â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â””â”€â”€ src
    â”œâ”€â”€ garden
    â”‚Â Â  â””â”€â”€ vegetables.rs
    â”œâ”€â”€ garden.rs
    â””â”€â”€ main.rs
```
- ä» crate æ ¹èŠ‚ç‚¹å¼€å§‹: å½“ç¼–è¯‘ä¸€ä¸ª crate, ç¼–è¯‘å™¨é¦–å…ˆåœ¨ crate æ ¹æ–‡ä»¶ï¼ˆé€šå¸¸ï¼Œå¯¹äºä¸€ä¸ªåº“ crate è€Œè¨€æ˜¯src/lib.rsï¼Œå¯¹äºä¸€ä¸ªäºŒè¿›åˆ¶ crate è€Œè¨€æ˜¯src/main.rsï¼‰ä¸­å¯»æ‰¾éœ€è¦è¢«ç¼–è¯‘çš„ä»£ç 
<div style="color: red;">ceateè¡¨ç¤ºå½“å‰æ–‡ä»¶å¤¹çš„æ ¹æ–‡ä»¶ï¼Œæ ¹èŠ‚ç‚¹</div>
- å£°æ˜æ¨¡å—: åœ¨ crate æ ¹æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥å£°æ˜ä¸€ä¸ªæ–°æ¨¡å—ï¼›æ¯”å¦‚ï¼Œä½ ç”¨mod gardenå£°æ˜äº†ä¸€ä¸ªå«åšgardençš„æ¨¡å—ã€‚ç¼–è¯‘å™¨ä¼šåœ¨ä¸‹åˆ—è·¯å¾„ä¸­å¯»æ‰¾æ¨¡å—ä»£ç ï¼š
	- å†…è”ï¼Œåœ¨å¤§æ‹¬å·ä¸­ï¼Œå½“mod gardenåæ–¹ä¸æ˜¯ä¸€ä¸ªåˆ†å·è€Œæ˜¯ä¸€ä¸ªå¤§æ‹¬å·
	- åœ¨æ–‡ä»¶ src/garden.rs
	- åœ¨æ–‡ä»¶ src/garden/mod.rs
<div style="color: red;">æœ‰ä¸¤ç§å£°æ˜æ¨¡å—çš„è¯­æ³•</div>
- å£°æ˜å­æ¨¡å—: åœ¨é™¤äº† crate æ ¹èŠ‚ç‚¹ä»¥å¤–çš„å…¶ä»–æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥å®šä¹‰å­æ¨¡å—ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½åœ¨src/garden.rsä¸­å®šä¹‰äº†mod vegetables;ã€‚ç¼–è¯‘å™¨ä¼šåœ¨ä»¥çˆ¶æ¨¡å—å‘½åçš„ç›®å½•ä¸­å¯»æ‰¾å­æ¨¡å—ä»£ç ï¼š
	- å†…è”ï¼Œåœ¨å¤§æ‹¬å·ä¸­ï¼Œå½“mod vegetablesåæ–¹ä¸æ˜¯ä¸€ä¸ªåˆ†å·è€Œæ˜¯ä¸€ä¸ªå¤§æ‹¬å·
	- åœ¨æ–‡ä»¶ src/garden/vegetables.rs
	- åœ¨æ–‡ä»¶ src/garden/vegetables/mod.rs
<div style="color: red;">å­æ¨¡å—æœ¬è´¨æ˜¯æ–‡ä»¶å¤¹å±‚çº§é—®é¢˜ã€‚</div>
- æ¨¡å—ä¸­çš„ä»£ç è·¯å¾„: ä¸€æ—¦ä¸€ä¸ªæ¨¡å—æ˜¯ä½  crate çš„ä¸€éƒ¨åˆ†ï¼Œä½ å¯ä»¥åœ¨éšç§è§„åˆ™å…è®¸çš„å‰æä¸‹ï¼Œä»åŒä¸€ä¸ª crate å†…çš„ä»»æ„åœ°æ–¹ï¼Œé€šè¿‡ä»£ç è·¯å¾„å¼•ç”¨è¯¥æ¨¡å—çš„ä»£ç ã€‚ä¸¾ä¾‹è€Œè¨€ï¼Œä¸€ä¸ª garden vegetables æ¨¡å—ä¸‹çš„Asparagusç±»å‹å¯ä»¥åœ¨crate::garden::vegetables::Asparagusè¢«æ‰¾åˆ°ã€‚
<div style="color: red;">å¦‚æœä½ æƒ³æš´æ¼ä¸€ä¸ªfile.rsä¸­å¯¹è±¡ï¼Œè¿˜éœ€è¦pub å’Œ pub(ceate)</div>
- ç§æœ‰ vs å…¬ç”¨: ä¸€ä¸ªæ¨¡å—é‡Œçš„ä»£ç é»˜è®¤å¯¹å…¶çˆ¶æ¨¡å—ç§æœ‰ã€‚ä¸ºäº†ä½¿ä¸€ä¸ªæ¨¡å—å…¬ç”¨ï¼Œåº”å½“åœ¨å£°æ˜æ—¶ä½¿ç”¨pub modæ›¿ä»£modã€‚ä¸ºäº†ä½¿ä¸€ä¸ªå…¬ç”¨æ¨¡å—å†…éƒ¨çš„æˆå‘˜å…¬ç”¨ï¼Œåº”å½“åœ¨å£°æ˜å‰ä½¿ç”¨pubã€‚
<div style="color: red;">å‡¡æ˜¯pubåˆ™ä»»ä½•æ¨¡å—éƒ½å¯ä»¥åµŒå¥—è°ƒç”¨ã€‚</div>
- use å…³é”®å­—: åœ¨ä¸€ä¸ªä½œç”¨åŸŸå†…ï¼Œuseå…³é”®å­—åˆ›å»ºäº†ä¸€ä¸ªæˆå‘˜çš„å¿«æ·æ–¹å¼ï¼Œç”¨æ¥å‡å°‘é•¿è·¯å¾„çš„é‡å¤ã€‚åœ¨ä»»ä½•å¯ä»¥å¼•ç”¨crate::garden::vegetables::Asparagusçš„ä½œç”¨åŸŸï¼Œä½ å¯ä»¥é€šè¿‡ use crate::garden::vegetables::Asparagus;åˆ›å»ºä¸€ä¸ªå¿«æ·æ–¹å¼ï¼Œç„¶åä½ å°±å¯ä»¥åœ¨ä½œç”¨åŸŸä¸­åªå†™Asparagusæ¥ä½¿ç”¨è¯¥ç±»å‹ã€‚
<div style="color: red;">
<div>ç»å¯¹è·¯å¾„å¼•ç”¨ï¼šuse crate::garden::vegetables::Asparagus; å¸¦create</div>
<div>ç›¸å¯¹è·¯å¾„å¼•ç”¨ï¼šuse garden::vegetables::Asparagus; ä¸å¸¦create</div>
</div>
#### åŸºæœ¬å˜é‡å’Œæ¦‚å¿µ
- å­—é¢é‡ï¼š= å­—é¢é‡ 
	- å°±æ˜¯ç­‰å·å³è¾¹çš„å°±æ˜¯å­—é¢é‡
- å˜é‡ï¼šmut
- å¸¸é‡ï¼šconst
	- å¦‚æœä¸åŠ mutï¼Œéƒ½é»˜è®¤æ˜¯å¸¸é‡ã€‚

##### å˜é‡
```rust
// å˜é‡mut

pub fn test_mut() {

let mut x = 5;

println!("The value of x is: {x}");

x = 6;

println!("The value of x is: {x}");

}

  

// å¸¸é‡, æ— æ³•å˜æ›´ï¼Œconst

pub fn constants() {

const THREE_HOURS_INSECONDS: u32 = 60 * 60 * 3;

println!("{}", THREE_HOURS_INSECONDS)

}

  

// éšè—ï¼Œå½“å®šä¹‰åŸŸä¸åŒæ—¶ï¼ŒåŒä¸€ä¸ªå˜é‡æ”¹å˜æ—¶ï¼Œä¼šå‘ç”Ÿä¸åŒçš„ç»“æœã€‚

pub fn Shadowing() {

let x: i32 = 5;

  

let x = x + 1;

  

{

let x = x * 2;

println!("The value of x in the inner scope is: {x}");

}

  

println!("The value of x is: {x}");

}

  

// å˜é‡ç±»å‹çš„å¼ºåˆ¶æ€§

pub fn testType() {

// todo è¿™ç§å¯ä»¥ä¿®æ”¹å·²å‘½åçš„å€¼

let spaces = " ";

let spaces = spaces.len();

// todo è¿™ç§å°±ä¼šæŠ¥é”™ï¼Œè™½ç„¶ä½ å¯ä»¥ä¿®æ”¹valueï¼Œä½†ä¸å…è®¸ä¿®æ”¹å®ƒçš„typeã€‚

// let mut spaces = " ";

// spaces = spaces.len();

}
```

##### æ ‡é‡
![](readme.assets/Pasted%20image%2020230718225406.png)
![](readme.assets/Pasted%20image%2020230718225808.png)
```rust
/*

!æ ‡é‡ï¼ˆscalarï¼‰ç±»å‹ä»£è¡¨ä¸€ä¸ªå•ç‹¬çš„å€¼ã€‚Rust æœ‰å››ç§åŸºæœ¬çš„æ ‡é‡ç±»å‹ï¼šæ•´å‹ã€æµ®ç‚¹å‹ã€å¸ƒå°”ç±»å‹å’Œå­—ç¬¦ç±»å‹ã€‚

é•¿åº¦ æœ‰ç¬¦å· æ— ç¬¦å·

8-bit i8 u8

16-bit i16 u16

32-bit i32 u32

64-bit i64 u64

128-bit i128 u128

arch isize usize

  

æ•°å­—å­—é¢å€¼ ä¾‹å­

Decimal (åè¿›åˆ¶) 98_222

Hex (åå…­è¿›åˆ¶) 0xff

Octal (å…«è¿›åˆ¶) 0o77

Binary (äºŒè¿›åˆ¶) 0b1111_0000

Byte (å•å­—èŠ‚å­—ç¬¦)(ä»…é™äºu8) b'A'

  

* æ•´å‹æº¢å‡ºï¼Œæ˜¯æ— æ³•é€šè¿‡ç¼–è¯‘çš„ã€‚

* ä½¿ç”¨ --release flag åœ¨ release æ¨¡å¼ä¸­æ„å»ºæ—¶ï¼ŒRust ä¸ä¼šæ£€æµ‹ä¼šå¯¼è‡´ panic çš„æ•´å‹æº¢å‡ºã€‚ç›¸åå‘ç”Ÿæ•´å‹æº¢å‡ºæ—¶ï¼ŒRust ä¼šè¿›è¡Œä¸€ç§è¢«ç§°ä¸ºäºŒè¿›åˆ¶è¡¥ç  wrappingï¼ˆtwoâ€™s complement wrappingï¼‰çš„æ“ä½œã€‚

*/

// ä½¿ç”¨æ•´å‹

pub fn changeType() {

let guess: u32 = "42".parse().expect("Not a number!");

println!("{}", guess)

}

  

// æµ®ç‚¹æ•°ï¼Œé»˜è®¤éƒ½æ˜¯åŒç²¾åº¦ï¼Œå•ç²¾åº¦ä¹Ÿèƒ½ç”¨

pub fn float() {

let x = 2.0; // f64

let y: f32 = 3.0; // f32

}

  

// æ•°å€¼è®¡ç®—

pub fn count() {

// addition

let sum = 5 + 10;

  

// subtraction

let difference = 95.5 - 4.3;

  

// multiplication

let product = 4 * 30;

  

// division

let quotient = 56.7 / 32.2;

let truncated = -5 / 3; // ç»“æœä¸º -1

  

// remainder

let remainder = 43 % 5;

}

  

// å¸ƒå°”å€¼

pub fn bools() {

let t = true;

  

let f: bool = false; // with explicit type annotation

}

  

// å­—ç¬¦ç±»å‹ï¼Œè¿™ä¸ªå¾ˆç‰¹æ®Š

pub fn string() {

let c = 'z';

let z: char = 'â„¤'; // with explicit type annotation

let heart_eyed_cat = 'ğŸ˜»';

}

  

// å¤åˆç±»å‹

pub fn tuple() {

let tup = (500, 6.4, 1);

  

// è§£æ„èµ‹å€¼

let (x, y, z) = tup;

  

// ç‚¹ç´¢å¼•èµ‹å€¼

// let five_hundred = x.0;

  

// let six_point_four = x.1;

  

// let one = x.2;

  

println!("The value of y is: {y}");

}

  

pub fn array() {

let months = [

"January",

"February",

"March",

"April",

"May",

"June",

"July",

"August",

"September",

"October",

"November",

"December",

];

// ç›´æ¥ç»™æ¯ä¸ªå…ƒç´ èµ‹äºˆtype

let a: [i32; 5] = [1, 2, 3, 4, 5];

  

// åˆ†å·è¡¨ç¤ºäº”ä¸ªå…ƒç´ ï¼Œäº”ä¸ªå…ƒç´ ä¸º3

let a = [3; 5];

  
  

// é€šè¿‡ç´¢å¼•è®¿é—®æ•°ç»„å…ƒç´ 

let first = a[0];

let second = a[1];

  
  

}

  

use std::io;

  
  

// é€šè¿‡è¾“å…¥ç´¢å¼•ï¼Œè·å–æ•°ç»„ä¸­çš„valueã€‚å¦‚æœè¶…è¿‡ç´¢å¼•èŒƒå›´ï¼Œåˆ™æŠ¥é”™

fn test() {

let a = [1, 2, 3, 4, 5];

  

println!("Please enter an array index.");

  

let mut index = String::new();

  

io::stdin()

.read_line(&mut index)

.expect("Failed to read line");

  

let index: usize = index

.trim()

.parse()

.expect("Index entered was not a number");

  

let element = a[index];

  

println!("The value of the element at index {index} is: {element}");

}
```
##### å‡½æ•°
```rust
// å‡½æ•°

  

/*

Rust ä»£ç ä¸­çš„å‡½æ•°å’Œå˜é‡åä½¿ç”¨ snake case è§„èŒƒé£æ ¼ã€‚åœ¨ snake case ä¸­ï¼Œæ‰€æœ‰å­—æ¯éƒ½æ˜¯å°å†™å¹¶ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”å•è¯ã€‚

*/

  

// æœ‰ç‚¹pythonçš„ç±»å‹æ³¨è§£çš„æ„Ÿè§‰äº†

pub fn print_labeled_measurement(value: i32, unit_label: char) {

println!("The measurement is: {value}{unit_label}");

}

  

// è¡¨è¾¾å¼å†™æ³•

pub fn talk() {

let y = {

let x = 3;

x + 1

};

  

println!("The value of y is: {y}");

}

  
  

// è¿”å›å€¼å‡½æ•°ï¼Œåªéœ€è¦ç®­å¤´å‡½æ•°

fn plus_one(x: i32) -> i32 {

// ä¸èƒ½åŠ å…¥åˆ†å·ï¼Œâ€œmismatched typesâ€ï¼ˆç±»å‹ä¸åŒ¹é…ï¼‰

x + 1

}
```
##### åˆ†æ”¯ç»“æ„ï¼ˆåˆ¤æ–­ï¼Œå¾ªç¯ï¼‰
```rust
/*

!å€¼å¾—æ³¨æ„çš„æ˜¯ä»£ç ä¸­çš„æ¡ä»¶ å¿…é¡» æ˜¯ bool å€¼ã€‚å¦‚æœæ¡ä»¶ä¸æ˜¯ bool å€¼ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä¸€ä¸ªé”™è¯¯ã€‚ä¾‹å¦‚ï¼Œå°è¯•è¿è¡Œä»¥ä¸‹ä»£ç 

*/

pub fn testIf() {

let number = 3;

  

if number % 4 == 0 {

println!("number is divisible by 4");

} else if number % 3 == 0 {

println!("number is divisible by 3");

} else if number % 2 == 0 {

println!("number is divisible by 2");

} else {

println!("number is not divisible by 4, 3, or 2");

}

}

  

pub fn testIf_2() {

let condition = true;

// è¯­æ³•ç³–, ä½†æ˜¯è¿”å›å€¼çš„ç±»å‹å¿…é¡»ä¸€è‡´

let number = if condition { 5 } else { 6 };

  

println!("The value of number is: {number}");

}

  

pub fn lp() {

// å½“è¿è¡Œè¿™ä¸ªç¨‹åºæ—¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°è¿ç»­çš„åå¤æ‰“å° again!ï¼Œç›´åˆ°æˆ‘ä»¬æ‰‹åŠ¨åœæ­¢ç¨‹åºã€‚å¤§éƒ¨åˆ†ç»ˆç«¯éƒ½æ”¯æŒä¸€ä¸ªå¿«æ·é”®ï¼Œctrl-cï¼Œæ¥ç»ˆæ­¢ä¸€ä¸ªé™·å…¥æ— é™å¾ªç¯çš„ç¨‹åºã€‚

// loop {

// println!("again!");

// }

  

let mut counter = 0;

  

let result = loop {

counter += 1;

  

if counter == 10 {

break counter * 2;

}

};

  

println!("The result is {result}");

}

  

// å¾ªç¯åµŒå¥—

pub fn lp2() {

let mut count = 0;

// åŠ å…¥æ ‡ç­¾ï¼ŒæŒ‡ç¤ºè·³å‡ºçš„æ˜¯å“ªå±‚å¾ªç¯

'counting_up: loop {

println!("count = {count}");

let mut remaining = 10;

  

loop {

println!("remaining = {remaining}");

if remaining == 9 {

break;

}

if count == 2 {

break 'counting_up;

}

remaining -= 1;

}

  

count += 1;

}

println!("End count = {count}");

}

  

// while æ¡ä»¶å¾ªç¯

fn lp3() {

let a = [10, 20, 30, 40, 50];

let mut index = 0;

  

while index < 5 {

println!("the value is: {}", a[index]);

  

index += 1;

}

}

  

// !forå¾ªç¯ æœ€å¥½ç”¨çš„å¾ªç¯

fn lp4() {

let a = [10, 20, 30, 40, 50];

  

for element in a {

println!("the value is: {element}");

}

  

// revç¿»è½¬å­—ç¬¦ä¸²ï¼Œ1..4æ˜¯ä¸€ä¸ªæ•°ç»„çš„è¯­æ³•ç³–

for number in (1..4).rev() {

println!("{number}!");

}

println!("LIFTOFF!!!");

}
```

#### â­ï¸æ‰€æœ‰æƒ
æ‰€æœ‰æƒï¼ˆç³»ç»Ÿï¼‰æ˜¯ Rust æœ€ä¸ºä¸ä¼—ä¸åŒçš„ç‰¹æ€§ï¼Œå¯¹è¯­è¨€çš„å…¶ä»–éƒ¨åˆ†æœ‰ç€æ·±åˆ»å«ä¹‰ã€‚<span style="color: red;">å®ƒè®© Rust æ— éœ€åƒåœ¾å›æ”¶ï¼ˆgarbage collectorï¼‰å³å¯ä¿éšœå†…å­˜å®‰å…¨ï¼Œå› æ­¤ç†è§£ Rust ä¸­æ‰€æœ‰æƒå¦‚ä½•å·¥ä½œæ˜¯ååˆ†é‡è¦çš„ã€‚</span>æœ¬ç« ï¼Œæˆ‘ä»¬å°†è®²åˆ°æ‰€æœ‰æƒä»¥åŠç›¸å…³åŠŸèƒ½ï¼šå€Ÿç”¨ï¼ˆborrowingï¼‰ã€slice ä»¥åŠ Rust å¦‚ä½•åœ¨å†…å­˜ä¸­å¸ƒå±€æ•°æ®ã€‚

Rust çš„æ ¸å¿ƒåŠŸèƒ½ï¼ˆä¹‹ä¸€ï¼‰æ˜¯ æ‰€æœ‰æƒï¼ˆownershipï¼‰ã€‚è™½ç„¶è¯¥åŠŸèƒ½å¾ˆå®¹æ˜“è§£é‡Šï¼Œä½†å®ƒå¯¹è¯­è¨€çš„å…¶ä»–éƒ¨åˆ†æœ‰ç€æ·±åˆ»çš„å½±å“ã€‚
æ‰€æœ‰ç¨‹åºéƒ½å¿…é¡»ç®¡ç†å…¶è¿è¡Œæ—¶ä½¿ç”¨è®¡ç®—æœºå†…å­˜çš„æ–¹å¼ã€‚ä¸€äº›è¯­è¨€ä¸­å…·æœ‰åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶æœ‰è§„å¾‹åœ°å¯»æ‰¾ä¸å†ä½¿ç”¨çš„å†…å­˜ï¼›åœ¨å¦ä¸€äº›è¯­è¨€ä¸­ï¼Œç¨‹åºå‘˜å¿…é¡»äº²è‡ªåˆ†é…å’Œé‡Šæ”¾å†…å­˜ã€‚<p style="color: green">Rust åˆ™é€‰æ‹©äº†ç¬¬ä¸‰ç§æ–¹å¼ï¼šé€šè¿‡æ‰€æœ‰æƒç³»ç»Ÿç®¡ç†å†…å­˜ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¼šæ ¹æ®ä¸€ç³»åˆ—çš„è§„åˆ™è¿›è¡Œæ£€æŸ¥ã€‚å¦‚æœè¿åäº†ä»»ä½•è¿™äº›è§„åˆ™ï¼Œç¨‹åºéƒ½ä¸èƒ½ç¼–è¯‘ã€‚åœ¨è¿è¡Œæ—¶ï¼Œæ‰€æœ‰æƒç³»ç»Ÿçš„ä»»ä½•åŠŸèƒ½éƒ½ä¸ä¼šå‡æ…¢ç¨‹åºã€‚</p>
å› ä¸ºæ‰€æœ‰æƒå¯¹å¾ˆå¤šç¨‹åºå‘˜æ¥è¯´éƒ½æ˜¯ä¸€ä¸ªæ–°æ¦‚å¿µï¼Œéœ€è¦ä¸€äº›æ—¶é—´æ¥é€‚åº”ã€‚å¥½æ¶ˆæ¯æ˜¯éšç€ä½ å¯¹ Rust å’Œæ‰€æœ‰æƒç³»ç»Ÿçš„è§„åˆ™è¶Šæ¥è¶Šæœ‰ç»éªŒï¼Œä½ å°±è¶Šèƒ½è‡ªç„¶åœ°ç¼–å†™å‡ºå®‰å…¨å’Œé«˜æ•ˆçš„ä»£ç ã€‚æŒä¹‹ä»¥æ’ï¼

ä¸¾ä¾‹ï¼š
```
å…¥æ ˆæ¯”åœ¨å †ä¸Šåˆ†é…å†…å­˜è¦å¿«ï¼Œå› ä¸ºï¼ˆå…¥æ ˆæ—¶ï¼‰åˆ†é…å™¨æ— éœ€ä¸ºå­˜å‚¨æ–°æ•°æ®å»æœç´¢å†…å­˜ç©ºé—´ï¼›å…¶ä½ç½®æ€»æ˜¯åœ¨æ ˆé¡¶ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨å †ä¸Šåˆ†é…å†…å­˜åˆ™éœ€è¦æ›´å¤šçš„å·¥ä½œï¼Œè¿™æ˜¯å› ä¸ºåˆ†é…å™¨å¿…é¡»é¦–å…ˆæ‰¾åˆ°ä¸€å—è¶³å¤Ÿå­˜æ”¾æ•°æ®çš„å†…å­˜ç©ºé—´ï¼Œå¹¶æ¥ç€åšä¸€äº›è®°å½•ä¸ºä¸‹ä¸€æ¬¡åˆ†é…åšå‡†å¤‡ã€‚

è®¿é—®å †ä¸Šçš„æ•°æ®æ¯”è®¿é—®æ ˆä¸Šçš„æ•°æ®æ…¢ï¼Œå› ä¸ºå¿…é¡»é€šè¿‡æŒ‡é’ˆæ¥è®¿é—®ã€‚ç°ä»£å¤„ç†å™¨åœ¨å†…å­˜ä¸­è·³è½¬è¶Šå°‘å°±è¶Šå¿«ï¼ˆç¼“å­˜ï¼‰ã€‚ç»§ç»­ç±»æ¯”ï¼Œå‡è®¾æœ‰ä¸€ä¸ªæœåŠ¡å‘˜åœ¨é¤å…é‡Œå¤„ç†å¤šä¸ªæ¡Œå­çš„ç‚¹èœã€‚åœ¨ä¸€ä¸ªæ¡Œå­æŠ¥å®Œæ‰€æœ‰èœåå†ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæ¡Œå­æ˜¯æœ€æœ‰æ•ˆç‡çš„ã€‚ä»æ¡Œå­ A å¬ä¸€ä¸ªèœï¼Œæ¥ç€æ¡Œå­ B å¬ä¸€ä¸ªèœï¼Œç„¶åå†æ¡Œå­ Aï¼Œç„¶åå†æ¡Œå­ B è¿™æ ·çš„æµç¨‹ä¼šæ›´åŠ ç¼“æ…¢ã€‚å‡ºäºåŒæ ·åŸå› ï¼Œå¤„ç†å™¨åœ¨å¤„ç†çš„æ•°æ®å½¼æ­¤è¾ƒè¿‘çš„æ—¶å€™ï¼ˆæ¯”å¦‚åœ¨æ ˆä¸Šï¼‰æ¯”è¾ƒè¿œçš„æ—¶å€™ï¼ˆæ¯”å¦‚å¯èƒ½åœ¨å †ä¸Šï¼‰èƒ½æ›´å¥½çš„å·¥ä½œã€‚

å½“ä½ çš„ä»£ç è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œä¼ é€’ç»™å‡½æ•°çš„å€¼ï¼ˆåŒ…æ‹¬å¯èƒ½æŒ‡å‘å †ä¸Šæ•°æ®çš„æŒ‡é’ˆï¼‰å’Œå‡½æ•°çš„å±€éƒ¨å˜é‡è¢«å‹å…¥æ ˆä¸­ã€‚å½“å‡½æ•°ç»“æŸæ—¶ï¼Œè¿™äº›å€¼è¢«ç§»å‡ºæ ˆã€‚

è·Ÿè¸ªå“ªéƒ¨åˆ†ä»£ç æ­£åœ¨ä½¿ç”¨å †ä¸Šçš„å“ªäº›æ•°æ®ï¼Œæœ€å¤§é™åº¦çš„å‡å°‘å †ä¸Šçš„é‡å¤æ•°æ®çš„æ•°é‡ï¼Œä»¥åŠæ¸…ç†å †ä¸Šä¸å†ä½¿ç”¨çš„æ•°æ®ç¡®ä¿ä¸ä¼šè€—å°½ç©ºé—´ï¼Œè¿™äº›é—®é¢˜æ­£æ˜¯æ‰€æœ‰æƒç³»ç»Ÿè¦å¤„ç†çš„ã€‚ä¸€æ—¦ç†è§£äº†æ‰€æœ‰æƒï¼Œä½ å°±ä¸éœ€è¦ç»å¸¸è€ƒè™‘æ ˆå’Œå †äº†ï¼Œä¸è¿‡æ˜ç™½äº†æ‰€æœ‰æƒçš„ä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†ç®¡ç†å †æ•°æ®ï¼Œèƒ½å¤Ÿå¸®åŠ©è§£é‡Šä¸ºä»€ä¹ˆæ‰€æœ‰æƒè¦ä»¥è¿™ç§æ–¹å¼å·¥ä½œã€‚
```
#####  æ‰€æœ‰æƒè§„åˆ™
```
1.Rust ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ª æ‰€æœ‰è€…ï¼ˆownerï¼‰ã€‚
2.å€¼åœ¨ä»»ä¸€æ—¶åˆ»æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…ã€‚
3.å½“æ‰€æœ‰è€…ï¼ˆå˜é‡ï¼‰ç¦»å¼€ä½œç”¨åŸŸï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒã€‚
```

##### å†…å­˜ä¸åˆ†é…
å°±å­—ç¬¦ä¸²å­—é¢å€¼æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨ç¼–è¯‘æ—¶å°±çŸ¥é“å…¶å†…å®¹ï¼Œæ‰€ä»¥æ–‡æœ¬è¢«ç›´æ¥ç¡¬ç¼–ç è¿›æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚è¿™ä½¿å¾—å­—ç¬¦ä¸²å­—é¢å€¼å¿«é€Ÿä¸”é«˜æ•ˆã€‚ä¸è¿‡è¿™äº›ç‰¹æ€§éƒ½åªå¾—ç›Šäºå­—ç¬¦ä¸²å­—é¢å€¼çš„ä¸å¯å˜æ€§ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½ä¸ºäº†æ¯ä¸€ä¸ªåœ¨ç¼–è¯‘æ—¶å¤§å°æœªçŸ¥çš„æ–‡æœ¬è€Œå°†ä¸€å—å†…å­˜æ”¾å…¥äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”å®ƒçš„å¤§å°è¿˜å¯èƒ½éšç€ç¨‹åºè¿è¡Œè€Œæ”¹å˜ã€‚

å¯¹äº String ç±»å‹ï¼Œä¸ºäº†æ”¯æŒä¸€ä¸ªå¯å˜ï¼Œå¯å¢é•¿çš„æ–‡æœ¬ç‰‡æ®µï¼Œéœ€è¦åœ¨å †ä¸Šåˆ†é…ä¸€å—åœ¨ç¼–è¯‘æ—¶æœªçŸ¥å¤§å°çš„å†…å­˜æ¥å­˜æ”¾å†…å®¹ã€‚è¿™æ„å‘³ç€ï¼š

å¿…é¡»åœ¨è¿è¡Œæ—¶å‘å†…å­˜åˆ†é…å™¨ï¼ˆmemory allocatorï¼‰è¯·æ±‚å†…å­˜ã€‚
éœ€è¦ä¸€ä¸ªå½“æˆ‘ä»¬å¤„ç†å®Œ String æ—¶å°†å†…å­˜è¿”å›ç»™åˆ†é…å™¨çš„æ–¹æ³•ã€‚
ç¬¬ä¸€éƒ¨åˆ†ç”±æˆ‘ä»¬å®Œæˆï¼šå½“è°ƒç”¨ String::from æ—¶ï¼Œå®ƒçš„å®ç° (implementation) è¯·æ±‚å…¶æ‰€éœ€çš„å†…å­˜ã€‚è¿™åœ¨ç¼–ç¨‹è¯­è¨€ä¸­æ˜¯éå¸¸é€šç”¨çš„ã€‚

ç„¶è€Œï¼Œç¬¬äºŒéƒ¨åˆ†å®ç°èµ·æ¥å°±å„æœ‰åŒºåˆ«äº†ã€‚åœ¨æœ‰ åƒåœ¾å›æ”¶ï¼ˆgarbage collectorï¼ŒGCï¼‰çš„è¯­è¨€ä¸­ï¼ŒGC è®°å½•å¹¶æ¸…é™¤ä¸å†ä½¿ç”¨çš„å†…å­˜ï¼Œè€Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å…³å¿ƒå®ƒã€‚åœ¨å¤§éƒ¨åˆ†æ²¡æœ‰ GC çš„è¯­è¨€ä¸­ï¼Œè¯†åˆ«å‡ºä¸å†ä½¿ç”¨çš„å†…å­˜å¹¶è°ƒç”¨ä»£ç æ˜¾å¼é‡Šæ”¾å°±æ˜¯æˆ‘ä»¬çš„è´£ä»»äº†ï¼Œè·Ÿè¯·æ±‚å†…å­˜çš„æ—¶å€™ä¸€æ ·ã€‚ä»å†å²çš„è§’åº¦ä¸Šè¯´æ­£ç¡®å¤„ç†å†…å­˜å›æ”¶æ›¾ç»æ˜¯ä¸€ä¸ªå›°éš¾çš„ç¼–ç¨‹é—®é¢˜ã€‚å¦‚æœå¿˜è®°å›æ”¶äº†ä¼šæµªè´¹å†…å­˜ã€‚å¦‚æœè¿‡æ—©å›æ”¶äº†ï¼Œå°†ä¼šå‡ºç°æ— æ•ˆå˜é‡ã€‚å¦‚æœé‡å¤å›æ”¶ï¼Œè¿™ä¹Ÿæ˜¯ä¸ª bugã€‚æˆ‘ä»¬éœ€è¦ç²¾ç¡®çš„ä¸ºä¸€ä¸ª allocate é…å¯¹ä¸€ä¸ª freeã€‚

Rust é‡‡å–äº†ä¸€ä¸ªä¸åŒçš„ç­–ç•¥ï¼šå†…å­˜åœ¨æ‹¥æœ‰å®ƒçš„å˜é‡ç¦»å¼€ä½œç”¨åŸŸåå°±è¢«è‡ªåŠ¨é‡Šæ”¾ã€‚ä¸‹é¢æ˜¯ç¤ºä¾‹ 4-1 ä¸­ä½œç”¨åŸŸä¾‹å­çš„ä¸€ä¸ªä½¿ç”¨ String è€Œä¸æ˜¯å­—ç¬¦ä¸²å­—é¢å€¼çš„ç‰ˆæœ¬ï¼š
```rust
   {
        let s = String::from("hello"); // ä»æ­¤å¤„èµ·ï¼Œs æ˜¯æœ‰æ•ˆçš„

        // ä½¿ç”¨ s
    }                                  // æ­¤ä½œç”¨åŸŸå·²ç»“æŸï¼Œ
                                       // s ä¸å†æœ‰æ•ˆ
```
 
è¿™æ˜¯ä¸€ä¸ªå°† String éœ€è¦çš„å†…å­˜è¿”å›ç»™åˆ†é…å™¨çš„å¾ˆè‡ªç„¶çš„ä½ç½®ï¼šå½“ s ç¦»å¼€ä½œç”¨åŸŸçš„æ—¶å€™ã€‚å½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸï¼ŒRust ä¸ºæˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å«åš dropï¼Œåœ¨è¿™é‡Œ String çš„ä½œè€…å¯ä»¥æ”¾ç½®é‡Šæ”¾å†…å­˜çš„ä»£ç ã€‚Rust åœ¨ç»“å°¾çš„ } å¤„è‡ªåŠ¨è°ƒç”¨ dropã€‚

æ³¨æ„ï¼šåœ¨ C++ ä¸­ï¼Œè¿™ç§ item åœ¨ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶é‡Šæ”¾èµ„æºçš„æ¨¡å¼æœ‰æ—¶è¢«ç§°ä½œ èµ„æºè·å–å³åˆå§‹åŒ–ï¼ˆResource Acquisition Is Initialization (RAII)ï¼‰ã€‚å¦‚æœä½ ä½¿ç”¨è¿‡ RAII æ¨¡å¼çš„è¯åº”è¯¥å¯¹ Rust çš„ drop å‡½æ•°å¹¶ä¸é™Œç”Ÿã€‚

è¿™ä¸ªæ¨¡å¼å¯¹ç¼–å†™ Rust ä»£ç çš„æ–¹å¼æœ‰ç€æ·±è¿œçš„å½±å“ã€‚ç°åœ¨å®ƒçœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä¸è¿‡åœ¨æ›´å¤æ‚çš„åœºæ™¯ä¸‹ä»£ç çš„è¡Œä¸ºå¯èƒ½æ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œæ¯”å¦‚å½“æœ‰å¤šä¸ªå˜é‡ä½¿ç”¨åœ¨å †ä¸Šåˆ†é…çš„å†…å­˜æ—¶ã€‚ç°åœ¨è®©æˆ‘ä»¬æ¢ç´¢ä¸€äº›è¿™æ ·çš„åœºæ™¯ã€‚

```rust
pub fn scope() {

// å‡½æ•°ä½œç”¨åŸŸ

/*

å½“ s è¿›å…¥ä½œç”¨åŸŸ æ—¶ï¼Œå®ƒå°±æ˜¯æœ‰æ•ˆçš„ã€‚

è¿™ä¸€ç›´æŒç»­åˆ°å®ƒ ç¦»å¼€ä½œç”¨åŸŸ ä¸ºæ­¢ã€‚

*/

let s = "å‡½æ•°å¤–ä½œç”¨åŸŸ";

{

// å†…éƒ¨å±æ€§å’Œæ–¹æ³•ï¼Œåªèƒ½å†…éƒ¨è°ƒç”¨ï¼Œé™¤éä½ ç»™è¿”å›å€¼

let s = "å‡½æ•°ä½œç”¨åŸŸå­—ç¬¦ä¸²";

}

  

/*

è¿™æ˜¯ä¸€ä¸ªå°† String éœ€è¦çš„å†…å­˜è¿”å›ç»™åˆ†é…å™¨çš„å¾ˆè‡ªç„¶çš„ä½ç½®ï¼šå½“ s ç¦»å¼€ä½œç”¨åŸŸçš„æ—¶å€™ã€‚å½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸï¼ŒRust ä¸ºæˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å«åš dropï¼Œåœ¨è¿™é‡Œ String çš„ä½œè€…å¯ä»¥æ”¾ç½®é‡Šæ”¾å†…å­˜çš„ä»£ç ã€‚Rust åœ¨ç»“å°¾çš„ } å¤„è‡ªåŠ¨è°ƒç”¨ dropã€‚

*/

  

println!("{}", s)

}

  

pub fn scope1() {

// *ä½¿ç”¨fromå‡½æ•°åŸºäºå­—ç¬¦ä¸²çš„å­—é¢å€¼æ¥åˆ›å»ºstring

// *:è¿™ä¸¤ä¸ªå†’å· :: æ˜¯è¿ç®—ç¬¦ï¼Œå…è®¸å°†ç‰¹å®šçš„ from å‡½æ•°ç½®äº String ç±»å‹çš„å‘½åç©ºé—´ï¼ˆnamespaceï¼‰ä¸‹ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨ç±»ä¼¼ string_from è¿™æ ·çš„åå­—ã€‚

let mut s = String::from("å‰\n");

  

s.push_str("è¿½åŠ å­—ç¬¦ä¸²"); // push_str() åœ¨å­—ç¬¦ä¸²åè¿½åŠ å­—é¢å€¼

  

println!("{}", s);

  

/*

?å°±å­—ç¬¦ä¸²å­—é¢å€¼æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨ç¼–è¯‘æ—¶å°±çŸ¥é“å…¶å†…å®¹ï¼Œæ‰€ä»¥æ–‡æœ¬è¢«ç›´æ¥ç¡¬ç¼–ç è¿›æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚è¿™ä½¿å¾—å­—ç¬¦ä¸²å­—é¢å€¼å¿«é€Ÿä¸”é«˜æ•ˆã€‚ä¸è¿‡è¿™äº›ç‰¹æ€§éƒ½åªå¾—ç›Šäºå­—ç¬¦ä¸²å­—é¢å€¼çš„ä¸å¯å˜æ€§ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½ä¸ºäº†æ¯ä¸€ä¸ªåœ¨ç¼–è¯‘æ—¶å¤§å°æœªçŸ¥çš„æ–‡æœ¬è€Œå°†ä¸€å—å†…å­˜æ”¾å…¥äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”å®ƒçš„å¤§å°è¿˜å¯èƒ½éšç€ç¨‹åºè¿è¡Œè€Œæ”¹å˜ã€‚

  

*/

}

  

pub fn scope2() {

// å˜é‡å’Œæ•°æ®äº¤äº’çš„æ–¹å¼ï¼šè¿™ä¸ªä¼šè®©rustæ·±å¤åˆ¶ã€‚

let x = 5;

let y = x;

  

// æ–¹å¼äºŒï¼šè¿™ç§åˆ™ä¼šè®©rustæ½œå¤åˆ¶ï¼Œè®©s2æŒ‡å‘s1ç‚¹å†…å­˜åœ°å€ã€‚

let s1 = String::from("hello");

let s2 = s1;

  

/*

todo å½“ s2 å’Œ s1 ç¦»å¼€ä½œç”¨åŸŸï¼Œä»–ä»¬éƒ½ä¼šå°è¯•é‡Šæ”¾ç›¸åŒçš„å†…å­˜ã€‚è¿™æ˜¯ä¸€ä¸ªå«åš äºŒæ¬¡é‡Šæ”¾ï¼ˆdouble freeï¼‰çš„é”™è¯¯ï¼Œä¹Ÿæ˜¯ä¹‹å‰æåˆ°è¿‡çš„å†…å­˜å®‰å…¨æ€§ bug ä¹‹ä¸€ã€‚ä¸¤æ¬¡é‡Šæ”¾ï¼ˆç›¸åŒï¼‰å†…å­˜ä¼šå¯¼è‡´å†…å­˜æ±¡æŸ“ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´æ½œåœ¨çš„å®‰å…¨æ¼æ´ã€‚

  

todo rustçš„è§£å†³æ€è·¯ï¼šs1è¢«æ¸…ç†ï¼Œs2å½»åº•å–ä»£s1ã€‚

*/

  

// s2æ­£å¸¸ä½¿ç”¨

// println!("{s2}");

// s1 åˆ™æŠ¥é”™error[E0382]: borrow of moved value: `s1`

// println!("{s1}")

}

  

pub fn scope3() {

// æ·±å¤åˆ¶ï¼Œåªé’ˆå¯¹å­—é¢é‡from

let s1 = String::from("hello");

let s2 = s1.clone();

  

println!("s1 = {}, s2 = {}", s1, s2);

  

// æ‹·è´, è¿™é‡Œæ²¡æœ‰ä½¿ç”¨å­—é¢é‡fromï¼Œ

let x = 5;

let y = x;

  

println!("x = {}, y = {}", x, y);

}

  

pub fn scope4() {

let s = String::from("hello"); // s è¿›å…¥ä½œç”¨åŸŸ

  

takes_ownership(s); // s çš„å€¼ç§»åŠ¨åˆ°å‡½æ•°é‡Œ ...

// ... æ‰€ä»¥åˆ°è¿™é‡Œä¸å†æœ‰æ•ˆ

  

let x = 5; // x è¿›å…¥ä½œç”¨åŸŸ

  

makes_copy(x); // x åº”è¯¥ç§»åŠ¨å‡½æ•°é‡Œï¼Œ

// ä½† i32 æ˜¯ Copy çš„ï¼Œ

// æ‰€ä»¥åœ¨åé¢å¯ç»§ç»­ä½¿ç”¨ x

  

let response = gives_ownership();

println!("{response}");

  

// jieè§£æ„èµ‹å€¼

let str1 = String::from("abc");

let (s2, s2lenght) = calculate_length(str1);

println!("{s2}, {s2lenght}")

}

  

fn takes_ownership(some_string: String) {

// some_string è¿›å…¥ä½œç”¨åŸŸ

println!("{}", some_string);

} // è¿™é‡Œï¼Œsome_string ç§»å‡ºä½œç”¨åŸŸå¹¶è°ƒç”¨ `drop` æ–¹æ³•ã€‚

// å ç”¨çš„å†…å­˜è¢«é‡Šæ”¾

  

fn makes_copy(some_integer: i32) {

// some_integer è¿›å…¥ä½œç”¨åŸŸ

println!("{}", some_integer);

} // è¿™é‡Œï¼Œsome_integer ç§»å‡ºä½œç”¨åŸŸã€‚æ²¡æœ‰ç‰¹æ®Šä¹‹å¤„

  

fn gives_ownership() -> String {

// gives_ownership ä¼šå°†

// è¿”å›å€¼ç§»åŠ¨ç»™

// è°ƒç”¨å®ƒçš„å‡½æ•°

  

let some_string = String::from("yours"); // some_string è¿›å…¥ä½œç”¨åŸŸã€‚

  

some_string // è¿”å› some_string

// å¹¶ç§»å‡ºç»™è°ƒç”¨çš„å‡½æ•°

//

}

  

// è¿”å›ä¸€ä¸ªå…ƒç¥–

fn calculate_length(s: String) -> (String, usize) {

let length = s.len(); // len() è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦

(s, length)

}
```
##### å¼•ç”¨ä¸å€Ÿç”¨
``` rust
fn main() {
    let mut s = String::from("hello");

    let r1 = &mut s;
    let r2 = &mut s;

    println!("{}, {}", r1, r2);
}
```
æˆ‘ä»¬ä¸èƒ½åœ¨åŒä¸€æ—¶é—´å¤šæ¬¡å°† s ä½œä¸ºå¯å˜å˜é‡å€Ÿç”¨ã€‚ç¬¬ä¸€ä¸ªå¯å˜çš„å€Ÿå…¥åœ¨ r1 ä¸­ï¼Œå¹¶ä¸”å¿…é¡»æŒç»­åˆ°åœ¨ printlnï¼ ä¸­ä½¿ç”¨å®ƒï¼Œä½†æ˜¯åœ¨é‚£ä¸ªå¯å˜å¼•ç”¨çš„åˆ›å»ºå’Œå®ƒçš„ä½¿ç”¨ä¹‹é—´ï¼Œæˆ‘ä»¬åˆå°è¯•åœ¨ r2 ä¸­åˆ›å»ºå¦ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼Œè¯¥å¼•ç”¨å€Ÿç”¨ä¸ r1 ç›¸åŒçš„æ•°æ®ã€‚

è¿™ä¸€é™åˆ¶ä»¥ä¸€ç§éå¸¸å°å¿ƒè°¨æ…çš„æ–¹å¼å…è®¸å¯å˜æ€§ï¼Œé˜²æ­¢åŒä¸€æ—¶é—´å¯¹åŒä¸€æ•°æ®å­˜åœ¨å¤šä¸ªå¯å˜å¼•ç”¨ã€‚æ–° Rustacean ä»¬ç»å¸¸éš¾ä»¥é€‚åº”è¿™ä¸€ç‚¹ï¼Œå› ä¸ºå¤§éƒ¨åˆ†è¯­è¨€ä¸­å˜é‡ä»»ä½•æ—¶å€™éƒ½æ˜¯å¯å˜çš„ã€‚è¿™ä¸ªé™åˆ¶çš„å¥½å¤„æ˜¯ Rust å¯ä»¥åœ¨ç¼–è¯‘æ—¶å°±é¿å…æ•°æ®ç«äº‰ã€‚æ•°æ®ç«äº‰ï¼ˆdata raceï¼‰ç±»ä¼¼äºç«æ€æ¡ä»¶ï¼Œå®ƒå¯ç”±è¿™ä¸‰ä¸ªè¡Œä¸ºé€ æˆï¼š
- ä¸¤ä¸ªæˆ–æ›´å¤šæŒ‡é’ˆåŒæ—¶è®¿é—®åŒä¸€æ•°æ®ã€‚
- è‡³å°‘æœ‰ä¸€ä¸ªæŒ‡é’ˆè¢«ç”¨æ¥å†™å…¥æ•°æ®ã€‚
- æ²¡æœ‰åŒæ­¥æ•°æ®è®¿é—®çš„æœºåˆ¶ã€‚

æ•°æ®ç«äº‰ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºï¼Œéš¾ä»¥åœ¨è¿è¡Œæ—¶è¿½è¸ªï¼Œå¹¶ä¸”éš¾ä»¥è¯Šæ–­å’Œä¿®å¤ï¼›Rust é¿å…äº†è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œå› ä¸ºå®ƒç”šè‡³ä¸ä¼šç¼–è¯‘å­˜åœ¨æ•°æ®ç«äº‰çš„ä»£ç ï¼

ä¸€å¦‚æ—¢å¾€ï¼Œå¯ä»¥ä½¿ç”¨å¤§æ‹¬å·æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸï¼Œä»¥å…è®¸æ‹¥æœ‰å¤šä¸ªå¯å˜å¼•ç”¨ï¼Œåªæ˜¯ä¸èƒ½ åŒæ—¶ æ‹¥æœ‰ï¼š
```rust
   let mut s = String::from("hello");

    {
        let r1 = &mut s;
    } // r1 åœ¨è¿™é‡Œç¦»å¼€äº†ä½œç”¨åŸŸï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„å¼•ç”¨

    let r2 = &mut s;
```

Rust åœ¨åŒæ—¶ä½¿ç”¨å¯å˜ä¸ä¸å¯å˜å¼•ç”¨æ—¶ä¹Ÿé‡‡ç”¨çš„ç±»ä¼¼çš„è§„åˆ™ã€‚è¿™äº›ä»£ç ä¼šå¯¼è‡´ä¸€ä¸ªé”™è¯¯ï¼š

```rust
fn main() {
    let mut s = String::from("hello");

    let r1 = &s; // æ²¡é—®é¢˜
    let r2 = &s; // æ²¡é—®é¢˜
    let r3 = &mut s; // å¤§é—®é¢˜

    println!("{}, {}, and {}", r1, r2, r3);
}

```
å“‡å“¦ï¼æˆ‘ä»¬ ä¹Ÿ ä¸èƒ½åœ¨æ‹¥æœ‰ä¸å¯å˜å¼•ç”¨çš„åŒæ—¶æ‹¥æœ‰å¯å˜å¼•ç”¨ã€‚
ä¸å¯å˜å¼•ç”¨çš„ç”¨æˆ·å¯ä¸å¸Œæœ›åœ¨ä»–ä»¬çš„çœ¼çš®åº•ä¸‹å€¼å°±è¢«æ„å¤–çš„æ”¹å˜äº†ï¼ç„¶è€Œï¼Œå¤šä¸ªä¸å¯å˜å¼•ç”¨æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºæ²¡æœ‰å“ªä¸ªåªèƒ½è¯»å–æ•°æ®çš„äººæœ‰èƒ½åŠ›å½±å“å…¶ä»–äººè¯»å–åˆ°çš„æ•°æ®ã€‚
æ³¨æ„ä¸€ä¸ªå¼•ç”¨çš„ä½œç”¨åŸŸä»å£°æ˜çš„åœ°æ–¹å¼€å§‹ä¸€ç›´æŒç»­åˆ°æœ€åä¸€æ¬¡ä½¿ç”¨ä¸ºæ­¢ã€‚ä¾‹å¦‚ï¼Œå› ä¸ºæœ€åä¸€æ¬¡ä½¿ç”¨ä¸å¯å˜å¼•ç”¨ï¼ˆprintln!)ï¼Œå‘ç”Ÿåœ¨å£°æ˜å¯å˜å¼•ç”¨ä¹‹å‰ï¼Œæ‰€ä»¥å¦‚ä¸‹ä»£ç æ˜¯å¯ä»¥ç¼–è¯‘çš„ï¼š
```rust
fn main() {
    let mut s = String::from("hello");

    let r1 = &s; // æ²¡é—®é¢˜
    let r2 = &s; // æ²¡é—®é¢˜
    println!("{} and {}", r1, r2);
    // æ­¤ä½ç½®ä¹‹å r1 å’Œ r2 ä¸å†ä½¿ç”¨

    let r3 = &mut s; // æ²¡é—®é¢˜
    println!("{}", r3);
}

```
ä¸å¯å˜å¼•ç”¨ r1 å’Œ r2 çš„ä½œç”¨åŸŸåœ¨ println! æœ€åä¸€æ¬¡ä½¿ç”¨ä¹‹åç»“æŸï¼Œè¿™ä¹Ÿæ˜¯åˆ›å»ºå¯å˜å¼•ç”¨ r3 çš„åœ°æ–¹ã€‚å®ƒä»¬çš„ä½œç”¨åŸŸæ²¡æœ‰é‡å ï¼Œæ‰€ä»¥ä»£ç æ˜¯å¯ä»¥ç¼–è¯‘çš„ã€‚ç¼–è¯‘å™¨å¯ä»¥åœ¨ä½œç”¨åŸŸç»“æŸä¹‹å‰åˆ¤æ–­ä¸å†ä½¿ç”¨çš„å¼•ç”¨ã€‚

å°½ç®¡è¿™äº›é”™è¯¯æœ‰æ—¶ä½¿äººæ²®ä¸§ï¼Œä½†è¯·ç‰¢è®°è¿™æ˜¯ Rust ç¼–è¯‘å™¨åœ¨æå‰æŒ‡å‡ºä¸€ä¸ªæ½œåœ¨çš„ bugï¼ˆåœ¨ç¼–è¯‘æ—¶è€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶ï¼‰å¹¶ç²¾å‡†æ˜¾ç¤ºé—®é¢˜æ‰€åœ¨ã€‚è¿™æ ·ä½ å°±ä¸å¿…å»è·Ÿè¸ªä¸ºä½•æ•°æ®å¹¶ä¸æ˜¯ä½ æƒ³è±¡ä¸­çš„é‚£æ ·ã€‚

###### å¼•ç”¨çš„è§„åˆ™

- åœ¨ä»»æ„ç»™å®šæ—¶é—´ï¼Œ
	- è¦ä¹ˆ åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼Œ
	- è¦ä¹ˆ åªèƒ½æœ‰å¤šä¸ªä¸å¯å˜å¼•ç”¨ã€‚
- å¼•ç”¨å¿…é¡»æ€»æ˜¯æœ‰æ•ˆçš„ã€‚

##### Sliceç±»å‹
slice å…è®¸ä½ å¼•ç”¨é›†åˆä¸­ä¸€æ®µè¿ç»­çš„å…ƒç´ åºåˆ—ï¼Œè€Œä¸ç”¨å¼•ç”¨æ•´ä¸ªé›†åˆã€‚slice æ˜¯ä¸€ç±»å¼•ç”¨ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰æ‰€æœ‰æƒã€‚

```rust
/*

todo å¼•ç”¨ï¼ˆreferenceï¼‰åƒä¸€ä¸ªæŒ‡é’ˆï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªåœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥ç”±æ­¤è®¿é—®å‚¨å­˜äºè¯¥åœ°å€çš„å±äºå…¶ä»–å˜é‡çš„æ•°æ®ã€‚ ä¸æŒ‡é’ˆä¸åŒï¼Œå¼•ç”¨ç¡®ä¿æŒ‡å‘æŸä¸ªç‰¹å®šç±»å‹çš„æœ‰æ•ˆå€¼ã€‚

*/

  

// å½¢å‚ä¹Ÿè¦æ³¨æ˜å¼•ç”¨

fn calculate_length(s: &String) -> usize {

s.len()

}

  

fn change(some_string: &mut String) {

some_string.push_str(", world");

}

  

// ä¸æ”¯æŒè¿”å›å¼•ç”¨å€¼, åœ¨å…·æœ‰æŒ‡é’ˆçš„è¯­è¨€ä¸­ï¼Œå¾ˆå®¹æ˜“é€šè¿‡é‡Šæ”¾å†…å­˜æ—¶ä¿ç•™æŒ‡å‘å®ƒçš„æŒ‡é’ˆè€Œé”™è¯¯åœ°ç”Ÿæˆä¸€ä¸ª æ‚¬å‚æŒ‡é’ˆï¼ˆdangling pointerï¼‰ï¼Œæ‰€è°“æ‚¬å‚æŒ‡é’ˆæ˜¯å…¶æŒ‡å‘çš„å†…å­˜å¯èƒ½å·²ç»è¢«åˆ†é…ç»™å…¶å®ƒæŒæœ‰è€…ã€‚

// fn dangle() -> &String {

// let s = String::from("hello");

// &s

// }

  

// è·å–é¦–å­—æ¯

fn first_word(s: &String) -> usize {

// å› ä¸ºéœ€è¦é€ä¸ªå…ƒç´ çš„æ£€æŸ¥ String ä¸­çš„å€¼æ˜¯å¦ä¸ºç©ºæ ¼ï¼Œéœ€è¦ç”¨ as_bytes æ–¹æ³•å°† String è½¬åŒ–ä¸ºå­—èŠ‚æ•°ç»„

let bytes = s.as_bytes();

// æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ iter æ–¹æ³•åœ¨å­—èŠ‚æ•°ç»„ä¸Šåˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼š

for (i, &item) in bytes.iter().enumerate() {

if item == b' ' {

// iæ˜¯ç´¢å¼•ï¼Œitemæ˜¯å…ƒç´ 

return i;

}

}

  

// å¦‚æœæ²¡æœ‰ç©ºæ ¼ï¼Œåˆ™æ•´ä¸ªå­—ç¬¦ä¸²å°±æ˜¯é¦–å­—æ¯

s.len()

}

  

// è·å–é¦–å•è¯

fn first_word2(s: &str) -> &str {

let bytes = s.as_bytes();

for (i, &item) in bytes.iter().enumerate() {

if item == b' ' {

return &s[0..i];

}

}

&s[..]

}

  

pub fn demo() {

let mut s1 = String::from("hello");

// !ä½¿ç”¨ & å³å¯å¼•ç”¨ã€‚

let len = calculate_length(&s1);

// println!("The length of '{}' is {}.", s1, len);

  

// ä¿®æ”¹å¼•ç”¨çš„å€¼ï¼Œåˆ™éœ€è¦ &mut å°†ä¼ å…¥çš„å‚æ•°è½¬æ¢ä¸ºå¯å˜å¼•ç”¨.

change(&mut s1);

// println!("{s1}"); // hello, world

  

// åŒä¸€ä¸ªå®šä¹‰åŸŸä¸‹ï¼Œä¸æ”¯æŒä¸¤æ¬¡å¯å˜å¼•ç”¨çš„å†èµ‹å€¼ã€‚

let r1 = &mut s1;

// let r2 = &mut s1; // error[E0499]: cannot borrow `s` as mutable more than once at a time

// println!("{r1}");

  

// æ‚¬å‚æŒ‡é’ˆï¼ˆdangling pointerï¼‰

// let test = dangle(); // error[E0106]: missing lifetime specifier

  

// è¿­ä»£å™¨åˆ†å‰²å­—ç¬¦ä¸²

let mut data = String::from("ab c");

// let mut res = first_word(&data);

// data.clear(); // dataä¼šè¢«æ¸…ç©º

// println!("{res}, {data}"); // è¿™é‡Œä¸ä¼šæŠ¥é”™

  

// æ”¹è¿›

let res2 = first_word2(&data);

// data.clear();

println!("{res2}"); // è¿™é‡Œç”±äºæ˜¯å¼•ç”¨åˆ†å‰²ï¼Œå½“ä½ æ¸…ç©ºåŸå§‹å¯¹è±¡åï¼Œä¼šæŠ¥é”™ã€‚error[E0502]: cannot borrow `data` as mutable because it is also borrowed as immutable

  

// å­—ç¬¦ä¸²åˆ‡å‰²

let s = String::from("hello world");

// let hello = &s[0..5];

let hello = &s[..5];

let endIndex = s.len();

// let world = &s[6..11];

let world = &s[6..endIndex];

  

// è·å–æ•´ä¸ªå­—ç¬¦ä¸²

// let slice = &s[0..len];

// let slice = &s[..];

  

// println!("{s}, {hello}, {world}")

// let x = &s[-1]; // ä¸æ”¯æŒè´Ÿç´¢å¼•

  

let a = [1, 2, 3, 4, 5];

let slice = &a[1..3];

// è¯»å†™

for s in slice {

println!("{}", s);

}

// æ–­è¨€ç›¸ç­‰

assert_eq!(slice, &[2, 3]);

  
  

}
```

#### â­ï¸ç»“æ„ä½“struct
structï¼Œæˆ–è€… structureï¼Œæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰æ•°æ®ç±»å‹ï¼Œå…è®¸ä½ åŒ…è£…å’Œå‘½åå¤šä¸ªç›¸å…³çš„å€¼ï¼Œä»è€Œå½¢æˆä¸€ä¸ªæœ‰æ„ä¹‰çš„ç»„åˆã€‚å¦‚æœä½ ç†Ÿæ‚‰ä¸€é—¨é¢å‘å¯¹è±¡è¯­è¨€ï¼Œstruct å°±åƒå¯¹è±¡ä¸­çš„æ•°æ®å±æ€§ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šå¯¹å…ƒç»„å’Œç»“æ„ä½“è¿›è¡Œæ¯”è¾ƒå’Œå¯¹æ¯”ã€‚

ç”Ÿå‘½å‘¨æœŸç¡®ä¿ç»“æ„ä½“å¼•ç”¨çš„æ•°æ®æœ‰æ•ˆæ€§è·Ÿç»“æ„ä½“æœ¬èº«ä¿æŒä¸€è‡´ã€‚
```rust
struct User {
    active: bool,
    // é€ æˆç”Ÿå‘½å‘¨æœŸæ— æ•ˆ
    username: &str,
    email: &str,
    sign_in_count: u64,
}

fn main() {
    let user1 = User {
        active: true,
        username: "someusername123",
        email: "someone@example.com",
        sign_in_count: 1,
    };
}
```

##### æ–¹æ³•è¯­æ³•
ä¸ºäº†ä½¿å‡½æ•°å®šä¹‰äº Rectangle çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬å¼€å§‹äº†ä¸€ä¸ª impl å—ï¼ˆimpl æ˜¯ implementation çš„ç¼©å†™ï¼‰ï¼Œè¿™ä¸ª impl å—ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½å°†ä¸ Rectangle ç±»å‹ç›¸å…³è”ã€‚æ¥ç€å°† area å‡½æ•°ç§»åŠ¨åˆ° impl å¤§æ‹¬å·ä¸­ï¼Œå¹¶å°†ç­¾åä¸­çš„ç¬¬ä¸€ä¸ªï¼ˆåœ¨è¿™é‡Œä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªï¼‰å‚æ•°å’Œå‡½æ•°ä½“ä¸­å…¶ä»–åœ°æ–¹çš„å¯¹åº”å‚æ•°æ”¹æˆ selfã€‚ç„¶ååœ¨ main ä¸­å°†æˆ‘ä»¬å…ˆå‰è°ƒç”¨ area æ–¹æ³•å¹¶ä¼ é€’ rect1 ä½œä¸ºå‚æ•°çš„åœ°æ–¹ï¼Œæ”¹æˆä½¿ç”¨ æ–¹æ³•è¯­æ³•ï¼ˆmethod syntaxï¼‰åœ¨ Rectangle å®ä¾‹ä¸Šè°ƒç”¨ area æ–¹æ³•ã€‚æ–¹æ³•è¯­æ³•è·å–ä¸€ä¸ªå®ä¾‹å¹¶åŠ ä¸Šä¸€ä¸ªç‚¹å·ï¼Œåè·Ÿæ–¹æ³•åã€åœ†æ‹¬å·ä»¥åŠä»»ä½•å‚æ•°ã€‚

åœ¨ area çš„ç­¾åä¸­ï¼Œä½¿ç”¨ &self æ¥æ›¿ä»£ rectangle: &Rectangleï¼Œ&self å®é™…ä¸Šæ˜¯ self: &Self çš„ç¼©å†™ã€‚åœ¨ä¸€ä¸ª impl å—ä¸­ï¼ŒSelf ç±»å‹æ˜¯ impl å—çš„ç±»å‹çš„åˆ«åã€‚æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æœ‰ä¸€ä¸ªåä¸º self çš„Self ç±»å‹çš„å‚æ•°ï¼Œæ‰€ä»¥ Rust è®©ä½ åœ¨ç¬¬ä¸€ä¸ªå‚æ•°ä½ç½®ä¸Šåªç”¨ self è¿™ä¸ªåå­—æ¥ç¼©å†™ã€‚æ³¨æ„ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦åœ¨ self å‰é¢ä½¿ç”¨ & æ¥è¡¨ç¤ºè¿™ä¸ªæ–¹æ³•å€Ÿç”¨äº† Self å®ä¾‹ï¼Œå°±åƒæˆ‘ä»¬åœ¨ rectangle: &Rectangle ä¸­åšçš„é‚£æ ·ã€‚æ–¹æ³•å¯ä»¥é€‰æ‹©è·å¾— self çš„æ‰€æœ‰æƒï¼Œæˆ–è€…åƒæˆ‘ä»¬è¿™é‡Œä¸€æ ·ä¸å¯å˜åœ°å€Ÿç”¨ selfï¼Œæˆ–è€…å¯å˜åœ°å€Ÿç”¨ selfï¼Œå°±è·Ÿå…¶ä»–å‚æ•°ä¸€æ ·ã€‚

è¿™é‡Œé€‰æ‹© &self çš„ç†ç”±è·Ÿåœ¨å‡½æ•°ç‰ˆæœ¬ä¸­ä½¿ç”¨ &Rectangle æ˜¯ç›¸åŒçš„ï¼šæˆ‘ä»¬å¹¶ä¸æƒ³è·å–æ‰€æœ‰æƒï¼Œåªå¸Œæœ›èƒ½å¤Ÿè¯»å–ç»“æ„ä½“ä¸­çš„æ•°æ®ï¼Œè€Œä¸æ˜¯å†™å…¥ã€‚å¦‚æœæƒ³è¦åœ¨æ–¹æ³•ä¸­æ”¹å˜è°ƒç”¨æ–¹æ³•çš„å®ä¾‹ï¼Œéœ€è¦å°†ç¬¬ä¸€ä¸ªå‚æ•°æ”¹ä¸º &mut selfã€‚é€šè¿‡ä»…ä»…ä½¿ç”¨ self ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°æ¥ä½¿æ–¹æ³•è·å–å®ä¾‹çš„æ‰€æœ‰æƒæ˜¯å¾ˆå°‘è§çš„ï¼›è¿™ç§æŠ€æœ¯é€šå¸¸ç”¨åœ¨å½“æ–¹æ³•å°† self è½¬æ¢æˆåˆ«çš„å®ä¾‹çš„æ—¶å€™ï¼Œè¿™æ—¶æˆ‘ä»¬æƒ³è¦é˜²æ­¢è°ƒç”¨è€…åœ¨è½¬æ¢ä¹‹åä½¿ç”¨åŸå§‹çš„å®ä¾‹ã€‚

ä½¿ç”¨æ–¹æ³•æ›¿ä»£å‡½æ•°ï¼Œé™¤äº†å¯ä½¿ç”¨æ–¹æ³•è¯­æ³•å’Œä¸éœ€è¦åœ¨æ¯ä¸ªå‡½æ•°ç­¾åä¸­é‡å¤ self çš„ç±»å‹ä¹‹å¤–ï¼Œå…¶ä¸»è¦å¥½å¤„åœ¨äºç»„ç»‡æ€§ã€‚æˆ‘ä»¬å°†æŸä¸ªç±»å‹å®ä¾‹èƒ½åšçš„æ‰€æœ‰äº‹æƒ…éƒ½ä¸€èµ·æ”¾å…¥ impl å—ä¸­ï¼Œè€Œä¸æ˜¯è®©å°†æ¥çš„ç”¨æˆ·åœ¨æˆ‘ä»¬çš„åº“ä¸­åˆ°å¤„å¯»æ‰¾ Rectangle çš„åŠŸèƒ½ã€‚
```rust

#[derive(Debug)]
struct Rectangle {
    width: u32,
    height: u32,
}

impl Rectangle {
    fn area(&self) -> u32 {
        self.width * self.height
    }
}

fn main() {
    let rect1 = Rectangle {
        width: 30,
        height: 50,
    };

    println!(
        "The area of the rectangle is {} square pixels.",
        rect1.area()
    );
}

```

Rust å¹¶æ²¡æœ‰ä¸€ä¸ªä¸ -> ç­‰æ•ˆçš„è¿ç®—ç¬¦ï¼›ç›¸åï¼ŒRust æœ‰ä¸€ä¸ªå« è‡ªåŠ¨å¼•ç”¨å’Œè§£å¼•ç”¨ï¼ˆautomatic referencing and dereferencingï¼‰çš„åŠŸèƒ½ã€‚æ–¹æ³•è°ƒç”¨æ˜¯ Rust ä¸­å°‘æ•°å‡ ä¸ªæ‹¥æœ‰è¿™ç§è¡Œä¸ºçš„åœ°æ–¹ã€‚

å®ƒæ˜¯è¿™æ ·å·¥ä½œçš„ï¼šå½“ä½¿ç”¨ object.something() è°ƒç”¨æ–¹æ³•æ—¶ï¼ŒRust ä¼šè‡ªåŠ¨ä¸º object æ·»åŠ  &ã€&mut æˆ– * ä»¥ä¾¿ä½¿ object ä¸æ–¹æ³•ç­¾ååŒ¹é…ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›ä»£ç æ˜¯ç­‰ä»·çš„ï¼š
```rust
p1.distance(&p2);
(&p1).distance(&p2);
```
ç¬¬ä¸€è¡Œçœ‹èµ·æ¥ç®€æ´çš„å¤šã€‚è¿™ç§è‡ªåŠ¨å¼•ç”¨çš„è¡Œä¸ºä¹‹æ‰€ä»¥æœ‰æ•ˆï¼Œæ˜¯å› ä¸ºæ–¹æ³•æœ‰ä¸€ä¸ªæ˜ç¡®çš„æ¥æ”¶è€…â€”â€”â€”â€” self çš„ç±»å‹ã€‚åœ¨ç»™å‡ºæ¥æ”¶è€…å’Œæ–¹æ³•åçš„å‰æä¸‹ï¼ŒRust å¯ä»¥æ˜ç¡®åœ°è®¡ç®—å‡ºæ–¹æ³•æ˜¯ä»…ä»…è¯»å–ï¼ˆ&selfï¼‰ï¼Œåšå‡ºä¿®æ”¹ï¼ˆ&mut selfï¼‰æˆ–è€…æ˜¯è·å–æ‰€æœ‰æƒï¼ˆselfï¼‰ã€‚äº‹å®ä¸Šï¼ŒRust å¯¹æ–¹æ³•æ¥æ”¶è€…çš„éšå¼å€Ÿç”¨è®©æ‰€æœ‰æƒåœ¨å®è·µä¸­æ›´å‹å¥½ã€‚

```rust
// å®šä¹‰ç»“æ„ä½“

struct User {

active: bool,

username: String,

email: String,

sign_in_count: i32,

}

  

fn build_user(email: String, username: String) -> User {

User {

active: true,

username: username,

email: email,

sign_in_count: 1,

}

}

  

// å…ƒç»„ç»“æ„ä½“

struct Color(i32, i32, i32);

  

// ç±»å•å…ƒç»“æ„ä½“

struct AlwaysEqual;

  

pub fn theWorld() {

// æœ‰ç‚¹å¯¹è±¡è¯­æ³•çš„æ„Ÿè§‰

let mut user1 = User {

active: true,

username: String::from("someusername123"),

email: String::from("someone@example.com"),

sign_in_count: 1,

};

// ç»“æ„ä½“èµ‹å€¼

user1.email = String::from("785632486@qq.com");

// println!("{}", user1.email);

  

// ä½¿ç”¨user1çš„å†…å®¹ï¼Œå¡«å……ç»™user2

// let user2 = User {

// active: user1.active,

// username: user1.username,

// email: String::from("another@example.com"),

// sign_in_count: user1.sign_in_count,

// };

// ä½¿ç”¨è¯­æ³•ç³–ï¼Œè¿›è¡Œè§£æ„èµ‹å€¼

let user3 = User {

email: String::from("another@example.com"),

..user1

};

// user1è¢«æ¸…ç†æ‰äº†ï¼Œuser3èƒ½æ­£å¸¸ä½¿ç”¨ã€‚

// println!("{}", user1.email)

// println!("{}", user2.email)

// println!("{}", user3.sign_in_count);

// clone å¯ä»¥è¿›è¡Œå±æ€§çš„æ·±å¤åˆ¶, ä½†ç»“æ„ä½“ä¸èƒ½æ·±å¤åˆ¶

let user4 = user3.email.clone();

// println!("{}", user4)

  

// å…ƒç»„ç»“æ„ä½“

let black = Color(0, 0, 0);

  

// ç±»å•å…ƒç»“æ„ä½“

let subject = AlwaysEqual;

  

// ç»“æ„ä½“ä¼ å‚æ•°

// wh();

  

// ç»“æ„ä½“åŸå‹ï¼Œæ–¹æ³•

// print();

  

// ç»“æ„ä½“å‚æ•°å¢åŠ 

// inherit();

  

// !å…³è”å‡½æ•°, æ¶‰åŠåˆ°æ¨¡å—è¯­æ³•

testSelf();

}

  

// ä½¿ç”¨ #[derive(Debug)] åæ‰èƒ½æ‰“å°ç»“æ„ä½“

#[derive(Debug)]

struct Rectangle {

width: u32,

height: u32,

}

  

// è®¡ç®—çŸ©å½¢é¢ç§¯

fn wh() {

// let width1 = 30;

// let height1 = 50;

// println!("{}", area(width1, height1));

  

// let rect1 = (30, 50);

// println!("{}", area1(rect1));

  

let rect2 = Rectangle {

width: 30,

height: 50,

};

println!("{}", area2(&rect2));

}

  

fn area(width: u32, height: u32) -> u32 {

width * height

}

  

fn area1(dimensions: (u32, u32)) -> u32 {

// ä½¿ç”¨å…ƒç»„ç»“æ„ä½“ï¼Œè®¡ç®—

dimensions.0 * dimensions.1

}

  

fn area2(rectangle: &Rectangle) -> u32 {

// ä½¿ç”¨æ™®é€šå¯¹è±¡ç»“æ„ä½“

rectangle.height * rectangle.width

}

  

// æ”¹å†™ç»“æ„ä½“ï¼Œè¿™é‡Œå¾ˆåƒjsçš„prototypeï¼Œé«˜çº§å¯¹è±¡æ–¹æ³•ã€‚

impl Rectangle {

fn area(&self) -> u32 {

// è¿™ä¸ªselfåˆç±»ä¼¼

self.width * self.height

}

// è°ƒç”¨å†…éƒ¨æ–¹æ³•çš„è¿”å›å€¼ï¼Œç±»ä¼¼è®¡ç®—å±æ€§çš„å¼•ç”¨ï¼Œ

fn width(&self) -> bool {

self.width > 0

}

}

  

// é€šè¿‡æ´¾ç”Ÿ trait å¢åŠ å®ç”¨åŠŸèƒ½, æ‰“å°ç»“æ„ä½“

fn print() {

let rect1 = Rectangle {

width: 30,

height: 50,

};

// éæ ¼å¼åŒ–è¯­æ³•

// println!("rect1 is {:?}", rect1);

// æ ¼å¼åŒ–è¯­æ³•

// println!("rect1 is {:#?}", rect1);

  

// å¦ä¸€ç§ä½¿ç”¨ Debug æ ¼å¼æ‰“å°æ•°å€¼çš„æ–¹æ³•æ˜¯ä½¿ç”¨ dbg! å®ã€‚dbg! å®æ¥æ”¶ä¸€ä¸ªè¡¨è¾¾å¼çš„æ‰€æœ‰æƒï¼ˆä¸ println! å®ç›¸åï¼Œåè€…æ¥æ”¶çš„æ˜¯å¼•ç”¨ï¼‰ï¼Œæ‰“å°å‡ºä»£ç ä¸­è°ƒç”¨ dbg! å®æ—¶æ‰€åœ¨çš„æ–‡ä»¶å’Œè¡Œå·ï¼Œä»¥åŠè¯¥è¡¨è¾¾å¼çš„ç»“æœå€¼ï¼Œå¹¶è¿”å›è¯¥å€¼çš„æ‰€æœ‰æƒã€‚

  

// æ‰“å°åˆ°å¼‚å¸¸æ§åˆ¶å°

// dbg!(&rect1);

  

// è°ƒç”¨ç»“æ„ä½“å†…éƒ¨æ–¹æ³•

println!("{}", rect1.area());

if rect1.width() {

println!("The rectangle has a nonzero width; it is {}", rect1.width);

}

}

  

impl Rectangle {

// æ·»åŠ æ–°çš„ç»“æ„ä½“æ–¹æ³•

fn can_hold(&self, other: &Rectangle) -> bool {

self.width > other.width && self.height > other.height

}

}

  

// ç»“æ„ä½“å‚æ•°ä¿®æ”¹

fn inherit() {

let rect1 = Rectangle {

width: 30,

height: 50,

};

let rect2 = Rectangle {

width: 10,

height: 40,

};

let rect3 = Rectangle {

width: 60,

height: 45,

};

  

println!("Can rect1 hold rect2? {}", rect1.can_hold(&rect2));

println!("Can rect1 hold rect3? {}", rect1.can_hold(&rect3));

}

  

// ç»“æ„ä½“çš„å…³è”å‡½æ•°

impl Rectangle {

// è¿™é‡Œå°±æ¶‰åŠåˆ°æ¨¡å—äº†

fn square(size: u32) -> Self {

Self {

width: size,

height: size,

}

}

}

  

fn testSelf() {

let sq = Rectangle::square(23);

println!("{:#?}", sq)

}
```
ç»“æ„ä½“è®©ä½ å¯ä»¥åˆ›å»ºå‡ºåœ¨ä½ çš„é¢†åŸŸä¸­æœ‰æ„ä¹‰çš„è‡ªå®šä¹‰ç±»å‹ã€‚é€šè¿‡ç»“æ„ä½“ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç›¸å…³è”çš„æ•°æ®ç‰‡æ®µè”ç³»èµ·æ¥å¹¶å‘½åå®ƒä»¬ï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—ä»£ç æ›´åŠ æ¸…æ™°ã€‚åœ¨ impl å—ä¸­ï¼Œä½ å¯ä»¥å®šä¹‰ä¸ä½ çš„ç±»å‹ç›¸å…³è”çš„å‡½æ•°ï¼Œè€Œæ–¹æ³•æ˜¯ä¸€ç§ç›¸å…³è”çš„å‡½æ•°ï¼Œè®©ä½ æŒ‡å®šç»“æ„ä½“çš„å®ä¾‹æ‰€å…·æœ‰çš„è¡Œä¸ºã€‚

ä½†ç»“æ„ä½“å¹¶ä¸æ˜¯åˆ›å»ºè‡ªå®šä¹‰ç±»å‹çš„å”¯ä¸€æ–¹æ³•ï¼šè®©æˆ‘ä»¬è½¬å‘ Rust çš„æšä¸¾åŠŸèƒ½ï¼Œä¸ºä½ çš„å·¥å…·ç®±å†æ·»ä¸€ä¸ªå·¥å…·ã€‚

#### â­ï¸æšä¸¾å’Œæ¨¡å¼
æœ¬ç« ä»‹ç» æšä¸¾ï¼ˆenumerationsï¼‰ï¼Œä¹Ÿè¢«ç§°ä½œ enumsã€‚æšä¸¾å…è®¸ä½ é€šè¿‡åˆ—ä¸¾å¯èƒ½çš„ æˆå‘˜ï¼ˆvariantsï¼‰æ¥å®šä¹‰ä¸€ä¸ªç±»å‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä¼šå®šä¹‰å¹¶ä½¿ç”¨ä¸€ä¸ªæšä¸¾æ¥å±•ç¤ºå®ƒæ˜¯å¦‚ä½•è¿åŒæ•°æ®ä¸€èµ·ç¼–ç ä¿¡æ¯çš„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼šæ¢ç´¢ä¸€ä¸ªç‰¹åˆ«æœ‰ç”¨çš„æšä¸¾ï¼Œå«åš Optionï¼Œå®ƒä»£è¡¨ä¸€ä¸ªå€¼è¦ä¹ˆæ˜¯æŸä¸ªå€¼è¦ä¹ˆä»€ä¹ˆéƒ½ä¸æ˜¯ã€‚ç„¶åä¼šè®²åˆ°åœ¨ match è¡¨è¾¾å¼ä¸­ç”¨æ¨¡å¼åŒ¹é…ï¼Œé’ˆå¯¹ä¸åŒçš„æšä¸¾å€¼ç¼–å†™ç›¸åº”è¦æ‰§è¡Œçš„ä»£ç ã€‚æœ€åä¼šä»‹ç» if letï¼Œå¦ä¸€ä¸ªç®€æ´æ–¹ä¾¿å¤„ç†ä»£ç ä¸­æšä¸¾çš„ç»“æ„ã€‚

```rust
/*

æšä¸¾ç»“æ„ä½“

  

ç»“æ„ä½“ç»™äºˆä½ å°†å­—æ®µå’Œæ•°æ®èšåˆåœ¨ä¸€èµ·çš„æ–¹æ³•ï¼Œåƒ Rectangle ç»“æ„ä½“æœ‰ width å’Œ height ä¸¤ä¸ªå­—æ®µã€‚è€Œæšä¸¾ç»™äºˆä½ å°†ä¸€ä¸ªå€¼æˆä¸ºä¸€ä¸ªé›†åˆä¹‹ä¸€çš„æ–¹æ³•ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³è®© Rectangle æ˜¯ä¸€äº›å½¢çŠ¶çš„é›†åˆï¼ŒåŒ…å« Circle å’Œ Triangle ã€‚ä¸ºäº†åšåˆ°è¿™ä¸ªï¼ŒRust æä¾›äº†æšä¸¾ç±»å‹ã€‚

  

è®©æˆ‘ä»¬çœ‹çœ‹ä¸€ä¸ªéœ€è¦è¯‰è¯¸äºä»£ç çš„åœºæ™¯ï¼Œæ¥è€ƒè™‘ä¸ºä½•æ­¤æ—¶ä½¿ç”¨æšä¸¾æ›´ä¸ºåˆé€‚ä¸”å®ç”¨ã€‚å‡è®¾æˆ‘ä»¬è¦å¤„ç† IP åœ°å€ã€‚ç›®å‰è¢«å¹¿æ³›ä½¿ç”¨çš„ä¸¤ä¸ªä¸»è¦ IP æ ‡å‡†ï¼šIPv4ï¼ˆversion fourï¼‰å’Œ IPv6ï¼ˆversion sixï¼‰ã€‚è¿™æ˜¯æˆ‘ä»¬çš„ç¨‹åºå¯èƒ½ä¼šé‡åˆ°çš„æ‰€æœ‰å¯èƒ½çš„ IP åœ°å€ç±»å‹ï¼šæ‰€ä»¥å¯ä»¥ æšä¸¾ å‡ºæ‰€æœ‰å¯èƒ½çš„å€¼ï¼Œè¿™ä¹Ÿæ­£æ˜¯æ­¤æšä¸¾åå­—çš„ç”±æ¥ã€‚

  

ä»»ä½•ä¸€ä¸ª IP åœ°å€è¦ä¹ˆæ˜¯ IPv4 çš„è¦ä¹ˆæ˜¯ IPv6 çš„ï¼Œè€Œä¸”ä¸èƒ½ä¸¤è€…éƒ½æ˜¯ã€‚IP åœ°å€çš„è¿™ä¸ªç‰¹æ€§ä½¿å¾—æšä¸¾æ•°æ®ç»“æ„éå¸¸é€‚åˆè¿™ä¸ªåœºæ™¯ï¼Œå› ä¸ºæšä¸¾å€¼åªå¯èƒ½æ˜¯å…¶ä¸­ä¸€ä¸ªæˆå‘˜ã€‚IPv4 å’Œ IPv6 ä»æ ¹æœ¬ä¸Šè®²ä»æ˜¯ IP åœ°å€ï¼Œæ‰€ä»¥å½“ä»£ç åœ¨å¤„ç†é€‚ç”¨äºä»»ä½•ç±»å‹çš„ IP åœ°å€çš„åœºæ™¯æ—¶åº”è¯¥æŠŠå®ƒä»¬å½“ä½œç›¸åŒçš„ç±»å‹ã€‚

  

å¯ä»¥é€šè¿‡åœ¨ä»£ç ä¸­å®šä¹‰ä¸€ä¸ª IpAddrKind æšä¸¾æ¥è¡¨ç°è¿™ä¸ªæ¦‚å¿µå¹¶åˆ—å‡ºå¯èƒ½çš„ IP åœ°å€ç±»å‹ï¼ŒV4 å’Œ V6ã€‚è¿™è¢«ç§°ä¸ºæšä¸¾çš„ æˆå‘˜ï¼ˆvariantsï¼‰ï¼š

*/

  

pub fn enums() {

#[derive(Debug)]

enum IpAddrKind {

V4,

V6,

}

// åˆ†åˆ«å¯¼å‡ºenumçš„ä¸¤ä¸ªå®ä¾‹

// æ³¨æ„æšä¸¾çš„æˆå‘˜ä½äºå…¶æ ‡è¯†ç¬¦çš„å‘½åç©ºé—´ä¸­ï¼Œå¹¶ä½¿ç”¨ä¸¤ä¸ªå†’å·åˆ†å¼€

let four = IpAddrKind::V4;

let six = IpAddrKind::V6;

  

// ä½¿ç”¨æˆå‘˜è°ƒç”¨å‡½æ•°

route(IpAddrKind::V4);

route(IpAddrKind::V6);

  

fn route(ip_kind: IpAddrKind) {

println!("{:#?}", ip_kind)

}

}

  

// æšä¸¾å­—æ®µï¼Œèµ‹äºˆç±»å‹

  

pub fn enums1() {

#[derive(Debug)]

enum IpAddr {

V4(String),

V6(String),

}

  

let home = IpAddr::V4(String::from("127.0.0.1"));

let loopback = IpAddr::V6(String::from("::1"));

println!("{:#?}", home);

  

// * ç›´æ¥æ„å»ºå…ƒç»„

enum IpAddr1 {

V4(u8, u8, u8, u8),

V6(String),

}

  

let home = IpAddr1::V4(127, 0, 0, 1);

let loopback = IpAddr1::V6(String::from("::1"));

  

// todo ç»“æ„ä½“ï¼Œæšä¸¾

struct Ipv4Addr {

// --snip--

b: i32,

}

  

struct Ipv6Addr {

// --snip--

a: String,

}

  

enum IpAddr2 {

V4(Ipv4Addr),

V6(Ipv6Addr),

}

  

// ?æšä¸¾ç±»å‹

enum Message {

// ç±»å•å…ƒç»“æ„ä½“

Quit,

// æ™®é€šç»“æ„ä½“

Move { x: i32, y: i32 },

// å…ƒç»„ç»“æ„ä½“

Write(String),

// å…ƒç»„ç»“æ„ä½“

ChangeColor(i32, i32, i32),

}

  

// æšä¸¾ä¹Ÿæ˜¯ä¸€ç§ç»“æ„

impl Message {

fn call(&self) {

// åœ¨è¿™é‡Œå®šä¹‰æ–¹æ³•ä½“

}

}

  

let m = Message::Write(String::from("hello"));

m.call();

}

  

pub fn enums2() {

enum Option<T> {

// ç©ºå€¼

None,

// ä»»æ„æ•°æ®ï¼Œæ³›å‹

Some(T),

}

  

let some_number = Some(5);

let some_char = Some('e');

let absent_number: Option<i32> = Option::None;

}

  

pub fn enums3() {

enum Coin {

Penny,

Nickel,

Dime,

Quarter,

}

fn value_in_cents(coin: Coin) -> u8 {

match coin {

Coin::Penny => {

println!("Lucky penny!");

1

}

Coin::Nickel => 5,

Coin::Dime => 10,

Coin::Quarter => 25,

}

}

// è¿”å›1

println!("{}", value_in_cents(Coin::Penny));

  

fn plus_one(x: Option<i32>) -> Option<i32> {

match x {

None => None,

Some(i) => Some(i + 1),

}

}

  

let five = Some(5);

let six = plus_one(five);

let none = plus_one(None);

}

  

pub fn enums4() {

fn plus_one(x: Option<i32>) -> Option<i32> {

match x {

Some(i) => Some(i + 1),

// è¦æ±‚å¿…é¡»ç©·å°½æ‰€æœ‰çš„å¯èƒ½ï¼ŒåŒ…æ‹¬none

None => None,

}

}

  

// todo otheré€šé…ç¬¦

let dice_roll = 9;

match dice_roll {

3 => 3,

7 => 7,

// other å¯ä»¥è·å–matchä¼ é€’ä¸‹æ¥çš„å€¼

other => other,

// ä¸è¦matchä¼ é€’ä¸‹æ¥çš„å€¼

// _ => reroll(),

};

  

// if let ç®€å•åˆ¤æ–­, è¯­æ³•ç³–

let config_max = Some(3u8);

if let Some(max) = config_max {

println!("The maximum is configured to be {}", max);

}

  

// è¯­æ³•ç³–2

let mut count = 0;

// match coin {

// Coin::Quarter(state) => println!("State quarter from {:?}!", state),

// _ => count += 1,

// }

  

// è¯­æ³•ç³–3

let mut count = 0;

// if let Coin::Quarter(state) = coin {

// println!("State quarter from {:?}!", state);

// } else {

// count += 1;

// }

}
```
ä¸€ç§ç‰¹æ®Šçš„ç»“æ„ä½“ã€‚æ¯”ä»·é€‚åˆåˆ¤æ–­ã€‚

#### åŒ…ï¼Œåº“ï¼Œcreatæ¨¡å—ç®¡ç†
å¯¹äºä¸€ä¸ªç”±ä¸€ç³»åˆ—ç›¸äº’å…³è”çš„åŒ…ç»„æˆçš„è¶…å¤§å‹é¡¹ç›®ï¼ŒCargo æä¾›äº† â€œå·¥ä½œç©ºé—´â€ è¿™ä¸€åŠŸèƒ½ï¼Œ â€œCargo Workspacesâ€ ã€‚

è®¨è®ºå°è£…æ¥å®ç°ç»†èŠ‚ï¼Œè¿™å¯ä»¥ä½¿ä½ æ›´é«˜çº§åœ°é‡ç”¨ä»£ç ï¼šä½ å®ç°äº†ä¸€ä¸ªæ“ä½œåï¼Œå…¶ä»–çš„ä»£ç å¯ä»¥é€šè¿‡è¯¥ä»£ç çš„å…¬å…±æ¥å£æ¥è¿›è¡Œè°ƒç”¨ï¼Œè€Œä¸éœ€è¦çŸ¥é“å®ƒæ˜¯å¦‚ä½•å®ç°çš„ã€‚ä½ åœ¨ç¼–å†™ä»£ç æ—¶å¯ä»¥å®šä¹‰å“ªäº›éƒ¨åˆ†æ˜¯å…¶ä»–ä»£ç å¯ä»¥ä½¿ç”¨çš„å…¬å…±éƒ¨åˆ†ï¼Œä»¥åŠå“ªäº›éƒ¨åˆ†æ˜¯ä½ æœ‰æƒæ›´æ”¹å®ç°ç»†èŠ‚çš„ç§æœ‰éƒ¨åˆ†ã€‚è¿™æ˜¯å¦ä¸€ç§å‡å°‘ä½ åœ¨è„‘æµ·ä¸­è®°ä½é¡¹ç›®å†…å®¹æ•°é‡çš„æ–¹æ³•ã€‚

è¿™é‡Œæœ‰ä¸€ä¸ªéœ€è¦è¯´æ˜çš„æ¦‚å¿µ â€œä½œç”¨åŸŸï¼ˆscopeï¼‰â€ï¼šä»£ç æ‰€åœ¨çš„åµŒå¥—ä¸Šä¸‹æ–‡æœ‰ä¸€ç»„å®šä¹‰ä¸º â€œin scopeâ€ çš„åç§°ã€‚å½“é˜…è¯»ã€ç¼–å†™å’Œç¼–è¯‘ä»£ç æ—¶ï¼Œç¨‹åºå‘˜å’Œç¼–è¯‘å™¨éœ€è¦çŸ¥é“ç‰¹å®šä½ç½®çš„ç‰¹å®šåç§°æ˜¯å¦å¼•ç”¨äº†å˜é‡ã€å‡½æ•°ã€ç»“æ„ä½“ã€æšä¸¾ã€æ¨¡å—ã€å¸¸é‡æˆ–è€…å…¶ä»–æœ‰æ„ä¹‰çš„é¡¹ã€‚ä½ å¯ä»¥åˆ›å»ºä½œç”¨åŸŸï¼Œä»¥åŠæ”¹å˜å“ªäº›åç§°åœ¨ä½œç”¨åŸŸå†…è¿˜æ˜¯ä½œç”¨åŸŸå¤–ã€‚åŒä¸€ä¸ªä½œç”¨åŸŸå†…ä¸èƒ½æ‹¥æœ‰ä¸¤ä¸ªç›¸åŒåç§°çš„é¡¹ï¼›å¯ä»¥ä½¿ç”¨ä¸€äº›å·¥å…·æ¥è§£å†³åç§°å†²çªã€‚
Rust æœ‰è®¸å¤šåŠŸèƒ½å¯ä»¥è®©ä½ ç®¡ç†ä»£ç çš„ç»„ç»‡ï¼ŒåŒ…æ‹¬å“ªäº›å†…å®¹å¯ä»¥è¢«å…¬å¼€ï¼Œå“ªäº›å†…å®¹ä½œä¸ºç§æœ‰éƒ¨åˆ†ï¼Œä»¥åŠç¨‹åºæ¯ä¸ªä½œç”¨åŸŸä¸­çš„åå­—ã€‚è¿™äº›åŠŸèƒ½ã€‚è¿™æœ‰æ—¶è¢«ç§°ä¸º â€œæ¨¡å—ç³»ç»Ÿï¼ˆthe module systemï¼‰â€ï¼ŒåŒ…æ‹¬ï¼š

- åŒ…ï¼ˆPackagesï¼‰ï¼šCargo çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒå…è®¸ä½ æ„å»ºã€æµ‹è¯•å’Œåˆ†äº« crateã€‚
- Crates ï¼šä¸€ä¸ªæ¨¡å—çš„æ ‘å½¢ç»“æ„ï¼Œå®ƒå½¢æˆäº†åº“æˆ–äºŒè¿›åˆ¶é¡¹ç›®ã€‚
- æ¨¡å—ï¼ˆModulesï¼‰å’Œ useï¼šå…è®¸ä½ æ§åˆ¶ä½œç”¨åŸŸå’Œè·¯å¾„çš„ç§æœ‰æ€§ã€‚
- è·¯å¾„ï¼ˆpathï¼‰ï¼šä¸€ä¸ªå‘½åä¾‹å¦‚ç»“æ„ä½“ã€å‡½æ•°æˆ–æ¨¡å—ç­‰é¡¹çš„æ–¹å¼ã€‚

##### åˆ›å»ºåŒ…
```shell
$ cargo new my-project
```
ç›®å½•ç»“æ„
![](readme.assets/Pasted%20image%2020230731234223.png)
##### å®šä¹‰æ¨¡å—
æ¨¡å—ç³»ç»Ÿçš„éƒ¨åˆ†ï¼Œå¦‚å…è®¸ä½ å‘½åé¡¹çš„ è·¯å¾„ï¼ˆpathsï¼‰ï¼›ç”¨æ¥å°†è·¯å¾„å¼•å…¥ä½œç”¨åŸŸçš„ use å…³é”®å­—ï¼›ä»¥åŠä½¿é¡¹å˜ä¸ºå…¬æœ‰çš„ pub å…³é”®å­—ã€‚æˆ‘ä»¬è¿˜å°†è®¨è®º as å…³é”®å­—ã€å¤–éƒ¨åŒ…å’Œ glob è¿ç®—ç¬¦ã€‚
```
ä» crate æ ¹èŠ‚ç‚¹å¼€å§‹: å½“ç¼–è¯‘ä¸€ä¸ª crate, ç¼–è¯‘å™¨é¦–å…ˆåœ¨ crate æ ¹æ–‡ä»¶ï¼ˆé€šå¸¸ï¼Œå¯¹äºä¸€ä¸ªåº“ crate è€Œè¨€æ˜¯src/lib.rsï¼Œå¯¹äºä¸€ä¸ªäºŒè¿›åˆ¶ crate è€Œè¨€æ˜¯src/main.rsï¼‰ä¸­å¯»æ‰¾éœ€è¦è¢«ç¼–è¯‘çš„ä»£ç ã€‚

å£°æ˜æ¨¡å—: åœ¨ crate æ ¹æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥å£°æ˜ä¸€ä¸ªæ–°æ¨¡å—ï¼›æ¯”å¦‚ï¼Œä½ ç”¨mod gardenå£°æ˜äº†ä¸€ä¸ªå«åšgardençš„æ¨¡å—ã€‚ç¼–è¯‘å™¨ä¼šåœ¨ä¸‹åˆ—è·¯å¾„ä¸­å¯»æ‰¾æ¨¡å—ä»£ç ï¼š
å†…è”ï¼Œåœ¨å¤§æ‹¬å·ä¸­ï¼Œå½“mod gardenåæ–¹ä¸æ˜¯ä¸€ä¸ªåˆ†å·è€Œæ˜¯ä¸€ä¸ªå¤§æ‹¬å·
åœ¨æ–‡ä»¶ src/garden.rs
åœ¨æ–‡ä»¶ src/garden/mod.rs

å£°æ˜å­æ¨¡å—: åœ¨é™¤äº† crate æ ¹èŠ‚ç‚¹ä»¥å¤–çš„å…¶ä»–æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥å®šä¹‰å­æ¨¡å—ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½åœ¨src/garden.rsä¸­å®šä¹‰äº†mod vegetables;ã€‚ç¼–è¯‘å™¨ä¼šåœ¨ä»¥çˆ¶æ¨¡å—å‘½åçš„ç›®å½•ä¸­å¯»æ‰¾å­æ¨¡å—ä»£ç ï¼š
å†…è”ï¼Œåœ¨å¤§æ‹¬å·ä¸­ï¼Œå½“mod vegetablesåæ–¹ä¸æ˜¯ä¸€ä¸ªåˆ†å·è€Œæ˜¯ä¸€ä¸ªå¤§æ‹¬å·
åœ¨æ–‡ä»¶ src/garden/vegetables.rs
åœ¨æ–‡ä»¶ src/garden/vegetables/mod.rs

æ¨¡å—ä¸­çš„ä»£ç è·¯å¾„: ä¸€æ—¦ä¸€ä¸ªæ¨¡å—æ˜¯ä½  crate çš„ä¸€éƒ¨åˆ†ï¼Œä½ å¯ä»¥åœ¨éšç§è§„åˆ™å…è®¸çš„å‰æä¸‹ï¼Œä»åŒä¸€ä¸ª crate å†…çš„ä»»æ„åœ°æ–¹ï¼Œé€šè¿‡ä»£ç è·¯å¾„å¼•ç”¨è¯¥æ¨¡å—çš„ä»£ç ã€‚ä¸¾ä¾‹è€Œè¨€ï¼Œä¸€ä¸ª garden vegetables æ¨¡å—ä¸‹çš„Asparagusç±»å‹å¯ä»¥åœ¨crate::garden::vegetables::Asparagusè¢«æ‰¾åˆ°ã€‚

ç§æœ‰ vs å…¬ç”¨: ä¸€ä¸ªæ¨¡å—é‡Œçš„ä»£ç é»˜è®¤å¯¹å…¶çˆ¶æ¨¡å—ç§æœ‰ã€‚ä¸ºäº†ä½¿ä¸€ä¸ªæ¨¡å—å…¬ç”¨ï¼Œåº”å½“åœ¨å£°æ˜æ—¶ä½¿ç”¨pub modæ›¿ä»£modã€‚ä¸ºäº†ä½¿ä¸€ä¸ªå…¬ç”¨æ¨¡å—å†…éƒ¨çš„æˆå‘˜å…¬ç”¨ï¼Œåº”å½“åœ¨å£°æ˜å‰ä½¿ç”¨pubã€‚

use å…³é”®å­—: åœ¨ä¸€ä¸ªä½œç”¨åŸŸå†…ï¼Œuseå…³é”®å­—åˆ›å»ºäº†ä¸€ä¸ªæˆå‘˜çš„å¿«æ·æ–¹å¼ï¼Œç”¨æ¥å‡å°‘é•¿è·¯å¾„çš„é‡å¤ã€‚åœ¨ä»»ä½•å¯ä»¥å¼•ç”¨crate::garden::vegetables::Asparagusçš„ä½œç”¨åŸŸï¼Œä½ å¯ä»¥é€šè¿‡ use crate::garden::vegetables::Asparagus;åˆ›å»ºä¸€ä¸ªå¿«æ·æ–¹å¼ï¼Œç„¶åä½ å°±å¯ä»¥åœ¨ä½œç”¨åŸŸä¸­åªå†™Asparagusæ¥ä½¿ç”¨è¯¥ç±»å‹ã€‚
```
###### åˆ›å»ºåº“
```shell
cargo new --lib restaurant
```
src/main.rs å’Œ src/lib.rs å«åš crate æ ¹ã€‚ä¹‹æ‰€ä»¥è¿™æ ·å«å®ƒä»¬æ˜¯å› ä¸ºè¿™ä¸¤ä¸ªæ–‡ä»¶çš„å†…å®¹éƒ½åˆ†åˆ«åœ¨ crate æ¨¡å—ç»“æ„çš„æ ¹ç»„æˆäº†ä¸€ä¸ªåä¸º crate çš„æ¨¡å—ï¼Œè¯¥ç»“æ„è¢«ç§°ä¸º æ¨¡å—æ ‘ï¼ˆmodule treeï¼‰ã€‚
![](readme.assets/Pasted%20image%2020230801001058.png)
è·¯å¾„æœ‰ä¸¤ç§å½¢å¼ï¼š
- ç»å¯¹è·¯å¾„ï¼ˆabsolute pathï¼‰æ˜¯ä»¥ crate æ ¹ï¼ˆrootï¼‰å¼€å¤´çš„å…¨è·¯å¾„ï¼›å¯¹äºå¤–éƒ¨ crate çš„ä»£ç ï¼Œæ˜¯ä»¥ crate åå¼€å¤´çš„ç»å¯¹è·¯å¾„ï¼Œå¯¹äºå¯¹äºå½“å‰ crate çš„ä»£ç ï¼Œåˆ™ä»¥å­—é¢å€¼ crate å¼€å¤´ã€‚
- ç›¸å¯¹è·¯å¾„ï¼ˆrelative pathï¼‰ä»å½“å‰æ¨¡å—å¼€å§‹ï¼Œä»¥ selfã€super æˆ–å½“å‰æ¨¡å—çš„æ ‡è¯†ç¬¦å¼€å¤´ã€‚
ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„éƒ½åè·Ÿä¸€ä¸ªæˆ–å¤šä¸ªç”±åŒå†’å·ï¼ˆ::ï¼‰åˆ†å‰²çš„æ ‡è¯†ç¬¦ã€‚

```rust
// crate æ˜¯å½“å‰é¡¹ç›®çš„æ ¹æ–‡ä»¶, å¯¹äºä¸€ä¸ªäºŒè¿›åˆ¶ crate è€Œè¨€æ˜¯src/main.rs

// gardançš„ä»£ç è·¯å¾„

use crate::garden::vegetables::Asparagus;

// ç”³æ˜å­æ¨¡å—çš„è·¯å¾„

pub mod garden;

  

fn main() {

let plant = Asparagus {};

println!("I'm growing {:?}!", plant);

my::indirect_call();

}

  
  

fn function() {

println!("called `function()`");

}

  

mod cool {

pub fn function() {

println!("called `cool::function()`");

}

}

  

mod my {

fn function() {

println!("called `my::function()`");

}

mod cool {

pub fn function() {

println!("called `my::cool::function()`");

}

}

pub fn indirect_call() {

// è®©æˆ‘ä»¬ä»è¿™ä¸ªä½œç”¨åŸŸä¸­è®¿é—®æ‰€æœ‰åä¸º `function` çš„å‡½æ•°ï¼

print!("called `my::indirect_call()`, that\n> ");

// `self` å…³é”®å­—è¡¨ç¤ºå½“å‰çš„æ¨¡å—ä½œç”¨åŸŸâ€”â€”åœ¨è¿™ä¸ªä¾‹å­æ˜¯ `my`ã€‚

// è°ƒç”¨ `self::function()` å’Œç›´æ¥è°ƒç”¨ `function()` éƒ½å¾—åˆ°ç›¸åŒçš„ç»“æœï¼Œ

// å› ä¸ºä»–ä»¬è¡¨ç¤ºç›¸åŒçš„å‡½æ•°ã€‚

self::function();

function();

// æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ `self` æ¥è®¿é—® `my` å†…éƒ¨çš„å¦ä¸€ä¸ªæ¨¡å—ï¼š

self::cool::function();

// `super` å…³é”®å­—è¡¨ç¤ºçˆ¶ä½œç”¨åŸŸï¼ˆåœ¨ `my` æ¨¡å—å¤–é¢ï¼‰ã€‚

super::function();

// è¿™å°†åœ¨ *crate* ä½œç”¨åŸŸå†…ç»‘å®š `cool::function` ã€‚

// åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œcrate ä½œç”¨åŸŸæ˜¯æœ€å¤–é¢çš„ä½œç”¨åŸŸã€‚

{

use crate::cool::function as root_function;

root_function();

}

}

}
```
##### ä½¿ç”¨å…±æœ‰ç»“æ„ä½“
```rust
mod back_of_house {

// å…±æœ‰ç»“æ„ä½“

pub struct Breakfast {

pub toast: String,

seasonal_fruit: String,

}

  

impl Breakfast {

pub fn summer(toast: &str) -> Breakfast {

Breakfast {

toast: String::from(toast),

seasonal_fruit: String::from("peaches"),

}

}

}

}

  

pub fn eat_at_restaurant() {

// åœ¨å¤å¤©è®¢è´­ä¸€ä¸ªé»‘éº¦åœŸå¸ä½œä¸ºæ—©é¤

let mut meal = back_of_house::Breakfast::summer("Rye");

// æ”¹å˜ä¸»æ„æ›´æ¢æƒ³è¦é¢åŒ…çš„ç±»å‹

meal.toast = String::from("Wheat");

println!("I'd like {} toast please", meal.toast);

  

// å¦‚æœå–æ¶ˆä¸‹ä¸€è¡Œçš„æ³¨é‡Šä»£ç ä¸èƒ½ç¼–è¯‘ï¼›

// ä¸å…è®¸æŸ¥çœ‹æˆ–ä¿®æ”¹æ—©é¤é™„å¸¦çš„å­£èŠ‚æ°´æœ

// meal.seasonal_fruit = String::from("blueberries");

}
```
```rust
mod back_of_house {

// å…±æœ‰æšä¸¾

pub enum Appetizer {

Soup,

Salad,

}

}

  

pub fn eat_at_restaurant() {

let order1 = back_of_house::Appetizer::Soup;

let order2 = back_of_house::Appetizer::Salad;

}

```
##### ä½¿ç”¨use
```rust
// ä½¿ç”¨useå°†æ¨¡å—å¼•å…¥ä½œç”¨åŸŸ

  

mod front_of_house {

pub mod hosting {

pub fn add_to_waitlist() {}

}

}

  

use crate::front_of_house::hosting;

  

pub fn eat_at_restaurant() {

hosting::add_to_waitlist();

}
```
```rust
mod front_of_house {

pub mod hosting {

pub fn add_to_waitlist() {}

}

}

  

use crate::front_of_house::hosting;

  

mod customer {

// ç¼–è¯‘å™¨é”™è¯¯æ˜¾ç¤ºçŸ­è·¯å¾„ä¸åœ¨é€‚ç”¨äº customer æ¨¡å—ä¸­ï¼š

// use crate::front_of_house::hosting;

pub fn eat_at_restaurant() {

hosting::add_to_waitlist();

}

}
```
```rust
use std::fmt;

use std::io;

// å¦‚ä½•å°†ä¸¤ä¸ªå…·æœ‰ç›¸åŒåç§°ä½†ä¸åŒçˆ¶æ¨¡å—çš„ Result ç±»å‹å¼•å…¥ä½œç”¨åŸŸï¼Œä»¥åŠå¦‚ä½•å¼•ç”¨å®ƒä»¬ã€‚

fn function1() -> fmt::Result {

// --snip--

Ok(())

}

  

fn function2() -> io::Result<()> {

// --snip--

Ok(())

}

  
  

// å¦ä¸€æ–¹é¢ï¼Œä½¿ç”¨ use å¼•å…¥ç»“æ„ä½“ã€æšä¸¾å’Œå…¶ä»–é¡¹æ—¶ï¼Œä¹ æƒ¯æ˜¯æŒ‡å®šå®ƒä»¬çš„å®Œæ•´è·¯å¾„ã€‚ç¤ºä¾‹

use std::collections::HashMap;

fn test() {

let mut map = HashMap::new();

map.insert(1, 2);

}

  

// æ­£å¸¸å¼•ç”¨

mod front_of_house {

pub mod hosting {

pub fn add_to_waitlist() {}

}

}

  

use crate::front_of_house::hosting::add_to_waitlist;

  

pub fn eat_at_restaurant() {

add_to_waitlist();

}
```
##### ä½¿ç”¨as
```rust
use std::fmt::Result;

use std::io::Result as IoResult;

  

fn function1() -> Result {

// --snip--

Ok(())

}

  

fn function2() -> IoResult<()> {

// --snip--

Ok(())

}
```
##### äºŒæ¬¡å°è£…
```rust
mod front_of_house {

pub mod hosting {

pub fn add_to_waitlist() {}

}

}

  

pub use crate::front_of_house::hosting;

  

pub fn eat_at_restaurant() {

hosting::add_to_waitlist();

}
```
##### ä½¿ç”¨ä¸‰æ–¹åº“
![](readme.assets/Pasted%20image%2020230801005250.png)
![](readme.assets/Pasted%20image%2020230801005354.png)
##### å¼•ç”¨ä¸€ä¸ªåº“çš„å¤šä¸ªå‡½æ•°
![](readme.assets/Pasted%20image%2020230801005700.png)
##### å°†æ¨¡å—æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶
ç»éªŒé—®é¢˜ã€‚
![](readme.assets/Pasted%20image%2020230801010244.png)
#### å¸¸è§é›†åˆ
Rust æ ‡å‡†åº“ä¸­åŒ…å«ä¸€ç³»åˆ—è¢«ç§°ä¸º é›†åˆï¼ˆcollectionsï¼‰çš„éå¸¸æœ‰ç”¨çš„æ•°æ®ç»“æ„ã€‚å¤§éƒ¨åˆ†å…¶ä»–æ•°æ®ç±»å‹éƒ½ä»£è¡¨ä¸€ä¸ªç‰¹å®šçš„å€¼ï¼Œä¸è¿‡é›†åˆå¯ä»¥åŒ…å«å¤šä¸ªå€¼ã€‚ä¸åŒäºå†…å»ºçš„æ•°ç»„å’Œå…ƒç»„ç±»å‹ï¼Œè¿™äº›é›†åˆæŒ‡å‘çš„æ•°æ®æ˜¯å‚¨å­˜åœ¨å †ä¸Šçš„ï¼Œè¿™æ„å‘³ç€æ•°æ®çš„æ•°é‡ä¸å¿…åœ¨ç¼–è¯‘æ—¶å°±å·²çŸ¥ï¼Œå¹¶ä¸”è¿˜å¯ä»¥éšç€ç¨‹åºçš„è¿è¡Œå¢é•¿æˆ–ç¼©å°ã€‚æ¯ç§é›†åˆéƒ½æœ‰ç€ä¸åŒåŠŸèƒ½å’Œæˆæœ¬ï¼Œè€Œæ ¹æ®å½“å‰æƒ…å†µé€‰æ‹©åˆé€‚çš„é›†åˆï¼Œè¿™æ˜¯ä¸€é¡¹åº”å½“é€æ¸æŒæ¡çš„æŠ€èƒ½ã€‚åœ¨è¿™ä¸€ç« é‡Œï¼Œæˆ‘ä»¬å°†è¯¦ç»†çš„äº†è§£ä¸‰ä¸ªåœ¨ Rust ç¨‹åºä¸­è¢«å¹¿æ³›ä½¿ç”¨çš„é›†åˆï¼š

- vector å…è®¸æˆ‘ä»¬ä¸€ä¸ªæŒ¨ç€ä¸€ä¸ªåœ°å‚¨å­˜ä¸€ç³»åˆ—æ•°é‡å¯å˜çš„å€¼
- å­—ç¬¦ä¸²ï¼ˆstringï¼‰æ˜¯å­—ç¬¦çš„é›†åˆã€‚æˆ‘ä»¬ä¹‹å‰è§è¿‡ String ç±»å‹ï¼Œä¸è¿‡åœ¨æœ¬ç« æˆ‘ä»¬å°†æ·±å…¥äº†è§£ã€‚
- å“ˆå¸Œ mapï¼ˆhash mapï¼‰å…è®¸æˆ‘ä»¬å°†å€¼ä¸ä¸€ä¸ªç‰¹å®šçš„é”®ï¼ˆkeyï¼‰ç›¸å…³è”ã€‚è¿™æ˜¯ä¸€ä¸ªå«åš map çš„æ›´é€šç”¨çš„æ•°æ®ç»“æ„çš„ç‰¹å®šå®ç°ã€‚

##### åˆ—è¡¨vector
```rust
pub fn call() {

// åˆ›å»ºå­˜å‚¨åˆ—è¡¨ï¼Œæ•°æ®ç»“æ„

// let mut v: Vec<i32> = Vec::new();

// ç®€å†™æ–¹å¼

// let v = vec![1, 2, 3];

let mut v = vec![];

// å¼€å§‹å †æ ˆ

v.push(5);

v.push(6);

v.push(7);

v.push(8);

println!("{:?}", v);

  

// å¼•ç”¨

let third: &i32 = &v[2];

println!("The third element is {third}");

  

// è·å–

let third: Option<&i32> = v.get(2);

match third {

Some(third) => println!("The third element is {third}"),

None => println!("There is no third element."),

}

  

// let does_not_exist = &v[100];

// println!("{}", does_not_exist);

  

// get å¯ä»¥é¿å…ç´¢å¼•æŠ¥é”™ã€‚å–ä¸åˆ°çš„å€¼ï¼Œç”¨noneä»£æ›¿

let does_not_exist = v.get(100);

println!("{:?}", does_not_exist);

}

  

pub fn call2() {

// å·²ç»ä¸ä¼šæŠ¥é”™äº†

let mut v = vec![1, 2, 3, 4, 5];

let first = &v[0];

v.push(6);

}

  

pub fn call3() {

let v = vec![100, 32, 57];

// å¾ªç¯å¼•ç”¨

for i in &v {

println!("{i}");

}

  

// å¾ªç¯æ”¹å†™

let mut v = vec![100, 32, 57];

for i in &mut v {

*i += 50;

}

  

// æšä¸¾ç»“æ„è‡ªé€‚åº”

enum SpreadsheetCell {

Int(i32),

Float(f64),

Text(String),

}

  

let row = vec![

SpreadsheetCell::Int(3),

SpreadsheetCell::Text(String::from("blue")),

SpreadsheetCell::Float(10.12),

];

}
```

##### stringå­—ç¬¦ä¸²
åœ¨å¼€å§‹æ·±å…¥è¿™äº›æ–¹é¢ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è®¨è®ºä¸€ä¸‹æœ¯è¯­ å­—ç¬¦ä¸² çš„å…·ä½“æ„ä¹‰ã€‚Rust çš„æ ¸å¿ƒè¯­è¨€ä¸­åªæœ‰ä¸€ç§å­—ç¬¦ä¸²ç±»å‹ï¼šå­—ç¬¦ä¸² slice strï¼Œå®ƒé€šå¸¸ä»¥è¢«å€Ÿç”¨çš„å½¢å¼å‡ºç°ï¼Œ&strã€‚ç¬¬å››ç« è®²åˆ°äº† å­—ç¬¦ä¸² slicesï¼šå®ƒä»¬æ˜¯ä¸€äº›å¯¹å‚¨å­˜åœ¨åˆ«å¤„çš„ UTF-8 ç¼–ç å­—ç¬¦ä¸²æ•°æ®çš„å¼•ç”¨ã€‚
```rust
pub fn strMain() {

// ç©ºå­—ç¬¦ä¸²

let mut s = String::new();

  

// ä¸å¯å˜å­—ç¬¦ä¸²

let data = "initial contents";

  

// è½¬å­—ç¬¦ä¸²

let s = data.to_string();

  

// è¯¥æ–¹æ³•ä¹Ÿå¯ç›´æ¥ç”¨äºå­—ç¬¦ä¸²å­—é¢å€¼ï¼š

let s = "initial contents".to_string();

  

// åˆ›å»ºå­—ç¬¦ä¸²

let s = String::from("initial contents");

  

// è¿½åŠ å­—ç¬¦ä¸² çš„ å‡ ç§æ–¹å¼

let mut s = String::from("foo");

s.push_str("bar");

s += "baz";

s.push('l');

println!("{}", s);

  

// ä½¿ç”¨format!

let s1 = String::from("tic");

let s2 = String::from("tac");

let s3 = String::from("toe");

let s = format!("{s1}-{s2}-{s3}");

println!("{}", s);

  

// !ç´¢å¼•å­—ç¬¦ä¸²ï¼Ÿæ ¹æœ¬ä¸æ”¯æŒçš„ã€‚

// * 1.å­—ç¬¦ä¸²é•¿åº¦åœ¨å†…å­˜ä¸­ä¸æ˜¯å­—é¢é‡çš„é•¿åº¦

// * 2.let hello = "Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ";let answer = &hello[0];

// let hello = "Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ";

// let answer = &hello[0];

  

// éå†å­—ç¬¦ä¸²

for c in "Ğ—Ğ´".chars() {

println!("{c}");

}

for b in "Ğ—Ğ´".bytes() {

println!("{b}");

}

  

/*

æ ‡å‡†åº“æä¾›äº†å¾ˆå¤šå›´ç»• String å’Œ &str æ„å»ºçš„åŠŸèƒ½ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬æ­£ç¡®å¤„ç†è¿™äº›å¤æ‚åœºæ™¯ã€‚è¯·åŠ¡å¿…æŸ¥çœ‹è¿™äº›ä½¿ç”¨æ–¹æ³•çš„æ–‡æ¡£ï¼Œä¾‹å¦‚ contains æ¥æœç´¢ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå’Œ replace å°†å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†æ›¿æ¢ä¸ºå¦ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚

  

ç§°ä½œ String çš„ç±»å‹æ˜¯ç”±æ ‡å‡†åº“æä¾›çš„ï¼Œè€Œæ²¡æœ‰å†™è¿›æ ¸å¿ƒè¯­è¨€éƒ¨åˆ†ï¼Œå®ƒæ˜¯å¯å¢é•¿çš„ã€å¯å˜çš„ã€æœ‰æ‰€æœ‰æƒçš„ã€UTF-8 ç¼–ç çš„å­—ç¬¦ä¸²ç±»å‹ã€‚å½“ Rustacean ä»¬è°ˆåˆ° Rust çš„ â€œå­—ç¬¦ä¸²â€æ—¶ï¼Œå®ƒä»¬é€šå¸¸æŒ‡çš„æ˜¯ String æˆ–å­—ç¬¦ä¸² slice &str ç±»å‹ï¼Œè€Œä¸ç‰¹æŒ‡å…¶ä¸­æŸä¸€ä¸ªã€‚

*/

}
```
##### hash map å­˜å‚¨é”®å€¼å¯¹
å¸¸ç”¨é›†åˆç±»å‹æ˜¯ å“ˆå¸Œ mapï¼ˆhash mapï¼‰ã€‚HashMap<K, V> ç±»å‹å‚¨å­˜äº†ä¸€ä¸ªé”®ç±»å‹ K å¯¹åº”ä¸€ä¸ªå€¼ç±»å‹ V çš„æ˜ å°„ã€‚å®ƒé€šè¿‡ä¸€ä¸ª å“ˆå¸Œå‡½æ•°ï¼ˆhashing functionï¼‰æ¥å®ç°æ˜ å°„ï¼Œå†³å®šå¦‚ä½•å°†é”®å’Œå€¼æ”¾å…¥å†…å­˜ä¸­ã€‚
```rust
use std::collections::HashMap;

  

pub fn hashmaps() {

let mut scores = HashMap::new();

// å†™å…¥å€¼

scores.insert(String::from("Blue"), 10);

scores.insert(String::from("Yellow"), 50);

for (key, value) in &scores {

println!("{key}: {value}");

}

// è®¿é—®å€¼

let team_name = String::from("Blue");

let score = scores.get(&team_name).copied().unwrap_or(0);

  

// æ’å…¥hash

let field_name = String::from("Favorite color");

let field_value = String::from("Blue");

let mut map = HashMap::new();

// field_nameï¼Œ field_name ç«‹åˆ»å¤±æ•ˆ

map.insert(field_name, field_value);

  

// è¦†ç›–æ›´æ–°hash

scores.insert(String::from("Blue"), 10);

scores.insert(String::from("Blue"), 25);

// æ£€æŸ¥æ›´æ–°ï¼Œæ²¡æœ‰æ‰å¢åŠ 

scores.entry(String::from("Yellow")).or_insert(50);

scores.entry(String::from("Blue")).or_insert(50);

  

// æ ¹æ®æ—§å€¼æ›´æ–°æ–°å€¼

let text = "hello world wonderful world";

let mut map = HashMap::new();

for word in text.split_whitespace() {

let count = map.entry(word).or_insert(0);

*count += 1;

}

println!("{:?}", map);

}
```

#### â­ï¸é”™è¯¯å¤„ç†
é”™è¯¯æ˜¯è½¯ä»¶ä¸­ä¸å¯å¦è®¤çš„äº‹å®ï¼Œæ‰€ä»¥ Rust æœ‰ä¸€äº›å¤„ç†å‡ºé”™æƒ…å†µçš„ç‰¹æ€§ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼ŒRust è¦æ±‚ä½ æ‰¿è®¤é”™è¯¯çš„å¯èƒ½æ€§ï¼Œå¹¶åœ¨ä½ çš„ä»£ç ç¼–è¯‘å‰é‡‡å–ä¸€äº›è¡ŒåŠ¨ã€‚è¿™ä¸€è¦æ±‚ä½¿ä½ çš„ç¨‹åºæ›´åŠ å¥å£®ï¼Œå› ä¸ºå®ƒå¯ä»¥ç¡®ä¿ä½ åœ¨å°†ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¹‹å‰å°±èƒ½å‘ç°é”™è¯¯å¹¶è¿›è¡Œé€‚å½“çš„å¤„ç†ã€‚

Rust å°†é”™è¯¯åˆ†ä¸ºä¸¤å¤§ç±»ï¼š
å¯æ¢å¤çš„ï¼ˆrecoverableï¼‰
ä¸å¯æ¢å¤çš„ï¼ˆunrecoverableï¼‰é”™è¯¯ã€‚
å¯¹äºä¸€ä¸ªå¯æ¢å¤çš„é”™è¯¯ï¼Œæ¯”å¦‚æ–‡ä»¶æœªæ‰¾åˆ°çš„é”™è¯¯ï¼Œæˆ‘ä»¬å¾ˆå¯èƒ½åªæƒ³å‘ç”¨æˆ·æŠ¥å‘Šé—®é¢˜å¹¶é‡è¯•æ“ä½œã€‚
ä¸å¯æ¢å¤çš„é”™è¯¯æ€»æ˜¯ bug å‡ºç°çš„å¾å…†ï¼Œæ¯”å¦‚è¯•å›¾è®¿é—®ä¸€ä¸ªè¶…è¿‡æ•°ç»„æœ«ç«¯çš„ä½ç½®ï¼Œå› æ­¤æˆ‘ä»¬è¦ç«‹å³åœæ­¢ç¨‹åºã€‚

å¤§å¤šæ•°è¯­è¨€å¹¶ä¸åŒºåˆ†è¿™ä¸¤ç§é”™è¯¯ï¼Œå¹¶é‡‡ç”¨ç±»ä¼¼å¼‚å¸¸è¿™æ ·æ–¹å¼ç»Ÿä¸€å¤„ç†ä»–ä»¬ã€‚Rust æ²¡æœ‰å¼‚å¸¸ã€‚ç›¸åï¼Œå®ƒæœ‰ Result<T, E> ç±»å‹ï¼Œç”¨äºå¤„ç†å¯æ¢å¤çš„é”™è¯¯ï¼Œè¿˜æœ‰ panic! å®ï¼Œåœ¨ç¨‹åºé‡åˆ°ä¸å¯æ¢å¤çš„é”™è¯¯æ—¶åœæ­¢æ‰§è¡Œã€‚
##### ä¸å¯æ¢å¤é”™è¯¯panic
ä¿®æ”¹é…ç½®cargo.tomlï¼Œå¼€å¯ç»ˆæ­¢ã€‚
åœ¨ä»»æ„rsä¸­å†™å…¥panicã€‚
![](readme.assets/Pasted%20image%2020230805153742.png)
##### å¯æ¢å¤é”™è¯¯result
ä¸»è¦æ˜¯åˆ©ç”¨æšä¸¾ï¼Œç©·å°½å¼‚å¸¸ã€‚
```rust
let greeting_file_result = File::open("hello.txt");

let greeting_file = match greeting_file_result {

Ok(file) => file,

// è¿™é‡Œåˆ™æ˜¯é€šç”¨å¼‚å¸¸

// Err(error) => panic!("Problem opening the file: {:?}", error),

// æšä¸¾å†ç»†åŒ–ï¼ŒåŒºåˆ†ä¸åŒçš„é”™è¯¯

Err(error) => match error.kind() {

// æ‰¾ä¸åˆ°æ–‡ä»¶ï¼Œåˆ™åˆ›å»ºæ–‡ä»¶

ErrorKind::NotFound => match File::create("hello.txt") {

Ok(fc) => fc,

Err(e) => panic!("Problem creating the file: {:?}", e),

},

// å…¶ä»–å¼‚å¸¸å°±çˆ†å‡º

other_error => {

panic!("Problem opening the file: {:?}", other_error);

}

},

};
```
###### ä½¿ç”¨é—­åŒ…åæ›´å¥½çš„å†™æ³•
```rust
let greeting_file = File::open("hello.txt").unwrap_or_else(|error| {

if error.kind() == ErrorKind::NotFound {

File::create("hello.txt").unwrap_or_else(|error| {

panic!("Problem creating the file: {:?}", error);

})

} else {

panic!("Problem opening the file: {:?}", error);

}

});
```

###### é”™è¯¯ä¼ æ’­
æ ‡å‡†æ ¼å¼
```rust
// ä¼ æ’­ propagating

fn read_username_from_file() -> Result<String, io::Error> {

let username_file_result = File::open("hello.txt");

// æ‰“å¼€æ–‡ä»¶

let mut username_file = match username_file_result {

Ok(file) => file,

Err(e) => return Err(e),

};

// è¯»å–æ–‡ä»¶å†…å®¹

let mut username = String::new();

match username_file.read_to_string(&mut username) {

Ok(_) => Ok(username),

Err(e) => Err(e),

}

}
```

ç®€å†™æ ¼å¼ã€‚
```rust
fn read_username_from_file2() -> Result<String, io::Error> {

let mut username_file = File::open("hello.txt")?;

let mut username = String::new();

username_file.read_to_string(&mut username)?;

Ok(username)

}
```
å†æ¬¡ç®€å†™
```rust
fn read_username_from_file3() -> Result<String, io::Error> {

let mut username = String::new();

File::open("hello.txt")?.read_to_string(&mut username)?;

Ok(username)

}
```
å†æ¬¡ç®€å†™
```rust
// å†æ¬¡ç®€å†™

fn read_username_from_file4() -> Result<String, io::Error> {
    fs::read_to_string("hello.txt");
```
##### ä¸»å‡½æ•°æ•è·å¼‚å¸¸
```rust
// crate æ˜¯å½“å‰é¡¹ç›®çš„æ ¹æ–‡ä»¶, å¯¹äºä¸€ä¸ªäºŒè¿›åˆ¶ crate è€Œè¨€æ˜¯src/main.rs

// gardançš„ä»£ç è·¯å¾„

// use crate::garden::vegetables::Asparagus;

// ç”³æ˜å­æ¨¡å—çš„è·¯å¾„

// mod garden;

  

// è°ƒç”¨fsæ–‡ä»¶ç³»ç»Ÿ

use std::fs::File;

// use std::io::ErrorKind;

use std::error::Error;

// è°ƒç”¨å¼‚å¸¸æ•è·

mod err;

use err::demo;

  

fn main() -> Result<(), Box<dyn Error>> {

// !æ¨¡å—è·¯å¾„çŸ¥è¯†å­¦ä¹ å®Œæ¯•

// let plant = Asparagus {};

// println!("I'm growing {:?}!", plant);

// my::indirect_call();

  

// !è¿™é‡Œæˆ‘ä»¬å­¦ä¹ panic ä¸å¯æ¢å¤é”™è¯¯

// panic!("crash and burn");

/*

è¿™é‡Œå°è¯•è®¿é—® vector çš„ç¬¬ä¸€ç™¾ä¸ªå…ƒç´ ï¼ˆè¿™é‡Œçš„ç´¢å¼•æ˜¯ 99 å› ä¸ºç´¢å¼•ä» 0 å¼€å§‹ï¼‰ï¼Œä¸è¿‡å®ƒåªæœ‰ä¸‰ä¸ªå…ƒç´ ã€‚è¿™ç§æƒ…å†µä¸‹ Rust ä¼š panicã€‚[] åº”å½“è¿”å›ä¸€ä¸ªå…ƒç´ ï¼Œä¸è¿‡å¦‚æœä¼ é€’äº†ä¸€ä¸ªæ— æ•ˆç´¢å¼•ï¼Œå°±æ²¡æœ‰å¯ä¾› Rust è¿”å›çš„æ­£ç¡®çš„å…ƒç´ ã€‚

  

*C è¯­è¨€ä¸­ï¼Œå°è¯•è¯»å–æ•°æ®ç»“æ„ä¹‹åçš„å€¼æ˜¯æœªå®šä¹‰è¡Œä¸ºï¼ˆundefined behaviorï¼‰ã€‚ä½ ä¼šå¾—åˆ°ä»»ä½•å¯¹åº”æ•°æ®ç»“æ„ä¸­è¿™ä¸ªå…ƒç´ çš„å†…å­˜ä½ç½®çš„å€¼ï¼Œç”šè‡³æ˜¯è¿™äº›å†…å­˜å¹¶ä¸å±äºè¿™ä¸ªæ•°æ®ç»“æ„çš„æƒ…å†µã€‚è¿™è¢«ç§°ä¸º ç¼“å†²åŒºæº¢å‡ºï¼ˆbuffer overreadï¼‰ï¼Œå¹¶å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨æ¼æ´ï¼Œæ¯”å¦‚æ”»å‡»è€…å¯ä»¥åƒè¿™æ ·æ“ä½œç´¢å¼•æ¥è¯»å–å‚¨å­˜åœ¨æ•°æ®ç»“æ„ä¹‹åä¸è¢«å…è®¸çš„æ•°æ®ã€‚

  

ä¸ºäº†ä¿æŠ¤ç¨‹åºè¿œç¦»è¿™ç±»æ¼æ´ï¼Œå¦‚æœå°è¯•è¯»å–ä¸€ä¸ªç´¢å¼•ä¸å­˜åœ¨çš„å…ƒç´ ï¼ŒRust ä¼šåœæ­¢æ‰§è¡Œå¹¶æ‹’ç»ç»§ç»­ã€‚å°è¯•è¿è¡Œä¸Šé¢çš„ç¨‹åºä¼šå‡ºç°å¦‚ä¸‹ï¼š

*/

// let v = vec![1, 2, 3, 4];

// v[99];

// ? shellæ‰§è¡Œ RUST_BACKTRACE=1 cargo run å³å¯è·å–æ›´è¯¦ç»†çš„æŠ¥é”™å†…å®¹

  

// !å¤„ç†resultï¼Œå¯æ¢å¤é”™è¯¯

// ?æœ¬è´¨æ˜¯åˆ©ç”¨äº†æšä¸¾æˆåŠŸorå¤±è´¥

// enum Result<T, E> {

// Ok(T),

// Err(E),

// }

// æ‰“å¼€æ–‡ä»¶

// let greeting_file_result = File::open("hello.txt");

// let greeting_file = match greeting_file_result {

// Ok(file) => file,

// // è¿™é‡Œåˆ™æ˜¯é€šç”¨å¼‚å¸¸

// // Err(error) => panic!("Problem opening the file: {:?}", error),

// // æšä¸¾å†ç»†åŒ–ï¼ŒåŒºåˆ†ä¸åŒçš„é”™è¯¯

// Err(error) => match error.kind() {

// // æ‰¾ä¸åˆ°æ–‡ä»¶ï¼Œåˆ™åˆ›å»ºæ–‡ä»¶

// ErrorKind::NotFound => match File::create("hello.txt") {

// Ok(fc) => fc,

// Err(e) => panic!("Problem creating the file: {:?}", e),

// },

// // å…¶ä»–å¼‚å¸¸å°±çˆ†å‡º

// other_error => {

// panic!("Problem opening the file: {:?}", other_error);

// }

// },

// };

  

// * æ›´å¥½çš„å†™æ³•ï¼Œåˆ©ç”¨é—­åŒ…

// åˆ©ç”¨é“¾å¼è°ƒç”¨

// let greeting_file = File::open("hello.txt").unwrap_or_else(|error| {

// if error.kind() == ErrorKind::NotFound {

// File::create("hello.txt").unwrap_or_else(|error| {

// panic!("Problem creating the file: {:?}", error);

// })

// } else {

// panic!("Problem opening the file: {:?}", error);

// }

// });

  

// ? é“¾å¼è¯­æ³•ï¼Œç±»ä¼¼promise then cacheçš„å¼‚å¸¸å¤„ç†æ–¹æ³•

// let greeting_file = File::open("hello.txt").unwrap();

// let greeting_file =

// File::open("hello.txt").expect("hello.txt should be included in this project");

  

// ? è¿™é‡Œå¼•ç”¨err.rsä¸­çš„å…¶ä»–api

demo();

  

// todo å“ªæ€•æ˜¯ä¸»å‡½æ•°ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œé”™è¯¯ä¼ é€’

let greeting_file_result = File::open("hello.txt")?;

Ok(())

}

  

fn function() {

println!("called `function()`");

}

  

// module cool æ¨¡å—cool

mod cool {

pub fn function() {

println!("called `cool::function()`");

}

}

  

// æ¨¡å—my

mod my {

fn function() {

println!("called `my::function()`");

}

  

mod cool {

pub fn function() {

println!("called `my::cool::function()`");

}

}

  

pub fn indirect_call() {

// è®©æˆ‘ä»¬ä»è¿™ä¸ªä½œç”¨åŸŸä¸­è®¿é—®æ‰€æœ‰åä¸º `function` çš„å‡½æ•°ï¼

print!("called `my::indirect_call()`, that\n> ");

  

// `self` å…³é”®å­—è¡¨ç¤ºå½“å‰çš„æ¨¡å—ä½œç”¨åŸŸâ€”â€”åœ¨è¿™ä¸ªä¾‹å­æ˜¯ `my`ã€‚

// è°ƒç”¨ `self::function()` å’Œç›´æ¥è°ƒç”¨ `function()` éƒ½å¾—åˆ°ç›¸åŒçš„ç»“æœï¼Œ

// å› ä¸ºä»–ä»¬è¡¨ç¤ºç›¸åŒçš„å‡½æ•°ã€‚

self::function();

function();

  

// æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ `self` æ¥è®¿é—® `my` å†…éƒ¨çš„å¦ä¸€ä¸ªæ¨¡å—ï¼š

self::cool::function();

  

// `super` å…³é”®å­—è¡¨ç¤ºçˆ¶ä½œç”¨åŸŸï¼ˆåœ¨ `my` æ¨¡å—å¤–é¢ï¼‰ã€‚

super::function();

  

// è¿™å°†åœ¨ *crate* ä½œç”¨åŸŸå†…ç»‘å®š `cool::function` ã€‚

// åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œcrate ä½œç”¨åŸŸæ˜¯æœ€å¤–é¢çš„ä½œç”¨åŸŸã€‚

{

use crate::cool::function as root_function;

root_function();

}

}

}

  

// å•ä¸ªå¼•ç”¨

// use std::cmp::Ordering;

// å¼•ç”¨ä¸Šä¸€çº§

// use std::io;

// åµŒå¥—å¼•ç”¨

// use std::{cmp::Ordering, io};

// å•ä¸ªå¼•ç”¨

// use std::io::Write;

// æ‹¬å·æ‰¹é‡å¼•ç”¨

// use std::io::{self, Write};

// å…¨éƒ¨å¼•ç”¨

// use std::collections::*;
```
#### æ³›å‹ã€Traitã€ç”Ÿå‘½å‘¨æœŸ
åœ¨ Rust ä¸­å…¶å·¥å…·ä¹‹ä¸€å°±æ˜¯ æ³›å‹ï¼ˆgenericsï¼‰ã€‚æ³›å‹æ˜¯å…·ä½“ç±»å‹æˆ–å…¶ä»–å±æ€§çš„æŠ½è±¡æ›¿ä»£ã€‚æˆ‘ä»¬å¯ä»¥è¡¨è¾¾æ³›å‹çš„å±æ€§ï¼Œæ¯”å¦‚ä»–ä»¬çš„è¡Œä¸ºæˆ–å¦‚ä½•ä¸å…¶ä»–æ³›å‹ç›¸å…³è”ï¼Œè€Œä¸éœ€è¦åœ¨ç¼–å†™å’Œç¼–è¯‘ä»£ç æ—¶çŸ¥é“ä»–ä»¬åœ¨è¿™é‡Œå®é™…ä¸Šä»£è¡¨ä»€ä¹ˆã€‚
traitï¼Œè¿™æ˜¯ä¸€ä¸ªå®šä¹‰æ³›å‹è¡Œä¸ºçš„æ–¹æ³•ã€‚trait å¯ä»¥ä¸æ³›å‹ç»“åˆæ¥å°†æ³›å‹é™åˆ¶ä¸ºåªæ¥å—æ‹¥æœ‰ç‰¹å®šè¡Œä¸ºçš„ç±»å‹ï¼Œè€Œä¸æ˜¯ä»»æ„ç±»å‹ã€‚
æœ€åä»‹ç» ç”Ÿå‘½å‘¨æœŸï¼ˆlifetimesï¼‰ï¼Œå®ƒæ˜¯ä¸€ç±»å…è®¸æˆ‘ä»¬å‘ç¼–è¯‘å™¨æä¾›å¼•ç”¨å¦‚ä½•ç›¸äº’å…³è”çš„æ³›å‹ã€‚Rust çš„ç”Ÿå‘½å‘¨æœŸåŠŸèƒ½å…è®¸åœ¨å¾ˆå¤šåœºæ™¯ä¸‹å€Ÿç”¨å€¼çš„åŒæ—¶ä»ç„¶ä½¿ç¼–è¯‘å™¨èƒ½å¤Ÿæ£€æŸ¥è¿™äº›å¼•ç”¨çš„æœ‰æ•ˆæ€§ã€‚
###### æ³›å‹T
```rust
fn type_of<T>(_: T) -> &'static str {

// é€šè¿‡æ³›å‹ï¼Œè·å–ç±»å‹

type_name::<T>()

}

  

fn largest_i32(list: &[i32]) -> &i32 {

let mut largest = &list[0];

for item in list {

if item > largest {

largest = item;

}

}

largest

}

fn largest_char(list: &[char]) -> &char {

let mut largest = &list[0];

for item in list {

if item > largest {

largest = item;

}

}

largest

}

  

// fn largest<T>(list: &[T]) -> &T {

// let mut largest = &list[0];

// for item in list {

// if item > largest {

// largest = item;

// }

// }

// largest

// }

fn main() {
// !æ³›å‹

// let number_list = vec![34, 50, 25, 100, 65];

// let mut largest = &number_list[0];

// for number in &number_list {

// if number > largest {

// largest = number;

// }

// }

// println!("The largest number is {}", largest);

// * æŠ½è±¡å±‚

// let number_list = vec![34, 50, 25, 100, 65];

// let result = largest_i32(&number_list);

// println!("The largest number is {}", result);

// let char_list = vec!['y', 'm', 'a', 'q'];

// let result = largest_char(&char_list);

// println!("The largest char is {}", result);

// * ä¼ å…¥æ³›å‹ï¼Œç”±è¾“å…¥å½¢å‚å†³å®šç±»å‹

// let number_list = vec![34, 50, 25, 100, 65];

// let result = largest(&number_list);

// println!("The largest number is {}", result);

  

// *ç»“æ„ä½“ä¸­æ³›å‹

// struct Point<T> {

// x: T,

// y: T,

// };

// #[derive(Debug)]

// struct Point1<T, U> {

// x: T,

// y: U,

// }

// impl<T, U> Point1<T, U> {

// fn x(&self) -> &T {

// &self.x

// }

// }

// å¼ºåˆ¶åˆ¶å®šæ³›å‹

// impl Point<f32> {

// fn distance_from_origin(&self) -> f32 {

// (self.x.powi(2) + self.y.powi(2)).sqrt()

// }

  

// }

// let wont_work = Point { x: 0, y: 4.0 }; // ä¼šæŠ¥é”™ï¼Œç±»å‹ä¸å®š

// let wont_work = Point1 { x: 0, y: 4.0 }; // ç¼–è¯‘é€šè¿‡ï¼Œ

// println!("{:?}", wont_work);

// * æšä¸¾æ³›å‹

// enum Option<T> {

// Some(T),

// None,

// }

// enum Result<T, E> {

// Ok(T),

// Err(E),

// }

// * æ³›å‹åµŒå¥—

// struct Point<X1, Y1> {

// x: X1,

// y: Y1,

// }

  

// impl<X1, Y1> Point<X1, Y1> {

// fn mixup<X2, Y2>(self, other: Point<X2, Y2>) -> Point<X1, Y2> {

// Point {

// x: self.x,

// y: other.y,

// }

// }

// }

// let p1 = Point { x: 5, y: 10.4 };

// let p2 = Point { x: "Hello", y: 'c' };

// let p3 = p1.mixup(p2);

// println!("p3.x = {}, p3.y = {}", p3.x, p3.y);

  

// let integer = Some(5);

// let float = Some(5.0);

// *Rust é€šè¿‡åœ¨ç¼–è¯‘æ—¶è¿›è¡Œæ³›å‹ä»£ç çš„ å•æ€åŒ–ï¼ˆmonomorphizationï¼‰æ¥ä¿è¯æ•ˆç‡ã€‚å•æ€åŒ–æ˜¯ä¸€ä¸ªé€šè¿‡å¡«å……ç¼–è¯‘æ—¶ä½¿ç”¨çš„å…·ä½“ç±»å‹ï¼Œå°†é€šç”¨ä»£ç è½¬æ¢ä¸ºç‰¹å®šä»£ç çš„è¿‡ç¨‹ã€‚

// let integer = Some(5);

// let float = Some(5.0);

// println!("{:?} is {}", integer, type_of(integer));

// println!("{:?} is {}", integer, type_of(float));Ã
}
```
###### æ¥å£trait
trait å®šä¹‰äº†æŸä¸ªç‰¹å®šç±»å‹æ‹¥æœ‰å¯èƒ½ä¸å…¶ä»–ç±»å‹å…±äº«çš„åŠŸèƒ½ã€‚å¯ä»¥é€šè¿‡ trait ä»¥ä¸€ç§æŠ½è±¡çš„æ–¹å¼å®šä¹‰å…±äº«çš„è¡Œä¸ºã€‚å¯ä»¥ä½¿ç”¨ trait bounds æŒ‡å®šæ³›å‹æ˜¯ä»»ä½•æ‹¥æœ‰ç‰¹å®šè¡Œä¸ºçš„ç±»å‹ã€‚

```rust
/*

! è¿™é‡Œæ”¾å…¥ interfaces æ¥å£

*/

pub trait Summary {

fn summarize(&self) -> String;

fn summarize_author(&self) -> String;

fn summarize_test(&self) -> String {

format!("è°ƒç”¨æˆ‘è‡ªå·±å‡½æ•° {}", self.summarize())

}

}

pub trait Summary2 {

fn summarize(&self) -> String {

String::from("(Read more...)")

}

}

  

// ç»“æ„ä½“

pub struct NewsArticle {

pub headline: String,

pub location: String,

pub author: String,

pub content: String,

}

// å¼•å…¥æ¥å£è¯¦ç»†æ–¹æ³•

impl Summary2 for NewsArticle {}

  

// * çº¦æŸäº† æœºæ„ä½“çš„æ–¹æ³•ï¼Œ

pub struct Tweet {

pub username: String,

pub content: String,

pub reply: bool,

pub retweet: bool,

}

  

// å¼•å…¥æ¥å£æ¨¡ç³Šæ–¹æ³•

impl Summary for Tweet {

fn summarize(&self) -> String {

format!("{}: {}", self.username, self.content)

}

fn summarize_author(&self) -> String {

format!("@{}", self.username)

}

}

  

// todo æ ‡å‡†æ ¼å¼åŒ– æ¥å£

use std::fmt::{Debug, Display, Error, Formatter, Result};

// å¤šæ¥å£ä½¿ç”¨

impl Display for Tweet {

fn fmt(&self, f: &mut Formatter) -> Result {

write!(f, "{}", self.reply)

}

}

  

// *æ¥å—ç»“æ„å¯¹è±¡ï¼Œè·¨ä½œç”¨åŸŸå¼•ç”¨å…¶ä»–ç»“æ„ä½“çš„æ–¹æ³•

// pub fn notify(item: &impl Summary) {

// println!("ä¸ºå…¶ä»– {}", item.summarize())

// }

  

// Trait Bound è¯­æ³•ç³–

// pub fn notify<T: Summary>(item: &T) {

// println!("Breaking news! {}", item.summarize());

// }

  

// pub fn notify(item1: &impl Summary, item2: &impl Summary2) {

// println!("Breaking1 news! {}", item1.summarize());

// println!("Breaking2 news! {}", item2.summarize());

// }

  

// pub fn notify<T: Summary, U: Summary2>(item1: &T, item2: &U) {

// println!("Breaking1 news! {}", item1.summarize());

// println!("Breaking2 news! {}", item2.summarize());

// }

  

// * å¤šæ¥å£ä½¿ç”¨

// pub fn notify(item: &(impl Summary + Display)) {

// println!("Breaking news! {}", item.summarize());

// println!("news! {}", item);

// }

  

// pub fn notify<T: Summary + Display>(item: &T) {

// println!("Breaking news! {}", item.summarize());

// println!("news! {}", item);

// }

  

// fn some_function<T: Display + Clone, U: Clone + Debug>(t: &T, u: &U) -> i32 {

// println!("éš¾å—")

// }

// todo æ¨èå†™æ³•

// fn some_function1<T, U>(t: &T, u: &U) -> i32

// where

// T: Display + Clone,

// U: Clone + Debug,

// {

// println!("Breaking news! {}", item.summarize());

// }

  

// !åœ¨è¿”å›å€¼ä¸Šå®šä¹‰

fn returns_summarizable() -> impl Summary {

Tweet {

username: String::from("??"),

content: String::from("xx"),

reply: false,

retweet: false,

}

}

  

pub fn interfaces() {

// todo å¼•å…¥æ¨¡ç³Šæ–¹æ³•

let tweet = Tweet {

username: String::from("horse_ebooks"),

content: String::from("of course, as you probably already know, people"),

reply: false,

retweet: false,

};

  

// println!("å¼•å…¥æ¨¡ç³Šæ–¹æ³•: {}", tweet.summarize());

// println!("å¼•å…¥æ¨¡ç³Šæ–¹æ³•: {}", tweet.summarize_author());

// println!("{}", tweet.summarize_test());

  

// todo å¼•å…¥è¯¦ç»†æ–¹æ³•

let article = NewsArticle {

headline: String::from("Penguins win the Stanley Cup Championship!"),

location: String::from("Pittsburgh, PA, USA"),

author: String::from("Iceburgh"),

content: String::from(

"The Pittsburgh Penguins once again are the best \

hockey team in the NHL.",

),

};

// println!("å¼•å…¥è¯¦ç»†æ–¹æ³•: {}", article.summarize());

// *é¿å¼€ä½œç”¨åŸŸé—®é¢˜ï¼Œè°ƒç”¨ç»™å…¶ä»–å‡½æ•°å¼•ç”¨

// notify(&tweet);

// notify(&tweet, &article);

// some_function(&tweet, &article)

// some_function1(&tweet, &article)

// let D = returns_summarizable();

// println!("{}", D.summarize());

  

let a = Pair { x: 1, y: 1 };

a.cmp_display();

  

// ç»™æ³›å‹æ·»åŠ æ–¹æ³•

let circle = Circle { radius: 6 };

println!("{}", circle.to_string());

}

  

struct Pair<T> {

x: T,

y: T,

}

  

impl<T> Pair<T> {

fn new(x: T, y: T) -> Self {

Self { x, y }

}

}

  

impl<T: Display + PartialOrd> Pair<T> {

fn cmp_display(&self) {

if self.x >= self.y {

println!("The largest member is x = {}", self.x);

} else {

println!("The largest member is y = {}", self.y);

}

}

}

  

// ç»™æ³›å‹å®ç°æ–¹æ³•

use std::string::ToString;

  

struct Circle {

radius: i32,

}

  

impl ToString for Circle {

fn to_string(&self) -> String {

format!("Circle of radius {:?}", self.radius)

}

}
```
ç±»ä¼¼typescriptçš„ç¼–ç¨‹ï¼Œä½†æ˜¯æ›´éš¾ç”¨ã€‚

##### ç”Ÿå‘½å‘¨æœŸ
###### é¿å…æ‚¬å‚å¼•ç”¨
ç”Ÿå‘½å‘¨æœŸçš„ä¸»è¦ç›®æ ‡æ˜¯é¿å…æ‚¬å‚å¼•ç”¨ï¼ˆdangling referencesï¼‰ï¼Œåè€…ä¼šå¯¼è‡´ç¨‹åºå¼•ç”¨äº†éé¢„æœŸå¼•ç”¨çš„æ•°æ®ã€‚
```rust
fn main() {
    let r;

    {
        let x = 5;
        r = &x;
    }

    println!("r: {}", r);
}

```

###### å€Ÿç”¨æ£€æŸ¥å™¨
Rust ç¼–è¯‘å™¨æœ‰ä¸€ä¸ª å€Ÿç”¨æ£€æŸ¥å™¨ï¼ˆborrow checkerï¼‰ï¼Œå®ƒæ¯”è¾ƒä½œç”¨åŸŸæ¥ç¡®ä¿æ‰€æœ‰çš„å€Ÿç”¨éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚
```rust
fn main() {
    let x = 5;            // ----------+-- 'b
                          //           |
    let r = &x;           // --+-- 'a  |
                          //   |       |
    println!("r: {}", r); //   |       |
                          // --+       |
}                         // ----------+

```

###### ç”Ÿå‘½å‘¨æœŸæ³¨è§£
```rust
&i32        // å¼•ç”¨
&'a i32     // å¸¦æœ‰æ˜¾å¼ç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨
&'a mut i32 // å¸¦æœ‰æ˜¾å¼ç”Ÿå‘½å‘¨æœŸçš„å¯å˜å¼•ç”¨
```
ä¸ºäº†åœ¨å‡½æ•°ç­¾åä¸­ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸæ³¨è§£ï¼Œéœ€è¦åœ¨å‡½æ•°åå’Œå‚æ•°åˆ—è¡¨é—´çš„å°–æ‹¬å·ä¸­å£°æ˜æ³›å‹ç”Ÿå‘½å‘¨æœŸï¼ˆlifetimeï¼‰å‚æ•°ï¼Œå°±åƒæ³›å‹ç±»å‹ï¼ˆtypeï¼‰å‚æ•°ä¸€æ ·ã€‚

æˆ‘ä»¬å¸Œæœ›å‡½æ•°ç­¾åè¡¨è¾¾å¦‚ä¸‹é™åˆ¶ï¼šä¹Ÿå°±æ˜¯è¿™ä¸¤ä¸ªå‚æ•°å’Œè¿”å›çš„å¼•ç”¨å­˜æ´»çš„ä¸€æ ·ä¹…ã€‚ï¼ˆä¸¤ä¸ªï¼‰å‚æ•°å’Œè¿”å›çš„å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ç›¸å…³çš„ã€‚

<div style="color: red">å¼ºè¡Œå°†å‚æ•°ä¸­çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½œç”¨åŸŸæ‹‰åˆ°ä¸€è‡´ã€‚é¿å…å¼•ç”¨å¤±è´¥ã€‚</div>
```rust
pub fn timer() {

let x = 5; // ----------+-- 'b

// |

let r = &x; // --+-- 'a |

// | |

// println!("r: {}", r); // | |

// --+ |

// ----------+

  

// !å‡½æ•°ç”Ÿå‘½å‘¨æœŸ

let string1 = String::from("abcd");

// let string2 = "xyz";

// let result = longest(string1.as_str(), string2);

// println!("The longest string is {}", result);

{

let string2 = String::from("xyz");

let result = longest(string1.as_str(), string2.as_str());

// println!("The longest string is {}", result);

}

  

// !ç»“æ„ä½“å£°æ˜å‘¨æœŸ

let novel = String::from("Call me Ishmael. Some years ago...");

let first_sentence = novel.split('.').next().expect("Could not find a '.'");

let i = ImportantExcerpt {

part: first_sentence,

};

println!("{:?}", i);

}

  

// &i32 // å¼•ç”¨

// &'a i32 // å¸¦æœ‰æ˜¾å¼ç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨

// &'a mut i32 // å¸¦æœ‰æ˜¾å¼ç”Ÿå‘½å‘¨æœŸçš„å¯å˜å¼•ç”¨

  

fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {

if x.len() > y.len() {

x

} else {

y

}

}

  

// ç¼–è¯‘å¤±è´¥æ˜¯å› ä¸ºæœ‰å®šä¹‰åŸŸä¸åŒ

// fn longest1(x: &str, y: &str) -> str {

// if x.len() > y.len() {

// x

// } else {

// y

// }

// }

#[derive(Debug)]

struct ImportantExcerpt<'a> {

part: &'a str,

// é¦–å…ˆï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæ–¹æ³• levelã€‚å…¶å”¯ä¸€çš„å‚æ•°æ˜¯ self çš„å¼•ç”¨ï¼Œè€Œä¸”è¿”å›å€¼åªæ˜¯ä¸€ä¸ª i32ï¼Œå¹¶ä¸å¼•ç”¨ä»»ä½•å€¼ï¼š

impl<'a> ImportantExcerpt<'a> {

fn level(&self) -> i32 {

3

}

}

// é€‚ç”¨äºç¬¬ä¸‰æ¡ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™çš„ä¾‹å­

impl<'a> ImportantExcerpt<'a> {

fn announce_and_return_part(&self, announcement: &str) -> &str {

println!("Attention please: {}", announcement);

self.part

}

}



}
```

<div style="color: green">ç”Ÿå‘½å‘¨æœŸçœç•¥ï¼ˆLifetime Elisionï¼‰</div>
åœ¨ç¼–å†™äº†å¾ˆå¤š Rust ä»£ç åï¼ŒRust å›¢é˜Ÿå‘ç°åœ¨ç‰¹å®šæƒ…å†µä¸‹ Rust ç¨‹åºå‘˜ä»¬æ€»æ˜¯é‡å¤åœ°ç¼–å†™ä¸€æ¨¡ä¸€æ ·çš„ç”Ÿå‘½å‘¨æœŸæ³¨è§£ã€‚è¿™äº›åœºæ™¯æ˜¯å¯é¢„æµ‹çš„å¹¶ä¸”éµå¾ªå‡ ä¸ªæ˜ç¡®çš„æ¨¡å¼ã€‚æ¥ç€ Rust å›¢é˜Ÿå°±æŠŠè¿™äº›æ¨¡å¼ç¼–ç è¿›äº† Rust ç¼–è¯‘å™¨ä¸­ï¼Œå¦‚æ­¤å€Ÿç”¨æ£€æŸ¥å™¨åœ¨è¿™äº›æƒ…å†µä¸‹å°±èƒ½æ¨æ–­å‡ºç”Ÿå‘½å‘¨æœŸè€Œä¸å†å¼ºåˆ¶ç¨‹åºå‘˜æ˜¾å¼çš„å¢åŠ æ³¨è§£ã€‚

è¿™é‡Œæˆ‘ä»¬æåˆ°ä¸€äº› Rust çš„å†å²æ˜¯å› ä¸ºæ›´å¤šçš„æ˜ç¡®çš„æ¨¡å¼è¢«åˆå¹¶å’Œæ·»åŠ åˆ°ç¼–è¯‘å™¨ä¸­æ˜¯å®Œå…¨å¯èƒ½çš„ã€‚æœªæ¥åªä¼šéœ€è¦æ›´å°‘çš„ç”Ÿå‘½å‘¨æœŸæ³¨è§£ã€‚

è¢«ç¼–ç è¿› Rust å¼•ç”¨åˆ†æçš„æ¨¡å¼è¢«ç§°ä¸º ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ï¼ˆlifetime elision rulesï¼‰ã€‚è¿™å¹¶ä¸æ˜¯éœ€è¦ç¨‹åºå‘˜éµå®ˆçš„è§„åˆ™ï¼›è¿™äº›è§„åˆ™æ˜¯ä¸€ç³»åˆ—ç‰¹å®šçš„åœºæ™¯ï¼Œæ­¤æ—¶ç¼–è¯‘å™¨ä¼šè€ƒè™‘ï¼Œå¦‚æœä»£ç ç¬¦åˆè¿™äº›åœºæ™¯ï¼Œå°±æ— éœ€æ˜ç¡®æŒ‡å®šç”Ÿå‘½å‘¨æœŸã€‚

çœç•¥è§„åˆ™å¹¶ä¸æä¾›å®Œæ•´çš„æ¨æ–­ï¼šå¦‚æœ Rust åœ¨æ˜ç¡®éµå®ˆè¿™äº›è§„åˆ™çš„å‰æä¸‹å˜é‡çš„ç”Ÿå‘½å‘¨æœŸä»ç„¶æ˜¯æ¨¡æ£±ä¸¤å¯çš„è¯ï¼Œå®ƒä¸ä¼šçŒœæµ‹å‰©ä½™å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸåº”è¯¥æ˜¯ä»€ä¹ˆã€‚ç¼–è¯‘å™¨ä¼šåœ¨å¯ä»¥é€šè¿‡å¢åŠ ç”Ÿå‘½å‘¨æœŸæ³¨è§£æ¥è§£å†³é”™è¯¯é—®é¢˜çš„åœ°æ–¹ç»™å‡ºä¸€ä¸ªé”™è¯¯æç¤ºï¼Œè€Œä¸æ˜¯è¿›è¡Œæ¨æ–­æˆ–çŒœæµ‹ã€‚
<div style="color: skyblue">
å‡½æ•°æˆ–æ–¹æ³•çš„å‚æ•°çš„ç”Ÿå‘½å‘¨æœŸè¢«ç§°ä¸º è¾“å…¥ç”Ÿå‘½å‘¨æœŸï¼ˆinput lifetimesï¼‰ï¼Œ
è€Œè¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸè¢«ç§°ä¸º è¾“å‡ºç”Ÿå‘½å‘¨æœŸï¼ˆoutput lifetimesï¼‰ã€‚
</div>


ç¼–è¯‘å™¨é‡‡ç”¨ä¸‰æ¡è§„åˆ™æ¥åˆ¤æ–­å¼•ç”¨ä½•æ—¶ä¸éœ€è¦æ˜ç¡®çš„æ³¨è§£ã€‚ç¬¬ä¸€æ¡è§„åˆ™é€‚ç”¨äºè¾“å…¥ç”Ÿå‘½å‘¨æœŸï¼Œåä¸¤æ¡è§„åˆ™é€‚ç”¨äºè¾“å‡ºç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœç¼–è¯‘å™¨æ£€æŸ¥å®Œè¿™ä¸‰æ¡è§„åˆ™åä»ç„¶å­˜åœ¨æ²¡æœ‰è®¡ç®—å‡ºç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨ï¼Œç¼–è¯‘å™¨å°†ä¼šåœæ­¢å¹¶ç”Ÿæˆé”™è¯¯ã€‚è¿™äº›è§„åˆ™é€‚ç”¨äº fn å®šä¹‰ï¼Œä»¥åŠ impl å—ã€‚

- ç¬¬ä¸€æ¡è§„åˆ™æ˜¯ç¼–è¯‘å™¨ä¸ºæ¯ä¸€ä¸ªå¼•ç”¨å‚æ•°éƒ½åˆ†é…ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå‚æ•°ã€‚æ¢å¥è¯è¯´å°±æ˜¯ï¼Œå‡½æ•°æœ‰ä¸€ä¸ªå¼•ç”¨å‚æ•°çš„å°±æœ‰ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼šfn foo<'a>(x: &'a i32)ï¼Œæœ‰ä¸¤ä¸ªå¼•ç”¨å‚æ•°çš„å‡½æ•°å°±æœ‰ä¸¤ä¸ªä¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œfn foo<'a, 'b>(x: &'a i32, y: &'b i32)ï¼Œä¾æ­¤ç±»æ¨ã€‚
- ç¬¬äºŒæ¡è§„åˆ™æ˜¯å¦‚æœåªæœ‰ä¸€ä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œé‚£ä¹ˆå®ƒè¢«èµ‹äºˆæ‰€æœ‰è¾“å‡ºç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼šfn foo<'a>(x: &'a i32) -> &'a i32ã€‚
- ç¬¬ä¸‰æ¡è§„åˆ™æ˜¯å¦‚æœæ–¹æ³•æœ‰å¤šä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°å¹¶ä¸”å…¶ä¸­ä¸€ä¸ªå‚æ•°æ˜¯ &self æˆ– &mut selfï¼Œè¯´æ˜æ˜¯ä¸ªå¯¹è±¡çš„æ–¹æ³• (method)(è¯‘è€…æ³¨ï¼šè¿™é‡Œæ¶‰åŠ rust çš„é¢å‘å¯¹è±¡å‚è§ 17 ç« )ï¼Œé‚£ä¹ˆæ‰€æœ‰è¾“å‡ºç”Ÿå‘½å‘¨æœŸå‚æ•°è¢«èµ‹äºˆ self çš„ç”Ÿå‘½å‘¨æœŸã€‚ç¬¬ä¸‰æ¡è§„åˆ™ä½¿å¾—æ–¹æ³•æ›´å®¹æ˜“è¯»å†™ï¼Œå› ä¸ºåªéœ€æ›´å°‘çš„ç¬¦å·ã€‚
```rust
å‡è®¾æˆ‘ä»¬è‡ªå·±å°±æ˜¯ç¼–è¯‘å™¨ã€‚å¹¶åº”ç”¨è¿™äº›è§„åˆ™æ¥è®¡ç®—ç¤ºä¾‹ 10-25 ä¸­ first_word å‡½æ•°ç­¾åä¸­çš„å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸã€‚å¼€å§‹æ—¶ç­¾åä¸­çš„å¼•ç”¨å¹¶æ²¡æœ‰å…³è”ä»»ä½•ç”Ÿå‘½å‘¨æœŸï¼š

fn first_word(s: &str) -> &str {
æ¥ç€ç¼–è¯‘å™¨åº”ç”¨ç¬¬ä¸€æ¡è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªå¼•ç”¨å‚æ•°éƒ½æœ‰å…¶è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸã€‚æˆ‘ä»¬åƒå¾€å¸¸ä¸€æ ·ç§°ä¹‹ä¸º 'aï¼Œæ‰€ä»¥ç°åœ¨ç­¾åçœ‹èµ·æ¥åƒè¿™æ ·ï¼š

fn first_word<'a>(s: &'a str) -> &str {
å¯¹äºç¬¬äºŒæ¡è§„åˆ™ï¼Œå› ä¸ºè¿™é‡Œæ­£å¥½åªæœ‰ä¸€ä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°æ‰€ä»¥æ˜¯é€‚ç”¨çš„ã€‚ç¬¬äºŒæ¡è§„åˆ™è¡¨æ˜è¾“å…¥å‚æ•°çš„ç”Ÿå‘½å‘¨æœŸå°†è¢«èµ‹äºˆè¾“å‡ºç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œæ‰€ä»¥ç°åœ¨ç­¾åçœ‹èµ·æ¥åƒè¿™æ ·ï¼š

fn first_word<'a>(s: &'a str) -> &'a str {
ç°åœ¨è¿™ä¸ªå‡½æ•°ç­¾åä¸­çš„æ‰€æœ‰å¼•ç”¨éƒ½æœ‰äº†ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚æ­¤ç¼–è¯‘å™¨å¯ä»¥ç»§ç»­å®ƒçš„åˆ†æè€Œæ— é¡»ç¨‹åºå‘˜æ ‡è®°è¿™ä¸ªå‡½æ•°ç­¾åä¸­çš„ç”Ÿå‘½å‘¨æœŸã€‚

è®©æˆ‘ä»¬å†çœ‹çœ‹å¦ä¸€ä¸ªä¾‹å­ï¼Œè¿™æ¬¡æˆ‘ä»¬ä»ç¤ºä¾‹ 10-20 ä¸­æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸå‚æ•°çš„ longest å‡½æ•°å¼€å§‹ï¼š

fn longest(x: &str, y: &str) -> &str {
å†æ¬¡å‡è®¾æˆ‘ä»¬è‡ªå·±å°±æ˜¯ç¼–è¯‘å™¨å¹¶åº”ç”¨ç¬¬ä¸€æ¡è§„åˆ™ï¼šæ¯ä¸ªå¼•ç”¨å‚æ•°éƒ½æœ‰å…¶è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™æ¬¡æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œæ‰€ä»¥å°±æœ‰ä¸¤ä¸ªï¼ˆä¸åŒçš„ï¼‰ç”Ÿå‘½å‘¨æœŸï¼š

fn longest<'a, 'b>(x: &'a str, y: &'b str) -> &str {
å†æ¥åº”ç”¨ç¬¬äºŒæ¡è§„åˆ™ï¼Œå› ä¸ºå‡½æ•°å­˜åœ¨å¤šä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒå¹¶ä¸é€‚ç”¨äºè¿™ç§æƒ…å†µã€‚å†æ¥çœ‹ç¬¬ä¸‰æ¡è§„åˆ™ï¼Œå®ƒåŒæ ·ä¹Ÿä¸é€‚ç”¨ï¼Œè¿™æ˜¯å› ä¸ºæ²¡æœ‰ self å‚æ•°ã€‚åº”ç”¨äº†ä¸‰ä¸ªè§„åˆ™ä¹‹åç¼–è¯‘å™¨è¿˜æ²¡æœ‰è®¡ç®—å‡ºè¿”å›å€¼ç±»å‹çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™å°±æ˜¯åœ¨ç¼–è¯‘ç¤ºä¾‹ 10-20 çš„ä»£ç æ—¶ä¼šå‡ºç°é”™è¯¯çš„åŸå› ï¼šç¼–è¯‘å™¨ä½¿ç”¨æ‰€æœ‰å·²çŸ¥çš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ï¼Œä»ä¸èƒ½è®¡ç®—å‡ºç­¾åä¸­æ‰€æœ‰å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸã€‚

å› ä¸ºç¬¬ä¸‰æ¡è§„åˆ™çœŸæ­£èƒ½å¤Ÿé€‚ç”¨çš„å°±åªæœ‰æ–¹æ³•ç­¾åï¼Œç°åœ¨å°±è®©æˆ‘ä»¬çœ‹çœ‹é‚£ç§æƒ…å†µä¸­çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶çœ‹çœ‹ä¸ºä»€ä¹ˆè¿™æ¡è§„åˆ™æ„å‘³ç€æˆ‘ä»¬ç»å¸¸ä¸éœ€è¦åœ¨æ–¹æ³•ç­¾åä¸­æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸã€‚
```
###### é™æ€ç”Ÿå‘½å‘¨æœŸ
è¿™é‡Œæœ‰ä¸€ç§ç‰¹æ®Šçš„ç”Ÿå‘½å‘¨æœŸå€¼å¾—è®¨è®ºï¼š'staticï¼Œå…¶ç”Ÿå‘½å‘¨æœŸèƒ½å¤Ÿå­˜æ´»äºæ•´ä¸ªç¨‹åºæœŸé—´ã€‚æ‰€æœ‰çš„å­—ç¬¦ä¸²å­—é¢å€¼éƒ½æ‹¥æœ‰ 'static ç”Ÿå‘½å‘¨æœŸï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©åƒä¸‹é¢è¿™æ ·æ ‡æ³¨å‡ºæ¥ï¼š
```rust
let s: &'static str = "I have a static lifetime.";
```
è¿™ä¸ªå­—ç¬¦ä¸²çš„æ–‡æœ¬è¢«ç›´æ¥å‚¨å­˜åœ¨ç¨‹åºçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­è€Œè¿™ä¸ªæ–‡ä»¶æ€»æ˜¯å¯ç”¨çš„ã€‚å› æ­¤æ‰€æœ‰çš„å­—ç¬¦ä¸²å­—é¢å€¼éƒ½æ˜¯ 'static çš„ã€‚

###### æ³›å‹ï¼Œæ¥å£ç”Ÿå‘½å‘¨æœŸ
```rust
use std::fmt::Display;

  

fn longest_with_an_announcement<'a, T>(

x: &'a str,

y: &'a str,

ann: T,

) -> &'a str

where

T: Display,

{

println!("Announcement! {}", ann);

if x.len() > y.len() {

x

} else {

y

}

}
```


#### è‡ªåŠ¨åŒ–æµ‹è¯•
Edsger W. Dijkstra åœ¨å…¶ 1972 å¹´çš„æ–‡ç« ã€è°¦å‘çš„ç¨‹åºå‘˜ã€‘ï¼ˆâ€œThe Humble Programmerâ€ï¼‰ä¸­è¯´åˆ° â€œè½¯ä»¶æµ‹è¯•æ˜¯è¯æ˜ bug å­˜åœ¨çš„æœ‰æ•ˆæ–¹æ³•ï¼Œè€Œè¯æ˜å…¶ä¸å­˜åœ¨æ—¶åˆ™æ˜¾å¾—ä»¤äººç»æœ›çš„ä¸è¶³ã€‚â€ï¼ˆâ€œProgram testing can be a very effective way to show the presence of bugs, but it is hopelessly inadequate for showing their absence.â€ï¼‰è¿™å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬ä¸è¯¥å°½å¯èƒ½åœ°æµ‹è¯•è½¯ä»¶ï¼

ç¨‹åºçš„æ­£ç¡®æ€§æ„å‘³ç€ä»£ç å¦‚æˆ‘ä»¬æœŸæœ›çš„é‚£æ ·è¿è¡Œã€‚Rust æ˜¯ä¸€ä¸ªç›¸å½“æ³¨é‡æ­£ç¡®æ€§çš„ç¼–ç¨‹è¯­è¨€ï¼Œä¸è¿‡æ­£ç¡®æ€§æ˜¯ä¸€ä¸ªéš¾ä»¥è¯æ˜çš„å¤æ‚ä¸»é¢˜ã€‚Rust çš„ç±»å‹ç³»ç»Ÿåœ¨æ­¤é—®é¢˜ä¸Šä¸‹äº†å¾ˆå¤§çš„åŠŸå¤«ï¼Œä¸è¿‡ç±»å‹ç³»ç»Ÿä¸å¯èƒ½æ•è·æ‰€æœ‰é—®é¢˜ã€‚ä¸ºæ­¤ï¼ŒRust åŒ…å«äº†ç¼–å†™è‡ªåŠ¨åŒ–è½¯ä»¶æµ‹è¯•çš„åŠŸèƒ½æ”¯æŒã€‚

Rust ä¸­çš„æµ‹è¯•å‡½æ•°æ˜¯ç”¨æ¥éªŒè¯éæµ‹è¯•ä»£ç æ˜¯å¦æ˜¯æŒ‰ç…§æœŸæœ›çš„æ–¹å¼è¿è¡Œçš„ã€‚æµ‹è¯•å‡½æ•°ä½“é€šå¸¸æ‰§è¡Œå¦‚ä¸‹ä¸‰ç§æ“ä½œï¼š
- è®¾ç½®ä»»ä½•æ‰€éœ€çš„æ•°æ®æˆ–çŠ¶æ€
- è¿è¡Œéœ€è¦æµ‹è¯•çš„ä»£ç 
- æ–­è¨€å…¶ç»“æœæ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„

##### ç”Ÿæˆæ¨¡å—lib
```shell
$ cargo new adder --lib
$ cd adder
```
##### è°ƒç”¨æµ‹è¯•ç”¨ä¾‹
```shell
$ cargo test
   Compiling adder v0.1.0 (file:///projects/adder)
    Finished test [unoptimized + debuginfo] target(s) in 0.57s
     Running unittests src/lib.rs (target/debug/deps/adder-92948b65e88960b4)

// æµ‹è¯•å‡½æ•°çš„åç§°
running 1 test
test tests::it_works ... ok
// æµ‹è¯•ç»“æœ
test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

   Doc-tests adder

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s
```
##### ç¼–å†™æµ‹è¯•
```rust
/*

!å¸¦å…¥æµ‹è¯•ã€‚

*/

  

pub fn add(left: usize, right: usize) -> usize {

left + right

}

  

#[derive(Debug)]

struct Rectangle {

width: u32,

height: u32,

}

  

impl Rectangle {

fn can_hold(&self, other: &Rectangle) -> bool {

self.width > other.width && self.height > other.height

}

}

  

pub fn add_two(a: i32) -> i32 {

// a + 3

a + 2

}

// todo è‡ªå®šä¹‰å¤±è´¥ä¿¡æ¯

pub fn greeting(name: &str) -> String {

format!("Hello {}!", name)

// String::format("11")

}

  

// ä½¿ç”¨should_panic æ£€æŸ¥ panic

pub struct Guess {

value: i32,

}

impl Guess {

pub fn new(value: i32) -> Guess {

if value < 1 || value > 100 {

panic!("Guess value must be between 1 and 100, got {}.", value);

}

  

Guess { value }

}

}

  

#[cfg(test)]

mod tests {

use super::*;

  

#[test]

fn it_works() {

let result = add(2, 2);

assert_eq!(result, 4);

}

  

// æ•æ‰å¼‚å¸¸çš„æšä¸¾ç»“æ„ä½“ï¼Œ

#[test]

fn it_works_enmus() -> Result<(), String> {

if 2 + 2 == 4 {

Ok(())

} else {

Err(String::from("two plus two does not equal four"))

}

}

  

#[test]

fn exploration() {

assert_eq!(2 + 2, 4);

}

  

// è¿™é‡Œåˆ™æ˜¯ä¸€ä¸ªå¤±è´¥çš„æµ‹è¯•ä¾‹å­

// #[test]

// fn another() {

// panic!("Make this test fail");

// }

  

// ç»“æ„ä½“æµ‹è¯•

use super::*;

#[test]

fn larger_can_hold_smaller() {

let larger = Rectangle {

width: 8,

height: 7,

};

let smaller = Rectangle {

width: 5,

height: 1,

};

// æ–­è¨€ çœŸå‡ è¿™é‡ŒæŠ¥é”™

assert!(larger.can_hold(&smaller));

}

  

// å†æ¬¡æµ‹è¯•

#[test]

fn smaller_cannot_hold_larger() {

let larger = Rectangle {

width: 8,

height: 7,

};

let smaller = Rectangle {

width: 5,

height: 1,

};

  

assert!(!smaller.can_hold(&larger));

}

#[test]

fn it_adds_two() {

// æ–­è¨€ç›¸ç­‰

assert_eq!(4, add_two(2));

}

  

#[test]

fn greeting_contains_name() {

let result = greeting("Carol");

// ç›´æ¥æ‰“å°è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯

assert!(result.contains("Carol"), "æˆ‘æ˜¯é”™è¯¯ä¿¡æ¯{}", result);

}

  

#[test]

#[should_panic(expected = "ä½ ä¸èƒ½ä¼ å…¥æ­£å¸¸å€¼")]

fn greater_than_100() {

// æ£€æµ‹panicæ˜¯å¦ç”Ÿæ•ˆ

Guess::new(2);

}

}
```
##### æ§åˆ¶æµ‹è¯•
å°±åƒ cargo run ä¼šç¼–è¯‘ä»£ç å¹¶è¿è¡Œç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸€æ ·ï¼Œcargo test åœ¨æµ‹è¯•æ¨¡å¼ä¸‹ç¼–è¯‘ä»£ç å¹¶è¿è¡Œç”Ÿæˆçš„æµ‹è¯•äºŒè¿›åˆ¶æ–‡ä»¶ã€‚cargo test äº§ç”Ÿçš„äºŒè¿›åˆ¶æ–‡ä»¶çš„é»˜è®¤è¡Œä¸ºæ˜¯å¹¶å‘è¿è¡Œæ‰€æœ‰çš„æµ‹è¯•ï¼Œå¹¶æˆªè·æµ‹è¯•è¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„è¾“å‡ºï¼Œé˜»æ­¢ä»–ä»¬è¢«æ˜¾ç¤ºå‡ºæ¥ï¼Œä½¿å¾—é˜…è¯»æµ‹è¯•ç»“æœç›¸å…³çš„å†…å®¹å˜å¾—æ›´å®¹æ˜“ã€‚ä¸è¿‡å¯ä»¥æŒ‡å®šå‘½ä»¤è¡Œå‚æ•°æ¥æ”¹å˜ cargo test çš„é»˜è®¤è¡Œä¸ºã€‚

å¯ä»¥å°†ä¸€éƒ¨åˆ†å‘½ä»¤è¡Œå‚æ•°ä¼ é€’ç»™ cargo testï¼Œè€Œå°†å¦å¤–ä¸€éƒ¨åˆ†ä¼ é€’ç»™ç”Ÿæˆçš„æµ‹è¯•äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ä¸ºäº†åˆ†éš”è¿™ä¸¤ç§å‚æ•°ï¼Œéœ€è¦å…ˆåˆ—å‡ºä¼ é€’ç»™ cargo test çš„å‚æ•°ï¼Œæ¥ç€æ˜¯åˆ†éš”ç¬¦ --ï¼Œå†ä¹‹åæ˜¯ä¼ é€’ç»™æµ‹è¯•äºŒè¿›åˆ¶æ–‡ä»¶çš„å‚æ•°ã€‚è¿è¡Œ cargo test --help ä¼šæç¤º cargo test çš„æœ‰å…³å‚æ•°ï¼Œè€Œè¿è¡Œ cargo test -- --help å¯ä»¥æç¤ºåœ¨åˆ†éš”ç¬¦ä¹‹åä½¿ç”¨çš„æœ‰å…³å‚æ•°ã€‚

###### è®¾ç½®æµ‹è¯•çš„çº¿ç¨‹
```rust
$ cargo test -- --test-threads=1
```
###### æ˜¾ç¤ºæˆåŠŸçš„è¾“å‡º
```rust
$ cargo test -- --show-output
```
###### å•ç‹¬æµ‹è¯• / æ‰¹é‡æµ‹è¯•
åªè¦åå­—æ˜¯æµ‹è¯•ç”¨ä¾‹ä¸­å‡½æ•°çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ç¬¦åˆçš„å‡½æ•°éƒ½ä¼šè¢«ä½¿ç”¨
```rust
$ cargo test one_hundred
```
###### å¿½ç•¥æµ‹è¯•
éœ€è¦åŠ å…¥#[ignore]
```rust
  
#[test]

#[ignore]

#[should_panic(expected = "ä½ ä¸èƒ½ä¼ å…¥æ­£å¸¸å€¼")]

fn greater_than_100() {

// æ£€æµ‹panicæ˜¯å¦ç”Ÿæ•ˆ

Guess::new(12);

}
```
```rust
$ cargo test -- --ignored
$ cargo test -- --include-ignored
```

##### æµ‹è¯•æ¡†æ¶
å•å…ƒæµ‹è¯•ï¼ˆunit testsï¼‰ä¸ é›†æˆæµ‹è¯•ï¼ˆintegration testsï¼‰ã€‚å•å…ƒæµ‹è¯•å€¾å‘äºæ›´å°è€Œæ›´é›†ä¸­ï¼Œåœ¨éš”ç¦»çš„ç¯å¢ƒä¸­ä¸€æ¬¡æµ‹è¯•ä¸€ä¸ªæ¨¡å—ï¼Œæˆ–è€…æ˜¯æµ‹è¯•ç§æœ‰æ¥å£ã€‚è€Œé›†æˆæµ‹è¯•å¯¹äºä½ çš„åº“æ¥è¯´åˆ™å®Œå…¨æ˜¯å¤–éƒ¨çš„ã€‚å®ƒä»¬ä¸å…¶ä»–å¤–éƒ¨ä»£ç ä¸€æ ·ï¼Œé€šè¿‡ç›¸åŒçš„æ–¹å¼ä½¿ç”¨ä½ çš„ä»£ç ï¼Œåªæµ‹è¯•å…¬æœ‰æ¥å£è€Œä¸”æ¯ä¸ªæµ‹è¯•éƒ½æœ‰å¯èƒ½ä¼šæµ‹è¯•å¤šä¸ªæ¨¡å—ã€‚
###### å•å…ƒæµ‹è¯•
å°†æµ‹è¯•ç”¨ä¾‹å†™å…¥åˆ°æ¨¡å—æœ¬èº«ä¸­
```rust
/*

!å¸¦å…¥æµ‹è¯•ã€‚

*/

  

pub fn add(left: usize, right: usize) -> usize {

left + right

}

  

#[derive(Debug)]

struct Rectangle {

width: u32,

height: u32,

}

  

impl Rectangle {

fn can_hold(&self, other: &Rectangle) -> bool {

self.width > other.width && self.height > other.height

}

}

  

pub fn add_two(a: i32) -> i32 {

// a + 3

a + 2

}

// todo è‡ªå®šä¹‰å¤±è´¥ä¿¡æ¯

pub fn greeting(name: &str) -> String {

format!("Hello {}!", name)

// String::format("11")

}

  

// ä½¿ç”¨should_panic æ£€æŸ¥ panic

pub struct Guess {

value: i32,

}

impl Guess {

pub fn new(value: i32) -> Guess {

if value < 1 || value > 100 {

panic!("Guess value must be between 1 and 100, got {}.", value);

}

  

Guess { value }

}

}

  

#[cfg(test)]

mod tests {

use super::*;

  

#[test]

fn it_works() {

let result = add(2, 2);

assert_eq!(result, 4);

}

  

// æ•æ‰å¼‚å¸¸çš„æšä¸¾ç»“æ„ä½“ï¼Œ

#[test]

fn it_works_enmus() -> Result<(), String> {

if 2 + 2 == 4 {

Ok(())

} else {

Err(String::from("two plus two does not equal four"))

}

}

  

#[test]

fn exploration() {

assert_eq!(2 + 2, 4);

}

  

// è¿™é‡Œåˆ™æ˜¯ä¸€ä¸ªå¤±è´¥çš„æµ‹è¯•ä¾‹å­

// #[test]

// fn another() {

// panic!("Make this test fail");

// }

  

// ç»“æ„ä½“æµ‹è¯•

use super::*;

#[test]

fn larger_can_hold_smaller() {

let larger = Rectangle {

width: 8,

height: 7,

};

let smaller = Rectangle {

width: 5,

height: 1,

};

// æ–­è¨€ çœŸå‡ è¿™é‡ŒæŠ¥é”™

assert!(larger.can_hold(&smaller));

}

  

// å†æ¬¡æµ‹è¯•

#[test]

fn smaller_cannot_hold_larger() {

let larger = Rectangle {

width: 8,

height: 7,

};

let smaller = Rectangle {

width: 5,

height: 1,

};

  

assert!(!smaller.can_hold(&larger));

}

#[test]

fn it_adds_two() {

// æ–­è¨€ç›¸ç­‰

assert_eq!(4, add_two(2));

}

  

#[test]

fn greeting_contains_name() {

let result = greeting("Carol");

// ç›´æ¥æ‰“å°è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯

assert!(result.contains("Carol"), "æˆ‘æ˜¯é”™è¯¯ä¿¡æ¯{}", result);

}

  

#[test]

#[ignore]

#[should_panic(expected = "ä½ ä¸èƒ½ä¼ å…¥æ­£å¸¸å€¼")]

fn greater_than_100() {

// æ£€æµ‹panicæ˜¯å¦ç”Ÿæ•ˆ

Guess::new(12);

}

}
```
###### é›†æˆæµ‹è¯•
åœ¨ Rust ä¸­ï¼Œé›†æˆæµ‹è¯•å¯¹äºä½ éœ€è¦æµ‹è¯•çš„åº“æ¥è¯´å®Œå…¨æ˜¯å¤–éƒ¨çš„ã€‚åŒå…¶ä»–ä½¿ç”¨åº“çš„ä»£ç ä¸€æ ·ä½¿ç”¨åº“æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬åªèƒ½è°ƒç”¨ä¸€éƒ¨åˆ†åº“ä¸­çš„å…¬æœ‰ APIã€‚é›†æˆæµ‹è¯•çš„ç›®çš„æ˜¯æµ‹è¯•åº“çš„å¤šä¸ªéƒ¨åˆ†èƒ½å¦ä¸€èµ·æ­£å¸¸å·¥ä½œã€‚ä¸€äº›å•ç‹¬èƒ½æ­£ç¡®è¿è¡Œçš„ä»£ç å•å…ƒé›†æˆåœ¨ä¸€èµ·ä¹Ÿå¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œæ‰€ä»¥é›†æˆæµ‹è¯•çš„è¦†ç›–ç‡ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ã€‚ä¸ºäº†åˆ›å»ºé›†æˆæµ‹è¯•ï¼Œä½ éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ª tests ç›®å½•ã€‚
```
adder
â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ src
â”‚Â Â  â””â”€â”€ lib.rs
â””â”€â”€ tests
    â””â”€â”€ integration_test.rs

```
<p style='color: red;'>å¦‚æœsrcçš„å­˜åœ¨åŒçº§testsï¼Œåˆ™åªä¼šä½¿ç”¨testsä¸­çš„rsæ–‡ä»¶ã€‚
</p>
ä¹Ÿå¯ä»¥é€‰æ‹©ç”¨å“ªä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚
```shell
$ cargo test --test integration_test
```
å¦‚æœé¡¹ç›®æ˜¯äºŒè¿›åˆ¶ crate å¹¶ä¸”åªåŒ…å« src/main.rs è€Œæ²¡æœ‰ src/lib.rsï¼Œè¿™æ ·å°±ä¸å¯èƒ½åœ¨ tests ç›®å½•åˆ›å»ºé›†æˆæµ‹è¯•å¹¶ä½¿ç”¨ extern crate å¯¼å…¥ src/main.rs ä¸­å®šä¹‰çš„å‡½æ•°ã€‚åªæœ‰åº“ crate æ‰ä¼šå‘å…¶ä»– crate æš´éœ²äº†å¯ä¾›è°ƒç”¨å’Œä½¿ç”¨çš„å‡½æ•°ï¼›äºŒè¿›åˆ¶ crate åªæ„åœ¨å•ç‹¬è¿è¡Œã€‚

è¿™å°±æ˜¯è®¸å¤š Rust äºŒè¿›åˆ¶é¡¹ç›®ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ src/main.rs è°ƒç”¨ src/lib.rs ä¸­çš„é€»è¾‘çš„åŸå› ä¹‹ä¸€ã€‚å› ä¸ºé€šè¿‡è¿™ç§ç»“æ„ï¼Œé›†æˆæµ‹è¯• å°±å¯ä»¥ é€šè¿‡ extern crate æµ‹è¯•åº“ crate ä¸­çš„ä¸»è¦åŠŸèƒ½äº†ï¼Œè€Œå¦‚æœè¿™äº›é‡è¦çš„åŠŸèƒ½æ²¡æœ‰é—®é¢˜çš„è¯ï¼Œsrc/main.rs ä¸­çš„å°‘é‡ä»£ç ä¹Ÿå°±ä¼šæ­£å¸¸å·¥ä½œä¸”ä¸éœ€è¦æµ‹è¯•ã€‚

![](readme.assets/Pasted%20image%2020230806184721.png)

#### æ„å»ºå‘½ä»¤è¡Œç¨‹åº
Rust çš„è¿è¡Œé€Ÿåº¦ã€å®‰å…¨æ€§ã€å•äºŒè¿›åˆ¶æ–‡ä»¶è¾“å‡ºå’Œè·¨å¹³å°æ”¯æŒä½¿å…¶æˆä¸ºåˆ›å»ºå‘½ä»¤è¡Œç¨‹åºçš„ç»ä½³é€‰æ‹©ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„é¡¹ç›®å°†åˆ›å»ºä¸€ä¸ªæˆ‘ä»¬è‡ªå·±ç‰ˆæœ¬çš„ç»å…¸å‘½ä»¤è¡Œæœç´¢å·¥å…·ï¼šgrepã€‚grep æ˜¯ â€œGlobally search a Regular Expression and Print.â€ çš„é¦–å­—æ¯ç¼©å†™ã€‚grep æœ€ç®€å•çš„ä½¿ç”¨åœºæ™¯æ˜¯åœ¨ç‰¹å®šæ–‡ä»¶ä¸­æœç´¢æŒ‡å®šå­—ç¬¦ä¸²ã€‚ä¸ºæ­¤ï¼Œgrep è·å–ä¸€ä¸ªæ–‡ä»¶è·¯å¾„å’Œä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œæ¥ç€è¯»å–æ–‡ä»¶å¹¶æ‰¾åˆ°å…¶ä¸­åŒ…å«å­—ç¬¦ä¸²å‚æ•°çš„è¡Œï¼Œç„¶åæ‰“å°å‡ºè¿™äº›è¡Œã€‚

åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šå±•ç¤ºå¦‚ä½•è®©æˆ‘ä»¬çš„å‘½ä»¤è¡Œå·¥å…·åˆ©ç”¨å¾ˆå¤šå‘½ä»¤è¡Œå·¥å…·ä¸­ç”¨åˆ°çš„ç»ˆç«¯åŠŸèƒ½ã€‚è¯»å–ç¯å¢ƒå˜é‡æ¥ä½¿å¾—ç”¨æˆ·å¯ä»¥é…ç½®å·¥å…·çš„è¡Œä¸ºã€‚æ‰“å°åˆ°æ ‡å‡†é”™è¯¯æ§åˆ¶æµï¼ˆstderrï¼‰è€Œä¸æ˜¯æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰ï¼Œä¾‹å¦‚è¿™æ ·ç”¨æˆ·å¯ä»¥é€‰æ‹©å°†æˆåŠŸè¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ä¸­çš„åŒæ—¶ä»ç„¶åœ¨å±å¹•ä¸Šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚
```shell
# åˆ›å»ºæ–°é¡¹ç›®
$ cargo new minigrep
```
æ‰§è¡Œå‘½ä»¤ï¼Œæ£€ç´¢æ–‡ä»¶
```shell
cargo run -- searchstring example-filename.txt
```

##### è¯»å†™å‚æ•°
```rust
// è°ƒç”¨å‡½æ•°ï¼Œä½¿ç”¨å¤–éƒ¨ä¼ å‚

use std::env;

  

fn main() {

// éœ€è¦ä¸€ä¸ª Rust æ ‡å‡†åº“æä¾›çš„å‡½æ•° std::env::argsã€‚è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªä¼ é€’ç»™ç¨‹åºçš„å‘½ä»¤è¡Œå‚æ•°çš„ è¿­ä»£å™¨ï¼ˆiteratorï¼‰

let args: Vec<String> = env::args().collect();

// æ‰“å°åˆ°å¼‚å¸¸æ§åˆ¶å°

// dbg!(args);

/*

[src/main.rs:7] args = [

"target/debug/minigrep", // * è¿™æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶åç§°

"searchstring", // * ç¬¬ä¸€ä¸ªå‚æ•°

"example-filename.txt", // * ç¬¬äºŒå‚æ•°

]Ë

*/

  

// è·å–å‚æ•°

let pathName = &args[0];

let query = &args[1];

let file_path = &args[2];

println!("zero{}", pathName);

println!("one{}", query);

println!("two{}", file_path);

}
```

##### è¯»å†™æ–‡ä»¶
```rust
// è°ƒç”¨å‡½æ•°ï¼Œä½¿ç”¨å¤–éƒ¨ä¼ å‚

use std::env;

use std::fs;

  

/*

main å‡½æ•°è´Ÿè´£å¤šä¸ªä»»åŠ¡çš„ç»„ç»‡é—®é¢˜åœ¨è®¸å¤šäºŒè¿›åˆ¶é¡¹ç›®ä¸­å¾ˆå¸¸è§ã€‚æ‰€ä»¥ Rust ç¤¾åŒºå¼€å‘å‡ºä¸€ç±»åœ¨ main å‡½æ•°å¼€å§‹å˜å¾—åºå¤§æ—¶è¿›è¡ŒäºŒè¿›åˆ¶ç¨‹åºçš„å…³æ³¨åˆ†ç¦»çš„æŒ‡å¯¼ã€‚è¿™äº›è¿‡ç¨‹æœ‰å¦‚ä¸‹æ­¥éª¤ï¼š

  

å°†ç¨‹åºæ‹†åˆ†æˆ main.rs å’Œ lib.rs å¹¶å°†ç¨‹åºçš„é€»è¾‘æ”¾å…¥ lib.rs ä¸­ã€‚

å½“å‘½ä»¤è¡Œè§£æé€»è¾‘æ¯”è¾ƒå°æ—¶ï¼Œå¯ä»¥ä¿ç•™åœ¨ main.rs ä¸­ã€‚

å½“å‘½ä»¤è¡Œè§£æå¼€å§‹å˜å¾—å¤æ‚æ—¶ï¼Œä¹ŸåŒæ ·å°†å…¶ä» main.rs æå–åˆ° lib.rs ä¸­ã€‚

ç»è¿‡è¿™äº›è¿‡ç¨‹ä¹‹åä¿ç•™åœ¨ main å‡½æ•°ä¸­çš„è´£ä»»åº”è¯¥è¢«é™åˆ¶ä¸ºï¼š

  

ä½¿ç”¨å‚æ•°å€¼è°ƒç”¨å‘½ä»¤è¡Œè§£æé€»è¾‘

è®¾ç½®ä»»ä½•å…¶ä»–çš„é…ç½®

è°ƒç”¨ lib.rs ä¸­çš„ run å‡½æ•°

å¦‚æœ run è¿”å›é”™è¯¯ï¼Œåˆ™å¤„ç†è¿™ä¸ªé”™è¯¯

è¿™ä¸ªæ¨¡å¼çš„ä¸€åˆ‡å°±æ˜¯ä¸ºäº†å…³æ³¨åˆ†ç¦»ï¼šmain.rs å¤„ç†ç¨‹åºè¿è¡Œï¼Œè€Œ lib.rs å¤„ç†æ‰€æœ‰çš„çœŸæ­£çš„ä»»åŠ¡é€»è¾‘ã€‚å› ä¸ºä¸èƒ½ç›´æ¥æµ‹è¯• main å‡½æ•°ï¼Œè¿™ä¸ªç»“æ„é€šè¿‡å°†æ‰€æœ‰çš„ç¨‹åºé€»è¾‘ç§»åŠ¨åˆ° lib.rs çš„å‡½æ•°ä¸­ä½¿å¾—æˆ‘ä»¬å¯ä»¥æµ‹è¯•ä»–ä»¬ã€‚ä»…ä»…ä¿ç•™åœ¨ main.rs ä¸­çš„ä»£ç å°†è¶³å¤Ÿå°ä»¥ä¾¿é˜…è¯»å°±å¯ä»¥éªŒè¯å…¶æ­£ç¡®æ€§ã€‚è®©æˆ‘ä»¬éµå¾ªè¿™äº›æ­¥éª¤æ¥é‡æ„ç¨‹åºã€‚

*/

  

fn main() {

// éœ€è¦ä¸€ä¸ª Rust æ ‡å‡†åº“æä¾›çš„å‡½æ•° std::env::argsã€‚è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªä¼ é€’ç»™ç¨‹åºçš„å‘½ä»¤è¡Œå‚æ•°çš„ è¿­ä»£å™¨ï¼ˆiteratorï¼‰

let args: Vec<String> = env::args().collect();

// æ‰“å°åˆ°å¼‚å¸¸æ§åˆ¶å°

// dbg!(args);

/*

[src/main.rs:7] args = [

"target/debug/minigrep", // * è¿™æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶åç§°

"searchstring", // * ç¬¬ä¸€ä¸ªå‚æ•°

"example-filename.txt", // * ç¬¬äºŒå‚æ•°

]Ë

*/

  

// è·å–å‚æ•°

// let pathName = &args[0];

let query = &args[1];

let file_path = &args[2];

// println!("zero{}", pathName);

// println!("one{}", query);

// println!("two{}", file_path);

  

// è¯»å†™æ–‡ä»¶

println!("In file {}", file_path);

let contents = fs::read_to_string(file_path).expect("Should have been able to read the file");

println!("With text:\n{contents}");

  

}
```
##### æ ‡å‡†å†™æ³•
```rust
// è°ƒç”¨å‡½æ•°ï¼Œä½¿ç”¨å¤–éƒ¨ä¼ å‚

use std::env;

use std::error::Error;

use std::fs;

use std::process;

  

/*

main å‡½æ•°è´Ÿè´£å¤šä¸ªä»»åŠ¡çš„ç»„ç»‡é—®é¢˜åœ¨è®¸å¤šäºŒè¿›åˆ¶é¡¹ç›®ä¸­å¾ˆå¸¸è§ã€‚æ‰€ä»¥ Rust ç¤¾åŒºå¼€å‘å‡ºä¸€ç±»åœ¨ main å‡½æ•°å¼€å§‹å˜å¾—åºå¤§æ—¶è¿›è¡ŒäºŒè¿›åˆ¶ç¨‹åºçš„å…³æ³¨åˆ†ç¦»çš„æŒ‡å¯¼ã€‚è¿™äº›è¿‡ç¨‹æœ‰å¦‚ä¸‹æ­¥éª¤ï¼š

  

å°†ç¨‹åºæ‹†åˆ†æˆ main.rs å’Œ lib.rs å¹¶å°†ç¨‹åºçš„é€»è¾‘æ”¾å…¥ lib.rs ä¸­ã€‚

å½“å‘½ä»¤è¡Œè§£æé€»è¾‘æ¯”è¾ƒå°æ—¶ï¼Œå¯ä»¥ä¿ç•™åœ¨ main.rs ä¸­ã€‚

å½“å‘½ä»¤è¡Œè§£æå¼€å§‹å˜å¾—å¤æ‚æ—¶ï¼Œä¹ŸåŒæ ·å°†å…¶ä» main.rs æå–åˆ° lib.rs ä¸­ã€‚

ç»è¿‡è¿™äº›è¿‡ç¨‹ä¹‹åä¿ç•™åœ¨ main å‡½æ•°ä¸­çš„è´£ä»»åº”è¯¥è¢«é™åˆ¶ä¸ºï¼š

  

ä½¿ç”¨å‚æ•°å€¼è°ƒç”¨å‘½ä»¤è¡Œè§£æé€»è¾‘

è®¾ç½®ä»»ä½•å…¶ä»–çš„é…ç½®

è°ƒç”¨ lib.rs ä¸­çš„ run å‡½æ•°

å¦‚æœ run è¿”å›é”™è¯¯ï¼Œåˆ™å¤„ç†è¿™ä¸ªé”™è¯¯

è¿™ä¸ªæ¨¡å¼çš„ä¸€åˆ‡å°±æ˜¯ä¸ºäº†å…³æ³¨åˆ†ç¦»ï¼šmain.rs å¤„ç†ç¨‹åºè¿è¡Œï¼Œè€Œ lib.rs å¤„ç†æ‰€æœ‰çš„çœŸæ­£çš„ä»»åŠ¡é€»è¾‘ã€‚å› ä¸ºä¸èƒ½ç›´æ¥æµ‹è¯• main å‡½æ•°ï¼Œè¿™ä¸ªç»“æ„é€šè¿‡å°†æ‰€æœ‰çš„ç¨‹åºé€»è¾‘ç§»åŠ¨åˆ° lib.rs çš„å‡½æ•°ä¸­ä½¿å¾—æˆ‘ä»¬å¯ä»¥æµ‹è¯•ä»–ä»¬ã€‚ä»…ä»…ä¿ç•™åœ¨ main.rs ä¸­çš„ä»£ç å°†è¶³å¤Ÿå°ä»¥ä¾¿é˜…è¯»å°±å¯ä»¥éªŒè¯å…¶æ­£ç¡®æ€§ã€‚è®©æˆ‘ä»¬éµå¾ªè¿™äº›æ­¥éª¤æ¥é‡æ„ç¨‹åºã€‚

*/

  

fn main() {

// éœ€è¦ä¸€ä¸ª Rust æ ‡å‡†åº“æä¾›çš„å‡½æ•° std::env::argsã€‚è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªä¼ é€’ç»™ç¨‹åºçš„å‘½ä»¤è¡Œå‚æ•°çš„ è¿­ä»£å™¨ï¼ˆiteratorï¼‰

// let args: Vec<String> = env::args().collect();

// æ‰“å°åˆ°å¼‚å¸¸æ§åˆ¶å°

// dbg!(args);

/*

[src/main.rs:7] args = [

"target/debug/minigrep", // * è¿™æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶åç§°

"searchstring", // * ç¬¬ä¸€ä¸ªå‚æ•°

"example-filename.txt", // * ç¬¬äºŒå‚æ•°

]Ë

*/

  

// è·å–å‚æ•°

// let pathName = &args[0];

// let query = &args[1];

// let file_path = &args[2];

// println!("zero{}", pathName);

// println!("one{}", query);

// println!("two{}", file_path);

  

// è¯»å†™æ–‡ä»¶

// println!("In file {}", file_path);

// let contents = fs::read_to_string(file_path).expect("Should have been able to read the file");

// println!("With text:\n{contents}");

  

let args: Vec<String> = env::args().collect();

let config = Config::build(&args).unwrap_or_else(|err| {

println!("Problem parsing arguments: {err}");

process::exit(1);

});

  

// let contents =

// fs::read_to_string(config.file_path).expect("Should have been able to read the file");

  

if let Err(e) = run(config) {

println!("Application error: {e}");

process::exit(1);

}

}

  

struct Config {

query: String,

file_path: String,

}

  

// fn parse_config(args: &[String]) -> Config {

// let query = args[1].clone();

// let file_path = args[2].clone();

  

// Config { query, file_path }

// }

  

impl Config {

fn build(args: &[String]) -> Result<Config, &'static str> {

if args.len() < 3 {

return Err("not enough arguments");

}

  

let query = args[1].clone();

let file_path = args[2].clone();

  

Ok(Config { query, file_path })

}

}

  

fn run(config: Config) -> Result<(), Box<dyn Error>> {

let contents = fs::read_to_string(config.file_path)?;

println!("With text:\n{contents}");

Ok(())

}
```

##### æ¨¡å—åŒ–
main
```rust
// è°ƒç”¨å‡½æ•°ï¼Œä½¿ç”¨å¤–éƒ¨ä¼ å‚

use std::env;

// use std::error::Error;

// use std::fs;

use minigrep::Config;

use std::process;

  

/*

main å‡½æ•°è´Ÿè´£å¤šä¸ªä»»åŠ¡çš„ç»„ç»‡é—®é¢˜åœ¨è®¸å¤šäºŒè¿›åˆ¶é¡¹ç›®ä¸­å¾ˆå¸¸è§ã€‚æ‰€ä»¥ Rust ç¤¾åŒºå¼€å‘å‡ºä¸€ç±»åœ¨ main å‡½æ•°å¼€å§‹å˜å¾—åºå¤§æ—¶è¿›è¡ŒäºŒè¿›åˆ¶ç¨‹åºçš„å…³æ³¨åˆ†ç¦»çš„æŒ‡å¯¼ã€‚è¿™äº›è¿‡ç¨‹æœ‰å¦‚ä¸‹æ­¥éª¤ï¼š

  

å°†ç¨‹åºæ‹†åˆ†æˆ main.rs å’Œ lib.rs å¹¶å°†ç¨‹åºçš„é€»è¾‘æ”¾å…¥ lib.rs ä¸­ã€‚

å½“å‘½ä»¤è¡Œè§£æé€»è¾‘æ¯”è¾ƒå°æ—¶ï¼Œå¯ä»¥ä¿ç•™åœ¨ main.rs ä¸­ã€‚

å½“å‘½ä»¤è¡Œè§£æå¼€å§‹å˜å¾—å¤æ‚æ—¶ï¼Œä¹ŸåŒæ ·å°†å…¶ä» main.rs æå–åˆ° lib.rs ä¸­ã€‚

ç»è¿‡è¿™äº›è¿‡ç¨‹ä¹‹åä¿ç•™åœ¨ main å‡½æ•°ä¸­çš„è´£ä»»åº”è¯¥è¢«é™åˆ¶ä¸ºï¼š

  

ä½¿ç”¨å‚æ•°å€¼è°ƒç”¨å‘½ä»¤è¡Œè§£æé€»è¾‘

è®¾ç½®ä»»ä½•å…¶ä»–çš„é…ç½®

è°ƒç”¨ lib.rs ä¸­çš„ run å‡½æ•°

å¦‚æœ run è¿”å›é”™è¯¯ï¼Œåˆ™å¤„ç†è¿™ä¸ªé”™è¯¯

è¿™ä¸ªæ¨¡å¼çš„ä¸€åˆ‡å°±æ˜¯ä¸ºäº†å…³æ³¨åˆ†ç¦»ï¼šmain.rs å¤„ç†ç¨‹åºè¿è¡Œï¼Œè€Œ lib.rs å¤„ç†æ‰€æœ‰çš„çœŸæ­£çš„ä»»åŠ¡é€»è¾‘ã€‚å› ä¸ºä¸èƒ½ç›´æ¥æµ‹è¯• main å‡½æ•°ï¼Œè¿™ä¸ªç»“æ„é€šè¿‡å°†æ‰€æœ‰çš„ç¨‹åºé€»è¾‘ç§»åŠ¨åˆ° lib.rs çš„å‡½æ•°ä¸­ä½¿å¾—æˆ‘ä»¬å¯ä»¥æµ‹è¯•ä»–ä»¬ã€‚ä»…ä»…ä¿ç•™åœ¨ main.rs ä¸­çš„ä»£ç å°†è¶³å¤Ÿå°ä»¥ä¾¿é˜…è¯»å°±å¯ä»¥éªŒè¯å…¶æ­£ç¡®æ€§ã€‚è®©æˆ‘ä»¬éµå¾ªè¿™äº›æ­¥éª¤æ¥é‡æ„ç¨‹åºã€‚

*/

  

fn main() {

// éœ€è¦ä¸€ä¸ª Rust æ ‡å‡†åº“æä¾›çš„å‡½æ•° std::env::argsã€‚è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªä¼ é€’ç»™ç¨‹åºçš„å‘½ä»¤è¡Œå‚æ•°çš„ è¿­ä»£å™¨ï¼ˆiteratorï¼‰

// let args: Vec<String> = env::args().collect();

// æ‰“å°åˆ°å¼‚å¸¸æ§åˆ¶å°

// dbg!(args);

/*

[src/main.rs:7] args = [

"target/debug/minigrep", // * è¿™æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶åç§°

"searchstring", // * ç¬¬ä¸€ä¸ªå‚æ•°

"example-filename.txt", // * ç¬¬äºŒå‚æ•°

]Ë

*/

  

// è·å–å‚æ•°

// let pathName = &args[0];

// let query = &args[1];

// let file_path = &args[2];

// println!("zero{}", pathName);

// println!("one{}", query);

// println!("two{}", file_path);

  

// è¯»å†™æ–‡ä»¶

// println!("In file {}", file_path);

// let contents = fs::read_to_string(file_path).expect("Should have been able to read the file");

// println!("With text:\n{contents}");

  

let args: Vec<String> = env::args().collect();

let config = Config::build(&args).unwrap_or_else(|err| {

println!("Problem parsing arguments: {err}");

process::exit(1);

});

  

// let contents =

// fs::read_to_string(config.file_path).expect("Should have been able to read the file");

  

// if let Err(e) = run(config) {

// println!("Application error: {e}");

// process::exit(1);

// }

  

if let Err(e) = minigrep::run(config) {

println!("Application error: {e}");

process::exit(1);

}

}

  

// struct Config {

// query: String,

// file_path: String,

// }

  

// fn parse_config(args: &[String]) -> Config {

// let query = args[1].clone();

// let file_path = args[2].clone();

  

// Config { query, file_path }

// }

  

// impl Config {

// fn build(args: &[String]) -> Result<Config, &'static str> {

// if args.len() < 3 {

// return Err("not enough arguments");

// }

  

// let query = args[1].clone();

// let file_path = args[2].clone();

  

// Ok(Config { query, file_path })

// }

// }

  

// fn run(config: Config) -> Result<(), Box<dyn Error>> {

// let contents = fs::read_to_string(config.file_path)?;

// println!("With text:\n{contents}");

// Ok(())

// }
```
##### å¤„ç†ç¯å¢ƒå˜é‡
lib.rs
```rust
use std::error::Error;

use std::fs;

use std::env;

  

// pub struct Config {

// pub query: String,

// pub file_path: String,

// }

  

pub struct Config {

pub query: String,

pub file_path: String,

pub ignore_case: bool,

}

  

// impl Config {

// pub fn build(args: &[String]) -> Result<Config, &'static str> {

// if args.len() < 3 {

// return Err("not enough arguments");

// }

  

// let query = args[1].clone();

// let file_path = args[2].clone();

  

// Ok(Config { query, file_path })

// }

// }

  

// pub fn run(config: Config) -> Result<(), Box<dyn Error>> {

// let contents = fs::read_to_string(config.file_path)?;

// // println!("With text:\n{contents}");

// for line in search(&config.query, &contents) {

// // æ‰¾åˆ°æˆ‘ä»¬æƒ³è¦çš„é‚£è¡Œ

// println!("{line}");

// }

// Ok(())

// }

  

impl Config {

pub fn build(args: &[String]) -> Result<Config, &'static str> {

if args.len() < 3 {

return Err("not enough arguments");

}

  

let query = args[1].clone();

let file_path = args[2].clone();

// IGNORE_CASE=1 cargo run to poem.txt è®¾ç½®ç¯å¢ƒå˜é‡æ‰§è¡Œè¯­å¥

let ignore_case = env::var("IGNORE_CASE").is_ok();

  

Ok(Config {

query,

file_path,

ignore_case,

})

}

}

  

pub fn run(config: Config) -> Result<(), Box<dyn Error>> {

let contents = fs::read_to_string(config.file_path)?;

  

let results = if config.ignore_case {

search_case_insensitive(&config.query, &contents)

} else {

search(&config.query, &contents)

};

  

for line in results {

println!("{line}");

}

  

Ok(())

}

  

pub fn search<'a>(query: &str, contents: &'a str) -> Vec<&'a str> {

let mut results = Vec::new();

  

for line in contents.lines() {

if line.contains(query) {

// ç¬¬äºŒè¡Œçš„productiveåˆšå¥½æ»¡è¶³æ¡ä»¶

results.push(line);

}

}

  

results

}

  

pub fn search_case_insensitive<'a>(query: &str, contents: &'a str) -> Vec<&'a str> {

let query = query.to_lowercase();

let mut results = Vec::new();

  

for line in contents.lines() {

if line.to_lowercase().contains(&query) {

results.push(line);

}

}

  

results

}

  

#[cfg(test)]

mod tests {

use super::*;

  

#[test]

fn one_result() {

let query = "duct";

let contents = "\

Rust:

safe, fast, productive.

Pick three.";

  

// æµ‹è¯•æ˜¯å¦ç›¸ç­‰

assert_eq!(vec!["safe, fast, productive."], search(query, contents));

}

  

// å¤§å°å†™ä¸æ•æ„Ÿ

#[test]

fn case_sensitive() {

let query = "duct";

let contents = "\

Rust:

safe, fast, productive.

Pick three.

Duct tape.";

  

assert_eq!(vec!["safe, fast, productive."], search(query, contents));

}

  

#[test]

fn case_insensitive() {

let query = "rUsT";

let contents = "\

Rust:

safe, fast, productive.

Pick three.

Trust me.";

  

assert_eq!(

vec!["Rust:", "Trust me."],

search_case_insensitive(query, contents)

);

}

}
```
##### ä½¿ç”¨é”™è¯¯è¾“å‡º
main.rs
```rust
// è°ƒç”¨å‡½æ•°ï¼Œä½¿ç”¨å¤–éƒ¨ä¼ å‚

use std::env;

// use std::error::Error;

// use std::fs;

use minigrep::Config;

use std::process;

  

/*

main å‡½æ•°è´Ÿè´£å¤šä¸ªä»»åŠ¡çš„ç»„ç»‡é—®é¢˜åœ¨è®¸å¤šäºŒè¿›åˆ¶é¡¹ç›®ä¸­å¾ˆå¸¸è§ã€‚æ‰€ä»¥ Rust ç¤¾åŒºå¼€å‘å‡ºä¸€ç±»åœ¨ main å‡½æ•°å¼€å§‹å˜å¾—åºå¤§æ—¶è¿›è¡ŒäºŒè¿›åˆ¶ç¨‹åºçš„å…³æ³¨åˆ†ç¦»çš„æŒ‡å¯¼ã€‚è¿™äº›è¿‡ç¨‹æœ‰å¦‚ä¸‹æ­¥éª¤ï¼š

  

å°†ç¨‹åºæ‹†åˆ†æˆ main.rs å’Œ lib.rs å¹¶å°†ç¨‹åºçš„é€»è¾‘æ”¾å…¥ lib.rs ä¸­ã€‚

å½“å‘½ä»¤è¡Œè§£æé€»è¾‘æ¯”è¾ƒå°æ—¶ï¼Œå¯ä»¥ä¿ç•™åœ¨ main.rs ä¸­ã€‚

å½“å‘½ä»¤è¡Œè§£æå¼€å§‹å˜å¾—å¤æ‚æ—¶ï¼Œä¹ŸåŒæ ·å°†å…¶ä» main.rs æå–åˆ° lib.rs ä¸­ã€‚

ç»è¿‡è¿™äº›è¿‡ç¨‹ä¹‹åä¿ç•™åœ¨ main å‡½æ•°ä¸­çš„è´£ä»»åº”è¯¥è¢«é™åˆ¶ä¸ºï¼š

  

ä½¿ç”¨å‚æ•°å€¼è°ƒç”¨å‘½ä»¤è¡Œè§£æé€»è¾‘

è®¾ç½®ä»»ä½•å…¶ä»–çš„é…ç½®

è°ƒç”¨ lib.rs ä¸­çš„ run å‡½æ•°

å¦‚æœ run è¿”å›é”™è¯¯ï¼Œåˆ™å¤„ç†è¿™ä¸ªé”™è¯¯

è¿™ä¸ªæ¨¡å¼çš„ä¸€åˆ‡å°±æ˜¯ä¸ºäº†å…³æ³¨åˆ†ç¦»ï¼šmain.rs å¤„ç†ç¨‹åºè¿è¡Œï¼Œè€Œ lib.rs å¤„ç†æ‰€æœ‰çš„çœŸæ­£çš„ä»»åŠ¡é€»è¾‘ã€‚å› ä¸ºä¸èƒ½ç›´æ¥æµ‹è¯• main å‡½æ•°ï¼Œè¿™ä¸ªç»“æ„é€šè¿‡å°†æ‰€æœ‰çš„ç¨‹åºé€»è¾‘ç§»åŠ¨åˆ° lib.rs çš„å‡½æ•°ä¸­ä½¿å¾—æˆ‘ä»¬å¯ä»¥æµ‹è¯•ä»–ä»¬ã€‚ä»…ä»…ä¿ç•™åœ¨ main.rs ä¸­çš„ä»£ç å°†è¶³å¤Ÿå°ä»¥ä¾¿é˜…è¯»å°±å¯ä»¥éªŒè¯å…¶æ­£ç¡®æ€§ã€‚è®©æˆ‘ä»¬éµå¾ªè¿™äº›æ­¥éª¤æ¥é‡æ„ç¨‹åºã€‚

*/

  

fn main() {

// éœ€è¦ä¸€ä¸ª Rust æ ‡å‡†åº“æä¾›çš„å‡½æ•° std::env::argsã€‚è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªä¼ é€’ç»™ç¨‹åºçš„å‘½ä»¤è¡Œå‚æ•°çš„ è¿­ä»£å™¨ï¼ˆiteratorï¼‰

// let args: Vec<String> = env::args().collect();

// æ‰“å°åˆ°å¼‚å¸¸æ§åˆ¶å°

// dbg!(args);

/*

[src/main.rs:7] args = [

"target/debug/minigrep", // * è¿™æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶åç§°

"searchstring", // * ç¬¬ä¸€ä¸ªå‚æ•°

"example-filename.txt", // * ç¬¬äºŒå‚æ•°

]Ë

*/

  

// è·å–å‚æ•°

// let pathName = &args[0];

// let query = &args[1];

// let file_path = &args[2];

// println!("zero{}", pathName);

// println!("one{}", query);

// println!("two{}", file_path);

  

// è¯»å†™æ–‡ä»¶

// println!("In file {}", file_path);

// let contents = fs::read_to_string(file_path).expect("Should have been able to read the file");

// println!("With text:\n{contents}");

  

let args: Vec<String> = env::args().collect();

let config = Config::build(&args).unwrap_or_else(|err| {

// println!("Problem parsing arguments: {err}");

// ! ä½¿ç”¨eprintln! å¯ä»¥è®©é”™è¯¯ä¿¡æ¯ä¸è¢«è¾“å‡º

eprintln!("Problem parsing arguments: {err}");

process::exit(1);

});

  

// let contents =

// fs::read_to_string(config.file_path).expect("Should have been able to read the file");

  

// if let Err(e) = run(config) {

// println!("Application error: {e}");

// process::exit(1);

// }

  

if let Err(e) = minigrep::run(config) {

// println!("Application error: {e}");

eprintln!("Application error: {e}");

process::exit(1);

}

}

  

// struct Config {

// query: String,

// file_path: String,

// }

  

// fn parse_config(args: &[String]) -> Config {

// let query = args[1].clone();

// let file_path = args[2].clone();

  

// Config { query, file_path }

// }

  

// impl Config {

// fn build(args: &[String]) -> Result<Config, &'static str> {

// if args.len() < 3 {

// return Err("not enough arguments");

// }

  

// let query = args[1].clone();

// let file_path = args[2].clone();

  

// Ok(Config { query, file_path })

// }

// }

  

// fn run(config: Config) -> Result<(), Box<dyn Error>> {

// let contents = fs::read_to_string(config.file_path)?;

// println!("With text:\n{contents}");

// Ok(())

// }
```
####  è¿­ä»£å™¨å’Œé—­åŒ…
programmingï¼‰ã€‚å‡½æ•°å¼ç¼–ç¨‹é£æ ¼é€šå¸¸åŒ…å«å°†å‡½æ•°ä½œä¸ºå‚æ•°å€¼æˆ–å…¶ä»–å‡½æ•°çš„è¿”å›å€¼ã€å°†å‡½æ•°èµ‹å€¼ç»™å˜é‡ä»¥ä¾›ä¹‹åæ‰§è¡Œç­‰ç­‰ã€‚

æœ¬ç« æˆ‘ä»¬ä¸ä¼šè®¨è®ºå‡½æ•°å¼ç¼–ç¨‹æ˜¯æˆ–ä¸æ˜¯ä»€ä¹ˆçš„é—®é¢˜ï¼Œè€Œæ˜¯å±•ç¤º Rust çš„ä¸€äº›åœ¨åŠŸèƒ½ä¸Šä¸å…¶ä»–è¢«è®¤ä¸ºæ˜¯å‡½æ•°å¼è¯­è¨€ç±»ä¼¼çš„ç‰¹æ€§ã€‚

æ›´å…·ä½“çš„ï¼Œæˆ‘ä»¬å°†è¦æ¶‰åŠï¼š

é—­åŒ…ï¼ˆClosuresï¼‰ï¼Œä¸€ä¸ªå¯ä»¥å‚¨å­˜åœ¨å˜é‡é‡Œçš„ç±»ä¼¼å‡½æ•°çš„ç»“æ„
è¿­ä»£å™¨ï¼ˆIteratorsï¼‰ï¼Œä¸€ç§å¤„ç†å…ƒç´ åºåˆ—çš„æ–¹å¼
å¦‚ä½•ä½¿ç”¨é—­åŒ…å’Œè¿­ä»£å™¨æ¥æ”¹è¿›ç¬¬åäºŒç« çš„ I/O é¡¹ç›®ã€‚
é—­åŒ…å’Œè¿­ä»£å™¨çš„æ€§èƒ½ã€‚ï¼ˆå‰§é€è­¦å‘Šï¼š ä»–ä»¬çš„é€Ÿåº¦è¶…ä¹ä½ çš„æƒ³è±¡ï¼ï¼‰


##### é—­åŒ…
Rust çš„ é—­åŒ…ï¼ˆclosuresï¼‰æ˜¯å¯ä»¥ä¿å­˜åœ¨ä¸€ä¸ªå˜é‡ä¸­æˆ–ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°çš„åŒ¿åå‡½æ•°ã€‚å¯ä»¥åœ¨ä¸€ä¸ªåœ°æ–¹åˆ›å»ºé—­åŒ…ï¼Œç„¶ååœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œé—­åŒ…è¿ç®—ã€‚ä¸åŒäºå‡½æ•°ï¼Œé—­åŒ…å…è®¸æ•è·è¢«å®šä¹‰æ—¶æ‰€åœ¨ä½œç”¨åŸŸä¸­çš„å€¼ã€‚


```rust

```











#### â­ï¸æ™ºèƒ½æŒ‡é’ˆ


#### â­ï¸å®‰å…¨å¹¶å‘


#### é¢å‘å¯¹è±¡ç¼–ç¨‹


#### æ¨¡å¼ä¸æ¨¡å¼åŒ¹é…


#### é«˜çº§ç‰¹å¾


#### â­ï¸å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹



#### æ ‡å‡†åº“


#### Cargoç”¨æ³•
- æŸ¥çœ‹cargoç‰ˆæœ¬
```shell
$ cargo --version
```
- åˆ›å»ºæ–°é¡¹ç›®
```shell
$ cargo new hello_cargo
```
- æ„å»º
```shell
$ cargo build
```
- ä»£ç æ£€æŸ¥
```
$ cargo check
```
- æ·»åŠ ä¾èµ–
```
$ cargo add rand
```
- å‡çº§åŒ…
	- é»˜è®¤å°†ä¾èµ–åº“ç‰ˆæœ¬æå‡åˆ°ç¨³å®šç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯æœ€æ–°ç‰ˆæœ¬ã€‚
	- å¦‚æœä½ æƒ³è®©ä¾èµ–æå‡åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œè¿˜æ˜¯éœ€è¦æ‰‹åŠ¨æ”¹å†™cargo.toml
```
cargo update
```
- æŸ¥çœ‹ä¾èµ–ï¼Œè¿è¡Œ cargo doc --open å‘½ä»¤æ¥æ„å»ºæ‰€æœ‰æœ¬åœ°ä¾èµ–æä¾›çš„æ–‡æ¡£ï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ã€‚ä¾èµ–æ–‡æ¡£ç«Ÿç„¶æ˜¯
```shell
$ cargo doc --open
```




##### æ‰“åŒ…å‘å¸ƒ




#### åµŒå…¥å¼å¼€å‘

```markdown
# è£¸æœºå¼€å‘

è£¸æœºå¼€å‘æ˜¯æŒ‡åœ¨æ²¡æœ‰æ“ä½œç³»ç»Ÿæˆ–è¿è¡Œæ—¶ç¯å¢ƒçš„æ”¯æŒä¸‹ï¼Œç›´æ¥åœ¨ç¡¬ä»¶ä¸Šè¿è¡Œç¨‹åºçš„ä¸€ç§å¼€å‘æ–¹å¼ã€‚è¿™é€šå¸¸ç”¨äºåµŒå…¥å¼ç³»ç»Ÿæˆ–ä¸€äº›ç‰¹æ®Šçš„ç¯å¢ƒï¼Œè¦æ±‚ç¨‹åºå‘˜ç›´æ¥æ§åˆ¶åº•å±‚ç¡¬ä»¶èµ„æºã€‚ä»¥ä¸‹æ˜¯è£¸æœºå¼€å‘çš„ä¸€èˆ¬åŸç†ï¼š

1. **å¯åŠ¨ä»£ç ï¼ˆBootstrappingï¼‰ï¼š** åœ¨è£¸æœºå¼€å‘ä¸­ï¼Œé¦–å…ˆéœ€è¦ä¸€ä¸ªå¯åŠ¨ä»£ç ï¼Œè¯¥ä»£ç è´Ÿè´£åˆå§‹åŒ–ç¡¬ä»¶ç¯å¢ƒã€è®¾ç½®å †æ ˆã€åŠ è½½ç¨‹åºç­‰ã€‚è¿™é€šå¸¸æ˜¯ç”±ç¡¬ä»¶æä¾›çš„å¼•å¯¼ç¨‹åºï¼ˆbootloaderï¼‰æˆ–è€…è‡ªå®šä¹‰çš„å¯åŠ¨ä»£ç ã€‚
    
2. **ç¡¬ä»¶åˆå§‹åŒ–ï¼š** åœ¨å¯åŠ¨ä»£ç ä¸­ï¼Œéœ€è¦è¿›è¡Œç¡¬ä»¶çš„åˆå§‹åŒ–å·¥ä½œï¼ŒåŒ…æ‹¬ä½†ä¸é™äºå¤„ç†å™¨åˆå§‹åŒ–ã€å†…å­˜æ§åˆ¶å™¨é…ç½®ã€å¤–è®¾åˆå§‹åŒ–ç­‰ã€‚è¿™ä¸€æ­¥ç¡®ä¿ç¡¬ä»¶å¤„äºä¸€ä¸ªç¨³å®šçš„çŠ¶æ€ï¼Œå¯ä»¥æ­£å¸¸æ‰§è¡Œç¨‹åºã€‚
    
3. **ç¼–å†™åº•å±‚ä»£ç ï¼š** åœ¨è£¸æœºå¼€å‘ä¸­ï¼Œç¨‹åºå‘˜éœ€è¦ç›´æ¥ç¼–å†™ä¸ç›®æ ‡ç¡¬ä»¶ç›¸å…³çš„åº•å±‚ä»£ç ï¼ŒåŒ…æ‹¬è®¿é—®å¯„å­˜å™¨ã€é…ç½®ä¸­æ–­ã€æ“ä½œå¤–è®¾ç­‰ã€‚è¿™é€šå¸¸éœ€è¦å‚è€ƒç¡¬ä»¶æ‰‹å†Œå’Œç›¸å…³æ–‡æ¡£ã€‚
    
4. **ä¸­æ–­å¤„ç†ï¼š** è£¸æœºç³»ç»Ÿé€šå¸¸éœ€è¦å¤„ç†ä¸­æ–­ï¼ŒåŒ…æ‹¬æ—¶é’Ÿä¸­æ–­ã€å¤–è®¾ä¸­æ–­ç­‰ã€‚ç¨‹åºå‘˜éœ€è¦ç¼–å†™ä¸­æ–­æœåŠ¡ç¨‹åºï¼ˆInterrupt Service Routinesï¼ŒISRï¼‰æ¥å“åº”è¿™äº›ä¸­æ–­äº‹ä»¶ã€‚
    
5. **æ— æ“ä½œç³»ç»Ÿç¯å¢ƒï¼š** åœ¨è£¸æœºå¼€å‘ä¸­ï¼Œæ²¡æœ‰æ“ä½œç³»ç»Ÿæä¾›çš„ç³»ç»Ÿè°ƒç”¨ã€å†…å­˜ç®¡ç†å’Œä»»åŠ¡è°ƒåº¦ç­‰åŠŸèƒ½ã€‚ç¨‹åºå‘˜éœ€è¦è‡ªå·±ç®¡ç†å†…å­˜ã€å¤„ç†ä»»åŠ¡è°ƒåº¦ã€è¿›è¡Œè¾“å…¥è¾“å‡ºç­‰ã€‚
    
6. **é“¾æ¥è„šæœ¬ï¼š** ä¸ºäº†å°†ç¨‹åºæ­£ç¡®åœ°åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œéœ€è¦ç¼–å†™é“¾æ¥è„šæœ¬ï¼Œå®šä¹‰ç¨‹åºçš„å†…å­˜å¸ƒå±€ã€ä»£ç æ®µã€æ•°æ®æ®µç­‰ä¿¡æ¯ã€‚
    
7. **è°ƒè¯•ï¼š** ç”±äºè£¸æœºç¯å¢ƒæ²¡æœ‰æ ‡å‡†çš„è°ƒè¯•å·¥å…·ï¼Œè°ƒè¯•é€šå¸¸é€šè¿‡ä¸²å£è¾“å‡ºã€LEDæŒ‡ç¤ºç­‰æ–¹å¼è¿›è¡Œã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ä»¿çœŸå™¨æˆ–è°ƒè¯•å™¨æ¥è¾…åŠ©ã€‚
    
8. **äº¤å‰ç¼–è¯‘ï¼š** ç”±äºè£¸æœºå¼€å‘é€šå¸¸æ¶‰åŠåˆ°ç‰¹å®šç¡¬ä»¶æ¶æ„ï¼Œéœ€è¦ä½¿ç”¨äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼Œå°†ç¨‹åºç¼–è¯‘ä¸ºç›®æ ‡ç¡¬ä»¶èƒ½å¤Ÿæ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚
    

æ€»ä½“è€Œè¨€ï¼Œè£¸æœºå¼€å‘è¦æ±‚ç¨‹åºå‘˜å¯¹åº•å±‚ç¡¬ä»¶æœ‰æ·±å…¥çš„äº†è§£ï¼Œèƒ½å¤Ÿç›´æ¥æ§åˆ¶ç¡¬ä»¶èµ„æºã€‚è¿™ç§å¼€å‘æ–¹å¼é€‚ç”¨äºåµŒå…¥å¼ç³»ç»Ÿã€å®æ—¶ç³»ç»Ÿç­‰åœºæ™¯ï¼Œå¯¹æ€§èƒ½å’Œèµ„æºåˆ©ç”¨çš„è¦æ±‚è¾ƒé«˜ã€‚
```

##### å¼€å‘æ¿




##### ç³»ç»Ÿæ„å»º

#### Shellå¼€å‘


#### webAssemblyå¼€å‘


##### ä¾‹å­
https://mp.weixin.qq.com/s/z8xYSdSYnhJ3LN74kxQo2A
```rust
// 1.å®‰è£… GreptimeDB å’Œ WasmEdge
// å®‰è£… GreptimeDB å’Œ WasmEdge

use mysql_async::{
    prelude::*, Opts, OptsBuilder, Pool, PoolConstraints, PoolOpts, Result, SslOpts,
};
use time::PrimitiveDateTime;

fn get_url() -> String {
    if let Ok(url) = std::env::var("DATABASE_URL") {
        let opts = Opts::from_url(&url).expect("DATABASE_URL invalid");
        if opts
            .db_name()
            .expect("a database name is required")
            .is_empty()
        {
            panic!("database name is empty");
        }
        url
    } else {
        "mysql://root:pass@127.0.0.1:3306/mysql".into()
    }
}

#[derive(Debug)]
struct CpuMetric {
    hostname: String,
    environment: String,
    usage_user: f64,
    usage_system: f64,
    usage_idle: f64,
    ts: i64,
}

impl CpuMetric {
    fn new(
        hostname: String,
        environment: String,
        usage_user: f64,
        usage_system: f64,
        usage_idle: f64,
        ts: i64,
    ) -> Self {
        Self {
            hostname,
            environment,
            usage_user,
            usage_system,
            usage_idle,
            ts,
        }
    }
}

#[tokio::main(flavor = "current_thread")]
async fn main() -> Result<()> {
    // Alternative: The "easy" way with a default connection pool
    // let pool = Pool::new(Opts::from_url(&*get_url()).unwrap());
    // let mut conn = pool.get_conn().await.unwrap();

    // Below we create a customized connection pool
    let opts = Opts::from_url(&*get_url()).unwrap();
    let mut builder = OptsBuilder::from_opts(opts);
    // Disabled after we figured out tls issue.
    if std::env::var("DATABASE_SSL").is_ok() {
        let ssl_opts = SslOpts::default().with_danger_accept_invalid_certs(true);
        // .with_danger_skip_domain_validation(true);
        builder = builder.ssl_opts(ssl_opts);
    }
    // The connection pool will have a min of 5 and max of 10 connections.
    let constraints = PoolConstraints::new(1, 2).unwrap();
    let pool_opts = PoolOpts::default().with_constraints(constraints);

    let pool = Pool::new(builder.pool_opts(pool_opts));
    let mut conn = pool.get_conn().await.unwrap();
    // Create table if not exists
    r"CREATE TABLE IF NOT EXISTS wasmedge_example_cpu_metrics (
    hostname STRING,
    environment STRING,
    usage_user DOUBLE,
    usage_system DOUBLE,
    usage_idle DOUBLE,
    ts TIMESTAMP,
    TIME INDEX(ts),
    PRIMARY KEY(hostname, environment)
);"
    .ignore(&mut conn)
    .await?;
    println!("Table created!");

    println!("Ingest some data...");
    let metrics = vec![
        CpuMetric::new(
            "host0".into(),
            "test".into(),
            32f64,
            3f64,
            4f64,
            1680307200050,
        ),
        CpuMetric::new(
            "host1".into(),
            "test".into(),
            29f64,
            32f64,
            50f64,
            1680307200050,
        ),
        CpuMetric::new(
            "host0".into(),
            "test".into(),
            32f64,
            3f64,
            4f64,
            1680307260050,
        ),
        CpuMetric::new(
            "host1".into(),
            "test".into(),
            29f64,
            32f64,
            50f64,
            1680307260050,
        ),
        CpuMetric::new(
            "host0".into(),
            "test".into(),
            32f64,
            3f64,
            4f64,
            1680307320050,
        ),
        CpuMetric::new(
            "host1".into(),
            "test".into(),
            29f64,
            32f64,
            50f64,
            1680307320050,
        ),
    ];

    r"INSERT INTO wasmedge_example_cpu_metrics (hostname, environment, usage_user, usage_system, usage_idle, ts)
      VALUES (:hostname, :environment, :usage_user, :usage_system, :usage_idle, :ts)"
        .with(metrics.iter().map(|metric| {
            params! {
                "hostname" => &metric.hostname,
                "environment" => &metric.environment,
                "usage_user" => metric.usage_user,
                "usage_system" => metric.usage_system,
                "usage_idle" => metric.usage_idle,
                "ts" => metric.ts,
            }
        }))
        .batch(&mut conn)
        .await?;

    // query data
    println!("Query some data");
    let loaded_metrics = "SELECT * FROM wasmedge_example_cpu_metrics"
        .with(())
        .map(
            &mut conn,
            |(hostname, environment, usage_user, usage_system, usage_idle, raw_ts): (
                String,
                String,
                f64,
                f64,
                f64,
                PrimitiveDateTime,
            )| {
                let ts = raw_ts.assume_utc().unix_timestamp() * 1000;
                CpuMetric::new(
                    hostname,
                    environment,
                    usage_user,
                    usage_system,
                    usage_idle,
                    ts,
                )
            },
        )
        .await?;
    println!("{:?}", loaded_metrics);

    // Dropped connection will go to the pool
    drop(conn);
    // The Pool must be disconnected explicitly because
    // it's an asynchronous operation.
    pool.disconnect().await?;
    Ok(())
}


```
éšåç¼–è¯‘å®ƒï¼Œå†æ‰§è¡Œå®ƒ
```shell
$ cargoÂ buildlsÂ -lhÂ target/wasm32-wasi/debug/greptimedb.wasm
$ wasmedgeÂ --envÂ "DATABASE_URL=mysql://localhost:4002/public"Â target/wasm32-wasi/debug/greptimedb.wasm
```

# æ·±å…¥ç†è§£ Linux & Rust

Linuxçš„å±‚çº§æ¶æ„
æ¯ä¸ªæ“ä½œç³»ç»Ÿéƒ½æœ‰ä¸€ä¸ªå†…æ ¸ï¼Œå†…æ ¸å°è£…äº†åº•å±‚ç¡¬ä»¶è®¾å¤‡ç®¡ç†ã€å†…å­˜ç®¡ç†ã€ç½‘ç»œæ•°æ®åè®®è½¬åŒ–å’Œæ”¶å‘ä¼ è¾“ã€æ–‡ä»¶ç³»ç»Ÿè¯»å†™ç­‰ã€‚ä»è¿™ä¸ªå›¾å¯ä»¥çœ‹åˆ°ï¼Œå†…æ ¸å°†ç³»ç»Ÿç¡¬ä»¶ä¸åº”ç”¨ç¨‹åºè¿›ç¨‹è¿æ¥èµ·æ¥ï¼Œéšè—äº†ä¸Šå±‚ä¸‹å±‚äº¤äº’çš„ä¸€äº›ç»†èŠ‚ï¼Œå„å¸å…¶èŒã€‚
![](readme.assets/Pasted%20image%2020231102015536.png)

è¿™äº›åˆ†å±‚åŒ…æ‹¬ï¼š

	ç”¨æˆ·ç©ºé—´ç¨‹åº
	ç¼–è¯‘å™¨
	ç»ˆç«¯
	é˜²ç«å¢™
	ç³»ç»Ÿè°ƒç”¨çš„è·¨å¹³å°API(ç‰¹å®šäºå¹³å°çš„ç³»ç»Ÿè°ƒç”¨åŒ…è£…API)
	Rustæ ‡å‡†åº“
	libcï¼ˆæˆ–ç­‰æ•ˆçš„APIï¼‰
	kernelï¼Œæ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒæ¨¡å—
	ç³»ç»Ÿèµ„æº
	å†…å­˜
	æ–‡ä»¶ç³»ç»Ÿ
	ç½‘ç»œ
	ç¡¬ä»¶å’Œå…¶ä»–è®¾å¤‡ï¼ˆåŒ…æ‹¬é”®ç›˜ã€é¼ æ ‡ã€ç›‘è§†å™¨ã€ç£ç›˜é©±åŠ¨å™¨ï¼‰


## Rustçš„æ ‡å‡†åº“çš„åŠŸèƒ½åˆ’åˆ†

è€ŒRustæ ‡å‡†åº“ï¼Œå¾ˆå¥½çš„åˆ©ç”¨äº†æ“ä½œç³»ç»Ÿå†…æ ¸æä¾›çš„APIã€‚

Rustæ ‡å‡†åº“æ˜¯Rustç¨‹åºè¿›å…¥Linuxæ“ä½œç³»ç»Ÿå†…æ ¸å‡½æ•°çš„ä¸»è¦æ¥å£ï¼Œå®ƒåœ¨å†…éƒ¨ä½¿ç”¨libc(åœ¨Windowsç³»ç»Ÿä½¿ç”¨å…¶ä»–ç­‰æ•ˆçš„åº“ï¼‰æ¥è°ƒç”¨å†…æ ¸æä¾›çš„ç³»ç»Ÿè°ƒç”¨ã€‚

ä»Rustç¨‹åºä¸­å‘èµ·ç³»ç»Ÿè°ƒç”¨ï¼Œä»¥å®ç°ç®¡ç†å’Œæ“ä½œå„ç§ç³»ç»Ÿèµ„æºï¼ˆå¦‚å›¾ï¼‰ã€‚

![](readme.assets/Pasted%20image%2020231102015652.png)

å›¾ç‰‡libcï¼ˆæˆ–å…¶å˜ä½“ï¼‰ä¸ºç±»UNIXæ“ä½œç³»ç»Ÿä¸Šçš„ç³»ç»Ÿè°ƒç”¨æä¾›äº†ä¸€ä¸ªåŒ…è£…å™¨ï¼Œå¦‚Linuxå†…æ ¸å®ç°äº†POSIXæ ‡å‡†æŒ‡å®šçš„æ•°ç™¾ä¸ªPOSIX APIï¼ˆå¯¹äºWindowsï¼Œç³»ç»Ÿè°ƒç”¨æœ‰ç­‰æ•ˆçš„APIï¼Œä¹Ÿå®ç°äº†POSIXæ ‡å‡†[1]ï¼‰ã€‚

ä½œä¸ºæ ‡å‡†åº“ï¼ŒRustæ ‡å‡†åº“æ˜¯è·¨å¹³å°çš„ï¼ŒRustæ ‡å‡†åº“çš„ç³»ç»Ÿè°ƒç”¨çš„ç»†èŠ‚æ˜¯ä»Rustå¼€å‘äººå‘˜é‚£é‡ŒæŠ½è±¡å‡ºæ¥çš„ã€‚Rustä¹Ÿæ”¯æŒä¸ä¾èµ–äºæ ‡å‡†åº“çš„è¿è¡Œæ–¹å¼ï¼ˆno_std æ–¹å¼ï¼‰ï¼ŒRustç›´æ¥æ“æ§åº•å±‚ç¡¬ä»¶ï¼ˆå¦‚åº”ç”¨åœ¨åµŒå…¥å¼ç³»ç»Ÿå¼€å‘åœºæ™¯ï¼‰ï¼Œæ­¤æ—¶Rustå°±åšäº†æ“ä½œç³»ç»Ÿæœ¬èº«çš„å·¥ä½œã€‚

å¯¹äºå¤§éƒ¨åˆ†è½¯ä»¶å¼€å‘å·¥ç¨‹å¸ˆè€Œè¨€ï¼Œä»–ä»¬ç”¨Rustä¸»è¦å¼€å‘åº”ç”¨å±‚è½¯ä»¶ï¼Œä¹Ÿå°±æ˜¯è¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´çš„ç¨‹åºã€‚å®ƒä»¬åŸºäºæ ‡å‡†åº“ç¼–å†™ï¼Œå®ç°å„ç§ä¸šåŠ¡åŠŸèƒ½ã€‚åº”ç”¨å±‚çš„è½¯ä»¶å¹¶éæ‰€æœ‰æ¨¡å—å’Œå‡½æ•°éƒ½æ¶‰åŠåˆ°ç³»ç»Ÿè°ƒç”¨ï¼ˆä¾‹å¦‚ä¸€äº›ç”¨äºæ“ä½œå­—ç¬¦ä¸²å’Œå¤„ç†é”™è¯¯çš„å‡½æ•°ï¼Œå°±æ— éœ€è°ƒç”¨ç³»ç»Ÿè°ƒç”¨ï¼‰ã€‚

## Rustæ ‡å‡†åº“å››å¤§ç±»ï¼š

### ç¬¬ä¸€ç±»ï¼ŒRustè¯­è¨€åŸè¯­

å³Rust Language Primitivesï¼šRust è¯­è¨€çš„åŸºæœ¬å…ƒç´ æˆ–åŸºæœ¬ç±»å‹ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚

å¦‚æœ‰ç¬¦å·æ•´æ•°ã€å¸ƒå°”å€¼ã€æµ®ç‚¹æ•°ã€å­—ç¬¦ã€å­—ç¬¦ä¸²ã€æ•°ç»„ã€å…ƒç»„ã€åˆ‡ç‰‡ã€‚è¿™äº›ç”±Rustç¼–è¯‘å™¨è´Ÿè´£å®ç°ã€‚

![](readme.assets/Pasted%20image%2020231102015907.png)

Rustæ ‡å‡†åŒ…æ‹¬åŸè¯­ï¼Œå¹¶åœ¨å®ƒä»¬ä¹‹ä¸Šæ„å»ºã€‚

### ç¬¬äºŒç±»ï¼Œalloc crate

ä¸å †åˆ†é…å€¼çš„å†…å­˜åˆ†é…ç›¸å…³çš„ç±»å‹ã€å‡½æ•°å’Œç‰¹å¾ã€‚
```
åŒ…æ‹¬é›†åˆï¼ˆVecã€Stringç­‰é›†åˆï¼‰ã€æ™ºèƒ½æŒ‡é’ˆç±»å‹ï¼ˆBox<T>ï¼‰ã€å¼•ç”¨è®¡æ•°æŒ‡é’ˆï¼ˆRc<T>ï¼‰å’ŒåŸå­å¼•ç”¨è®¡æ•°æŒ‡é’ˆï¼ˆArc<T>ï¼‰ï¼‰ã€‚
```

### ç¬¬ä¸‰ç±»ï¼Œcore crate

ä½œä¸ºRustæ ‡å‡†åº“çš„åŸºç¡€ã€‚å……å½“Rustè¯­è¨€ä¸æ ‡å‡†åº“ä¹‹é—´çš„é“¾æ¥ï¼Œæä¾›åœ¨RuståŸè¯­ä¹‹ä¸Šå®ç°çš„ç±»å‹ã€ç‰¹å¾ã€å¸¸é‡å’Œå‡½æ•°ï¼Œå¹¶ä¸ºæ‰€æœ‰Rustä»£ç æä¾›åŸºç¡€æ„å»ºå—ï¼Œå®ƒæ˜¯è·¨å¹³å°çš„ï¼Œæ²¡æœ‰ä»»ä½•æŒ‡å‘æ“ä½œç³»ç»Ÿæˆ–å…¶ä»–å¤–éƒ¨ä¾èµ–çš„é“¾æ¥ã€‚ç”±äºè¾ƒå°‘ç›´æ¥ç”¨åˆ°core crateï¼Œæ‰€ä»¥æœ¬æ–‡ä¸åšè¿‡å¤šä»‹ç»ã€‚


### ç¬¬å››ç±»ï¼Œæ¨¡å—ï¼ˆæ ‡å‡†åº“çš„å…¶ä»–crateï¼‰

æ˜¯æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ï¼Œæ¨¡å—crateåŒ…æ‹¬é’ˆå¯¹å¹¶å‘ã€I/Oï¼Œæ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œã€å¼‚æ­¥I/Oã€é”™è¯¯å¤„ç†ç­‰åŠŸèƒ½ï¼Œä»¥åŠä¸ç‰¹å®šæ“ä½œç³»ç»Ÿç›¸å…³çš„å‡½æ•°ï¼ŒRustçš„å®˜ç½‘å¯¹stdæœ‰ä¸“é—¨çš„æ–‡æ¡£[2]ã€‚ä¾‹å¦‚

ä¸ºç”¨æˆ·ç¨‹åºåœ¨å¤šä¸ªçº¿ç¨‹ä¸Šå¹¶å‘è¿è¡Œçš„åŠŸèƒ½åœ¨std::threadæ¨¡å—ä¸­ï¼›
ç”¨äºå¤„ç†åŒæ­¥I/Oçš„åŠŸèƒ½åœ¨std::ioæ¨¡å—ä¸­æä¾›ï¼›
é’ˆå¯¹ç‰¹å®šosçš„æ¨¡å—ï¼Œä¸»è¦åœ¨std::osæ¨¡å—ä¸­å®ç°ã€‚
ä¸‹å›¾å±•ç¤ºäº†Rustæ ‡å‡†åº“å„ä¸ªé¢†åŸŸåŠŸèƒ½æ¶‰åŠåˆ°çš„å…·ä½“stdæ¨¡å—ï¼ˆå¦‚std::ioã€std::osç­‰ï¼‰
![](readme.assets/Pasted%20image%2020231102020142.png)

![](readme.assets/Pasted%20image%2020231102020213.png)
![](readme.assets/Pasted%20image%2020231102020223.png)

![](readme.assets/Pasted%20image%2020231102020231.png)
![](readme.assets/Pasted%20image%2020231102020242.png)
![](readme.assets/Pasted%20image%2020231102020253.png)


